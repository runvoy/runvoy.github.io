<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# cli

```go
import "runvoy/cmd/cli"
```

Package main implements the runvoy CLI tool. It provides commands for managing users and running remote commands.

## Index



# local

```go
import "runvoy/cmd/local"
```

Package main implements the local development server for runvoy. It runs both the orchestrator and async event processor services locally for testing and development.

## Index



# api

```go
import "runvoy/internal/api"
```

Package api defines the API types and structures used across runvoy.

Package api defines the API types and structures used across runvoy.

Package api defines the API types and structures used across runvoy.

Package api defines the API types and structures used across runvoy.

Package api defines the API types and structures used across runvoy. This file contains request and response structures for the secrets API.

Package api defines the API types and structures used across runvoy. It contains request and response structures for the orchestrator API.

Package api defines the API types and structures used across runvoy.

Package api defines the API types and structures used across runvoy.

## Index

- [type AuthorizerHealthStatus](<#AuthorizerHealthStatus>)
- [type ClaimAPIKeyResponse](<#ClaimAPIKeyResponse>)
- [type ComputeHealthStatus](<#ComputeHealthStatus>)
- [type CreateSecretRequest](<#CreateSecretRequest>)
- [type CreateSecretResponse](<#CreateSecretResponse>)
- [type CreateUserRequest](<#CreateUserRequest>)
- [type CreateUserResponse](<#CreateUserResponse>)
- [type DeleteSecretRequest](<#DeleteSecretRequest>)
- [type DeleteSecretResponse](<#DeleteSecretResponse>)
- [type ErrorResponse](<#ErrorResponse>)
- [type Execution](<#Execution>)
- [type ExecutionRequest](<#ExecutionRequest>)
- [type ExecutionResponse](<#ExecutionResponse>)
- [type ExecutionStatusResponse](<#ExecutionStatusResponse>)
- [type GetSecretRequest](<#GetSecretRequest>)
- [type GetSecretResponse](<#GetSecretResponse>)
- [type HealthIssue](<#HealthIssue>)
- [type HealthReconcileResponse](<#HealthReconcileResponse>)
- [type HealthReport](<#HealthReport>)
- [type HealthResponse](<#HealthResponse>)
- [type IdentityHealthStatus](<#IdentityHealthStatus>)
- [type ImageInfo](<#ImageInfo>)
- [type KillExecutionResponse](<#KillExecutionResponse>)
- [type ListImagesResponse](<#ListImagesResponse>)
- [type ListSecretsRequest](<#ListSecretsRequest>)
- [type ListSecretsResponse](<#ListSecretsResponse>)
- [type ListUsersResponse](<#ListUsersResponse>)
- [type LogEvent](<#LogEvent>)
- [type LogsResponse](<#LogsResponse>)
- [type PendingAPIKey](<#PendingAPIKey>)
- [type Playbook](<#Playbook>)
- [type RegisterImageRequest](<#RegisterImageRequest>)
- [type RegisterImageResponse](<#RegisterImageResponse>)
- [type RelatedResources](<#RelatedResources>)
- [type RemoveImageRequest](<#RemoveImageRequest>)
- [type RemoveImageResponse](<#RemoveImageResponse>)
- [type RevokeUserRequest](<#RevokeUserRequest>)
- [type RevokeUserResponse](<#RevokeUserResponse>)
- [type Secret](<#Secret>)
- [type SecretsHealthStatus](<#SecretsHealthStatus>)
- [type TraceResponse](<#TraceResponse>)
- [type UpdateSecretRequest](<#UpdateSecretRequest>)
- [type UpdateSecretResponse](<#UpdateSecretResponse>)
- [type User](<#User>)
- [type WebSocketConnection](<#WebSocketConnection>)
- [type WebSocketDisconnectReason](<#WebSocketDisconnectReason>)
- [type WebSocketMessage](<#WebSocketMessage>)
- [type WebSocketMessageType](<#WebSocketMessageType>)
- [type WebSocketToken](<#WebSocketToken>)


<a name="AuthorizerHealthStatus"></a>
## type [AuthorizerHealthStatus](<https://github.com/runvoy/runvoy/blob/main/internal/api/health.go#L52-L60>)

AuthorizerHealthStatus contains the health status for authorization data.

```go
type AuthorizerHealthStatus struct {
    UsersWithInvalidRoles      []string `json:"users_with_invalid_roles"`
    UsersWithMissingRoles      []string `json:"users_with_missing_roles"`
    ResourcesWithMissingOwners []string `json:"resources_with_missing_owners"`
    OrphanedOwnerships         []string `json:"orphaned_ownerships"`
    MissingOwnerships          []string `json:"missing_ownerships"`
    TotalUsersChecked          int      `json:"total_users_checked"`
    TotalResourcesChecked      int      `json:"total_resources_checked"`
}
```

<a name="ClaimAPIKeyResponse"></a>
## type [ClaimAPIKeyResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/users.go#L47-L51>)

ClaimAPIKeyResponse represents the response when claiming an API key

```go
type ClaimAPIKeyResponse struct {
    APIKey    string `json:"api_key"`
    UserEmail string `json:"user_email"`
    Message   string `json:"message,omitempty"`
}
```

<a name="ComputeHealthStatus"></a>
## type [ComputeHealthStatus](<https://github.com/runvoy/runvoy/blob/main/internal/api/health.go#L24-L31>)

ComputeHealthStatus contains the health status for compute resources \(e.g., containers, task definitions\).

```go
type ComputeHealthStatus struct {
    TotalResources    int      `json:"total_resources"`
    VerifiedCount     int      `json:"verified_count"`
    RecreatedCount    int      `json:"recreated_count"`
    TagUpdatedCount   int      `json:"tag_updated_count"`
    OrphanedCount     int      `json:"orphaned_count"`
    OrphanedResources []string `json:"orphaned_resources"`
}
```

<a name="CreateSecretRequest"></a>
## type [CreateSecretRequest](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L25-L30>)

CreateSecretRequest represents the request to create a new secret

```go
type CreateSecretRequest struct {
    Name        string `json:"name"`     // Internal identifier for the secret
    KeyName     string `json:"key_name"` // Environment variable name (e.g., GITHUB_TOKEN)
    Description string `json:"description,omitempty"`
    Value       string `json:"value"` // The secret value to store
}
```

<a name="CreateSecretResponse"></a>
## type [CreateSecretResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L34-L36>)

CreateSecretResponse represents the response after creating a secret To avoid exposing secret data, only a success message is returned.

```go
type CreateSecretResponse struct {
    Message string `json:"message"`
}
```

<a name="CreateUserRequest"></a>
## type [CreateUserRequest](<https://github.com/runvoy/runvoy/blob/main/internal/api/users.go#L21-L25>)

CreateUserRequest represents the request to create a new user

```go
type CreateUserRequest struct {
    Email  string `json:"email"`
    APIKey string `json:"api_key,omitempty"` // Optional: if not provided, one will be generated
    Role   string `json:"role"`              // Required: admin, operator, developer, or viewer
}
```

<a name="CreateUserResponse"></a>
## type [CreateUserResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/users.go#L28-L31>)

CreateUserResponse represents the response after creating a user

```go
type CreateUserResponse struct {
    User       *User  `json:"user"`
    ClaimToken string `json:"claim_token"`
}
```

<a name="DeleteSecretRequest"></a>
## type [DeleteSecretRequest](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L79-L81>)

DeleteSecretRequest represents the request to delete a secret The secret name is provided in the URL path parameter

```go
type DeleteSecretRequest struct {
    Name string `json:"name"` // Secret name from URL path
}
```

<a name="DeleteSecretResponse"></a>
## type [DeleteSecretResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L84-L87>)

DeleteSecretResponse represents the response after deleting a secret

```go
type DeleteSecretResponse struct {
    Name    string `json:"name"`
    Message string `json:"message"`
}
```

<a name="ErrorResponse"></a>
## type [ErrorResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/types.go#L6-L10>)

ErrorResponse represents an error response

```go
type ErrorResponse struct {
    Error   string `json:"error"`
    Code    string `json:"code,omitempty"`
    Details string `json:"details,omitempty"`
}
```

<a name="Execution"></a>
## type [Execution](<https://github.com/runvoy/runvoy/blob/main/internal/api/executions.go#L51-L65>)

Execution represents an execution record

```go
type Execution struct {
    ExecutionID         string     `json:"execution_id"`
    CreatedBy           string     `json:"created_by"`
    OwnedBy             []string   `json:"owned_by"`
    Command             string     `json:"command"`
    StartedAt           time.Time  `json:"started_at"`
    CompletedAt         *time.Time `json:"completed_at,omitempty"`
    Status              string     `json:"status"`
    ExitCode            int        `json:"exit_code"`
    DurationSeconds     int        `json:"duration_seconds,omitempty"`
    LogStreamName       string     `json:"log_stream_name,omitempty"`
    CreatedByRequestID  string     `json:"created_by_request_id"`
    ModifiedByRequestID string     `json:"modified_by_request_id"`
    ComputePlatform     string     `json:"cloud,omitempty"`
}
```

<a name="ExecutionRequest"></a>
## type [ExecutionRequest](<https://github.com/runvoy/runvoy/blob/main/internal/api/executions.go#L9-L25>)

ExecutionRequest represents a request to execute a command

```go
type ExecutionRequest struct {
    Command string            `json:"command"`
    Image   string            `json:"image,omitempty"`
    Env     map[string]string `json:"env,omitempty"`
    Timeout int               `json:"timeout,omitempty"`
    Secrets []string          `json:"secrets,omitempty"`

    // Git repository configuration (optional sidecar pattern)
    GitRepo string `json:"git_repo,omitempty"` // Git repository URL (e.g., "https://github.com/user/repo.git")
    GitRef  string `json:"git_ref,omitempty"`  // Git branch, tag, or commit SHA (default: "main")
    GitPath string `json:"git_path,omitempty"` // Working directory within the cloned repo (default: ".")

    // SecretVarNames contains the environment variable names that should be treated as secrets.
    // This is populated by the service layer after resolving secrets from the Secrets field.
    // It includes both explicitly resolved secrets and pattern-detected sensitive variables.
    SecretVarNames []string `json:"-"` // Not serialized in API responses
}
```

<a name="ExecutionResponse"></a>
## type [ExecutionResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/executions.go#L28-L33>)

ExecutionResponse represents the response to an execution request

```go
type ExecutionResponse struct {
    ExecutionID string `json:"execution_id"`
    LogURL      string `json:"log_url"`
    Status      string `json:"status"`
    ImageID     string `json:"image_id"`
}
```

<a name="ExecutionStatusResponse"></a>
## type [ExecutionStatusResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/executions.go#L36-L42>)

ExecutionStatusResponse represents the current status of an execution

```go
type ExecutionStatusResponse struct {
    ExecutionID string     `json:"execution_id"`
    Status      string     `json:"status"`
    StartedAt   time.Time  `json:"started_at"`
    ExitCode    *int       `json:"exit_code"`
    CompletedAt *time.Time `json:"completed_at,omitempty"`
}
```

<a name="GetSecretRequest"></a>
## type [GetSecretRequest](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L56-L58>)

GetSecretRequest represents the request to retrieve a secret The secret name is provided in the URL path parameter

```go
type GetSecretRequest struct {
    Name string `json:"name"` // Secret name from URL path
}
```

<a name="GetSecretResponse"></a>
## type [GetSecretResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L61-L63>)

GetSecretResponse represents the response when retrieving a secret

```go
type GetSecretResponse struct {
    Secret *Secret `json:"secret"`
}
```

<a name="HealthIssue"></a>
## type [HealthIssue](<https://github.com/runvoy/runvoy/blob/main/internal/api/health.go#L63-L70>)

HealthIssue represents a single health issue found during reconciliation.

```go
type HealthIssue struct {
    // ResourceType is provider-specific resource type (e.g., "ecs_task_definition", "cloud_run_service")
    ResourceType string `json:"resource_type"`
    ResourceID   string `json:"resource_id"`
    Severity     string `json:"severity"` // "error", "warning"
    Message      string `json:"message"`
    Action       string `json:"action"` // "recreated", "requires_manual_intervention", "reported", "tag_updated"
}
```

<a name="HealthReconcileResponse"></a>
## type [HealthReconcileResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/health.go#L6-L9>)

HealthReconcileResponse is returned by POST /api/v1/health/reconcile.

```go
type HealthReconcileResponse struct {
    Status string        `json:"status"`
    Report *HealthReport `json:"report"`
}
```

<a name="HealthReport"></a>
## type [HealthReport](<https://github.com/runvoy/runvoy/blob/main/internal/api/health.go#L12-L21>)

HealthReport contains the results of a health reconciliation run.

```go
type HealthReport struct {
    Timestamp        time.Time              `json:"timestamp"`
    ComputeStatus    ComputeHealthStatus    `json:"compute_status"`
    SecretsStatus    SecretsHealthStatus    `json:"secrets_status"`
    IdentityStatus   IdentityHealthStatus   `json:"identity_status"`
    AuthorizerStatus AuthorizerHealthStatus `json:"authorizer_status"`
    Issues           []HealthIssue          `json:"issues"`
    ReconciledCount  int                    `json:"reconciled_count"`
    ErrorCount       int                    `json:"error_count"`
}
```

<a name="HealthResponse"></a>
## type [HealthResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/types.go#L13-L16>)

HealthResponse represents the response to a health check request

```go
type HealthResponse struct {
    Status  string `json:"status"`
    Version string `json:"version"`
}
```

<a name="IdentityHealthStatus"></a>
## type [IdentityHealthStatus](<https://github.com/runvoy/runvoy/blob/main/internal/api/health.go#L44-L49>)

IdentityHealthStatus contains the health status for identity and access management resources.

```go
type IdentityHealthStatus struct {
    DefaultRolesVerified bool     `json:"default_roles_verified"`
    CustomRolesVerified  int      `json:"custom_roles_verified"`
    CustomRolesTotal     int      `json:"custom_roles_total"`
    MissingRoles         []string `json:"missing_roles"`
}
```

<a name="ImageInfo"></a>
## type [ImageInfo](<https://github.com/runvoy/runvoy/blob/main/internal/api/images.go#L37-L55>)

ImageInfo represents information about a registered image

```go
type ImageInfo struct {
    ImageID               string    `json:"image_id"`
    Image                 string    `json:"image"`
    TaskDefinitionName    string    `json:"task_definition_name,omitempty"`
    IsDefault             *bool     `json:"is_default,omitempty"`
    TaskRoleName          *string   `json:"task_role_name,omitempty"`
    TaskExecutionRoleName *string   `json:"task_execution_role_name,omitempty"`
    CPU                   int       `json:"cpu,omitempty"`
    Memory                int       `json:"memory,omitempty"`
    RuntimePlatform       string    `json:"runtime_platform,omitempty"`
    ImageRegistry         string    `json:"image_registry,omitempty"`
    ImageName             string    `json:"image_name,omitempty"`
    ImageTag              string    `json:"image_tag,omitempty"`
    CreatedBy             string    `json:"created_by,omitempty"`
    OwnedBy               []string  `json:"owned_by"`
    CreatedAt             time.Time `json:"created_at"`
    CreatedByRequestID    string    `json:"created_by_request_id"`
    ModifiedByRequestID   string    `json:"modified_by_request_id"`
}
```

<a name="KillExecutionResponse"></a>
## type [KillExecutionResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/executions.go#L45-L48>)

KillExecutionResponse represents the response after killing an execution

```go
type KillExecutionResponse struct {
    ExecutionID string `json:"execution_id"`
    Message     string `json:"message"`
}
```

<a name="ListImagesResponse"></a>
## type [ListImagesResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/images.go#L58-L60>)

ListImagesResponse represents the response containing all registered images

```go
type ListImagesResponse struct {
    Images []ImageInfo `json:"images"`
}
```

<a name="ListSecretsRequest"></a>
## type [ListSecretsRequest](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L67-L69>)

ListSecretsRequest represents the request to list secrets Optionally filters by user email

```go
type ListSecretsRequest struct {
    CreatedBy string `json:"created_by,omitempty"` // Filter by user who created the secret
}
```

<a name="ListSecretsResponse"></a>
## type [ListSecretsResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L72-L75>)

ListSecretsResponse represents the response containing all secrets

```go
type ListSecretsResponse struct {
    Secrets []*Secret `json:"secrets"`
    Total   int       `json:"total"`
}
```

<a name="ListUsersResponse"></a>
## type [ListUsersResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/users.go#L65-L67>)

ListUsersResponse represents the response containing all users

```go
type ListUsersResponse struct {
    Users []*User `json:"users"`
}
```

<a name="LogEvent"></a>
## type [LogEvent](<https://github.com/runvoy/runvoy/blob/main/internal/api/logs.go#L7-L10>)

LogEvent represents a single log event. Events are ordered by timestamp. Clients should sort by timestamp and compute line numbers as needed for display purposes.

```go
type LogEvent struct {
    Timestamp int64  `json:"timestamp"` // Unix timestamp in milliseconds
    Message   string `json:"message"`   // The actual log message text
}
```

<a name="LogsResponse"></a>
## type [LogsResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/logs.go#L13-L22>)

LogsResponse contains all log events for an execution

```go
type LogsResponse struct {
    ExecutionID string     `json:"execution_id"`
    Events      []LogEvent `json:"events"`

    // Current execution status (RUNNING, SUCCEEDED, FAILED, STOPPED)
    Status string `json:"status"`

    // WebSocket URL for streaming logs (only provided if execution is RUNNING)
    WebSocketURL string `json:"websocket_url,omitempty"`
}
```

<a name="PendingAPIKey"></a>
## type [PendingAPIKey](<https://github.com/runvoy/runvoy/blob/main/internal/api/users.go#L34-L44>)

PendingAPIKey represents a pending API key awaiting claim

```go
type PendingAPIKey struct {
    SecretToken  string     `json:"secret_token"`
    APIKey       string     `json:"api_key"`
    UserEmail    string     `json:"user_email"`
    CreatedBy    string     `json:"created_by"`
    CreatedAt    time.Time  `json:"created_at"`
    ExpiresAt    int64      `json:"expires_at"` // Unix timestamp for TTL
    Viewed       bool       `json:"viewed"`
    ViewedAt     *time.Time `json:"viewed_at,omitempty"`
    ViewedFromIP string     `json:"viewed_from_ip,omitempty"`
}
```

<a name="Playbook"></a>
## type [Playbook](<https://github.com/runvoy/runvoy/blob/main/internal/api/playbooks.go#L5-L14>)

Playbook represents a reusable command execution configuration

```go
type Playbook struct {
    Description string            `yaml:"description,omitempty"`
    Image       string            `yaml:"image,omitempty"`
    GitRepo     string            `yaml:"git_repo,omitempty"`
    GitRef      string            `yaml:"git_ref,omitempty"`
    GitPath     string            `yaml:"git_path,omitempty"`
    Secrets     []string          `yaml:"secrets,omitempty"`
    Env         map[string]string `yaml:"env,omitempty"`
    Commands    []string          `yaml:"commands"`
}
```

<a name="RegisterImageRequest"></a>
## type [RegisterImageRequest](<https://github.com/runvoy/runvoy/blob/main/internal/api/images.go#L9-L17>)

RegisterImageRequest represents the request to register a new Docker image

```go
type RegisterImageRequest struct {
    Image                 string  `json:"image"`
    IsDefault             *bool   `json:"is_default,omitempty"`
    TaskRoleName          *string `json:"task_role_name,omitempty"`
    TaskExecutionRoleName *string `json:"task_execution_role_name,omitempty"`
    CPU                   *int    `json:"cpu,omitempty"`
    Memory                *int    `json:"memory,omitempty"`
    RuntimePlatform       *string `json:"runtime_platform,omitempty"`
}
```

<a name="RegisterImageResponse"></a>
## type [RegisterImageResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/images.go#L20-L23>)

RegisterImageResponse represents the response after registering an image

```go
type RegisterImageResponse struct {
    Image   string `json:"image"`
    Message string `json:"message"`
}
```

<a name="RelatedResources"></a>
## type [RelatedResources](<https://github.com/runvoy/runvoy/blob/main/internal/api/logs.go#L34-L39>)

RelatedResources contains all resources associated with a request ID

```go
type RelatedResources struct {
    Executions []*Execution `json:"executions,omitempty"`
    Secrets    []*Secret    `json:"secrets,omitempty"`
    Users      []*User      `json:"users,omitempty"`
    Images     []ImageInfo  `json:"images,omitempty"`
}
```

<a name="RemoveImageRequest"></a>
## type [RemoveImageRequest](<https://github.com/runvoy/runvoy/blob/main/internal/api/images.go#L26-L28>)

RemoveImageRequest represents the request to remove a Docker image

```go
type RemoveImageRequest struct {
    Image string `json:"image"`
}
```

<a name="RemoveImageResponse"></a>
## type [RemoveImageResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/images.go#L31-L34>)

RemoveImageResponse represents the response after removing an image

```go
type RemoveImageResponse struct {
    Image   string `json:"image"`
    Message string `json:"message"`
}
```

<a name="RevokeUserRequest"></a>
## type [RevokeUserRequest](<https://github.com/runvoy/runvoy/blob/main/internal/api/users.go#L54-L56>)

RevokeUserRequest represents the request to revoke a user's API key

```go
type RevokeUserRequest struct {
    Email string `json:"email"`
}
```

<a name="RevokeUserResponse"></a>
## type [RevokeUserResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/users.go#L59-L62>)

RevokeUserResponse represents the response after revoking a user

```go
type RevokeUserResponse struct {
    Message string `json:"message"`
    Email   string `json:"email"`
}
```

<a name="Secret"></a>
## type [Secret](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L10-L22>)

Secret represents a secret with its metadata and optionally its value

```go
type Secret struct {
    Name                string    `json:"name"`     // Internal identifier for the secret
    KeyName             string    `json:"key_name"` // Environment variable name (e.g., GITHUB_TOKEN)
    Description         string    `json:"description,omitempty"`
    Value               string    `json:"value,omitempty"`
    CreatedBy           string    `json:"created_by"`
    OwnedBy             []string  `json:"owned_by"`
    CreatedAt           time.Time `json:"created_at"`
    UpdatedAt           time.Time `json:"updated_at"`
    UpdatedBy           string    `json:"updated_by"`
    CreatedByRequestID  string    `json:"created_by_request_id"`
    ModifiedByRequestID string    `json:"modified_by_request_id"`
}
```

<a name="SecretsHealthStatus"></a>
## type [SecretsHealthStatus](<https://github.com/runvoy/runvoy/blob/main/internal/api/health.go#L34-L41>)

SecretsHealthStatus contains the health status for secrets/parameters.

```go
type SecretsHealthStatus struct {
    TotalSecrets       int      `json:"total_secrets"`
    VerifiedCount      int      `json:"verified_count"`
    TagUpdatedCount    int      `json:"tag_updated_count"`
    MissingCount       int      `json:"missing_count"`
    OrphanedCount      int      `json:"orphaned_count"`
    OrphanedParameters []string `json:"orphaned_parameters"`
}
```

<a name="TraceResponse"></a>
## type [TraceResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/logs.go#L25-L31>)

TraceResponse contains logs and related resources for a request ID

```go
type TraceResponse struct {
    // Logs retrieved from backend infrastructure
    Logs []LogEvent `json:"logs"`

    // Related resources associated with this request ID
    RelatedResources RelatedResources `json:"related_resources"`
}
```

<a name="UpdateSecretRequest"></a>
## type [UpdateSecretRequest](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L42-L46>)

UpdateSecretRequest represents the request to update a secret \(metadata and/or value\) Users can update: description, key\_name \(environment variable name\), and value. Description and KeyName are metadata fields. UpdatedAt is always refreshed. If Value is provided, the secret's value will be updated.

```go
type UpdateSecretRequest struct {
    Description string `json:"description,omitempty"` // Environment variable description
    KeyName     string `json:"key_name,omitempty"`    // Environment variable name (e.g., GITHUB_TOKEN)
    Value       string `json:"value,omitempty"`       // If provided, updates the secret value
}
```

<a name="UpdateSecretResponse"></a>
## type [UpdateSecretResponse](<https://github.com/runvoy/runvoy/blob/main/internal/api/secrets.go#L50-L52>)

UpdateSecretResponse represents the response after updating a secret To avoid exposing secret data, only a success message is returned.

```go
type UpdateSecretResponse struct {
    Message string `json:"message"`
}
```

<a name="User"></a>
## type [User](<https://github.com/runvoy/runvoy/blob/main/internal/api/users.go#L9-L18>)

User represents a user in the system

```go
type User struct {
    Email               string     `json:"email"`
    APIKey              string     `json:"api_key,omitempty"`
    Role                string     `json:"role"`
    CreatedAt           time.Time  `json:"created_at"`
    Revoked             bool       `json:"revoked"`
    LastUsed            *time.Time `json:"last_used,omitempty"`
    CreatedByRequestID  string     `json:"created_by_request_id"`
    ModifiedByRequestID string     `json:"modified_by_request_id"`
}
```

<a name="WebSocketConnection"></a>
## type [WebSocketConnection](<https://github.com/runvoy/runvoy/blob/main/internal/api/websocket.go#L5-L15>)

WebSocketConnection represents a WebSocket connection record

```go
type WebSocketConnection struct {
    ConnectionID  string `json:"connection_id"`
    ExecutionID   string `json:"execution_id"`
    Functionality string `json:"functionality"`
    ExpiresAt     int64  `json:"expires_at"`
    ClientIP      string `json:"client_ip,omitempty"`
    Token         string `json:"token,omitempty"`
    UserEmail     string `json:"user_email,omitempty"`
    // Client IP captured when the websocket token was created (for tracing)
    TokenRequestClientIP string `json:"token_request_client_ip,omitempty"`
}
```

<a name="WebSocketDisconnectReason"></a>
## type [WebSocketDisconnectReason](<https://github.com/runvoy/runvoy/blob/main/internal/api/websocket.go#L39>)

WebSocketDisconnectReason represents the reason for a disconnect

```go
type WebSocketDisconnectReason string
```

<a name="WebSocketDisconnectReasonExecutionCompleted"></a>

```go
const (
    // WebSocketDisconnectReasonExecutionCompleted indicates the execution has completed
    WebSocketDisconnectReasonExecutionCompleted WebSocketDisconnectReason = "execution_completed"
)
```

<a name="WebSocketMessage"></a>
## type [WebSocketMessage](<https://github.com/runvoy/runvoy/blob/main/internal/api/websocket.go#L47-L52>)

WebSocketMessage represents a WebSocket message sent to clients

```go
type WebSocketMessage struct {
    Type      WebSocketMessageType       `json:"type"`
    Reason    *WebSocketDisconnectReason `json:"reason,omitempty"`
    Message   *string                    `json:"message,omitempty"`
    Timestamp *int64                     `json:"timestamp,omitempty"`
}
```

<a name="WebSocketMessageType"></a>
## type [WebSocketMessageType](<https://github.com/runvoy/runvoy/blob/main/internal/api/websocket.go#L29>)

WebSocketMessageType represents the type of WebSocket message

```go
type WebSocketMessageType string
```

<a name="WebSocketMessageTypeLog"></a>

```go
const (
    // WebSocketMessageTypeLog represents a log event message
    WebSocketMessageTypeLog WebSocketMessageType = "log"
    // WebSocketMessageTypeDisconnect represents a disconnect notification message
    WebSocketMessageTypeDisconnect WebSocketMessageType = "disconnect"
)
```

<a name="WebSocketToken"></a>
## type [WebSocketToken](<https://github.com/runvoy/runvoy/blob/main/internal/api/websocket.go#L18-L26>)

WebSocketToken represents a WebSocket authentication token

```go
type WebSocketToken struct {
    Token       string `json:"token"`
    ExecutionID string `json:"execution_id"`
    UserEmail   string `json:"user_email,omitempty"`
    // Client IP captured when the websocket token was created (for tracing)
    ClientIP  string `json:"client_ip,omitempty"`
    ExpiresAt int64  `json:"expires_at"`
    CreatedAt int64  `json:"created_at"`
}
```

# auth

```go
import "runvoy/internal/auth"
```

Package auth provides authentication utilities for runvoy.

## Index

- [func GenerateSecretToken\(\) \(string, error\)](<#GenerateSecretToken>)
- [func GenerateUUID\(\) string](<#GenerateUUID>)
- [func HashAPIKey\(apiKey string\) string](<#HashAPIKey>)


<a name="GenerateSecretToken"></a>
## func [GenerateSecretToken](<https://github.com/runvoy/runvoy/blob/main/internal/auth/auth.go#L25>)

```go
func GenerateSecretToken() (string, error)
```

GenerateSecretToken creates a cryptographically secure random secret token. Used for claim URLs, WebSocket authentication, and other temporary access tokens. The token is base64\-encoded and approximately 32 characters long.

<a name="GenerateUUID"></a>
## func [GenerateUUID](<https://github.com/runvoy/runvoy/blob/main/internal/auth/auth.go#L37>)

```go
func GenerateUUID() string
```

GenerateUUID generates a UUID\-like identifier using crypto/rand. Returns a hex\-encoded string of 32 characters \(16 random bytes\). Used for generating unique identifiers such as task definition family names.

<a name="HashAPIKey"></a>
## func [HashAPIKey](<https://github.com/runvoy/runvoy/blob/main/internal/auth/auth.go#L16>)

```go
func HashAPIKey(apiKey string) string
```

HashAPIKey creates a SHA\-256 hash of the API key for secure storage. NOTICE: we never store plain API keys in the database.

# client

```go
import "runvoy/internal/client"
```

Package client provides HTTP client functionality for the runvoy API. It handles authentication, request/response serialization, and error handling.

Package client provides HTTP client functionality for the runvoy API.

## Index

- [type Client](<#Client>)
  - [func New\(cfg \*config.Config, log \*slog.Logger\) \*Client](<#New>)
  - [func \(c \*Client\) ClaimAPIKey\(ctx context.Context, token string\) \(\*api.ClaimAPIKeyResponse, error\)](<#Client.ClaimAPIKey>)
  - [func \(c \*Client\) CreateSecret\(ctx context.Context, req api.CreateSecretRequest\) \(\*api.CreateSecretResponse, error\)](<#Client.CreateSecret>)
  - [func \(c \*Client\) CreateUser\(ctx context.Context, req api.CreateUserRequest\) \(\*api.CreateUserResponse, error\)](<#Client.CreateUser>)
  - [func \(c \*Client\) DeleteSecret\(ctx context.Context, name string\) \(\*api.DeleteSecretResponse, error\)](<#Client.DeleteSecret>)
  - [func \(c \*Client\) Do\(ctx context.Context, req Request\) \(\*Response, error\)](<#Client.Do>)
  - [func \(c \*Client\) DoJSON\(ctx context.Context, req Request, result any\) error](<#Client.DoJSON>)
  - [func \(c \*Client\) FetchBackendLogs\(ctx context.Context, requestID string\) \(\*api.TraceResponse, error\)](<#Client.FetchBackendLogs>)
  - [func \(c \*Client\) GetExecutionStatus\(ctx context.Context, executionID string\) \(\*api.ExecutionStatusResponse, error\)](<#Client.GetExecutionStatus>)
  - [func \(c \*Client\) GetHealth\(ctx context.Context\) \(\*api.HealthResponse, error\)](<#Client.GetHealth>)
  - [func \(c \*Client\) GetImage\(ctx context.Context, image string\) \(\*api.ImageInfo, error\)](<#Client.GetImage>)
  - [func \(c \*Client\) GetLogs\(ctx context.Context, executionID string\) \(\*api.LogsResponse, error\)](<#Client.GetLogs>)
  - [func \(c \*Client\) GetSecret\(ctx context.Context, name string\) \(\*api.GetSecretResponse, error\)](<#Client.GetSecret>)
  - [func \(c \*Client\) KillExecution\(ctx context.Context, executionID string\) \(\*api.KillExecutionResponse, error\)](<#Client.KillExecution>)
  - [func \(c \*Client\) ListExecutions\(ctx context.Context, limit int, statuses string\) \(\[\]api.Execution, error\)](<#Client.ListExecutions>)
  - [func \(c \*Client\) ListImages\(ctx context.Context\) \(\*api.ListImagesResponse, error\)](<#Client.ListImages>)
  - [func \(c \*Client\) ListSecrets\(ctx context.Context\) \(\*api.ListSecretsResponse, error\)](<#Client.ListSecrets>)
  - [func \(c \*Client\) ListUsers\(ctx context.Context\) \(\*api.ListUsersResponse, error\)](<#Client.ListUsers>)
  - [func \(c \*Client\) ReconcileHealth\(ctx context.Context\) \(\*api.HealthReconcileResponse, error\)](<#Client.ReconcileHealth>)
  - [func \(c \*Client\) RegisterImage\(ctx context.Context, image string, isDefault \*bool, taskRoleName, taskExecutionRoleName \*string, cpu, memory \*int, runtimePlatform \*string\) \(\*api.RegisterImageResponse, error\)](<#Client.RegisterImage>)
  - [func \(c \*Client\) RevokeUser\(ctx context.Context, req api.RevokeUserRequest\) \(\*api.RevokeUserResponse, error\)](<#Client.RevokeUser>)
  - [func \(c \*Client\) RunCommand\(ctx context.Context, req \*api.ExecutionRequest\) \(\*api.ExecutionResponse, error\)](<#Client.RunCommand>)
  - [func \(c \*Client\) UnregisterImage\(ctx context.Context, image string\) \(\*api.RemoveImageResponse, error\)](<#Client.UnregisterImage>)
  - [func \(c \*Client\) UpdateSecret\(ctx context.Context, name string, req api.UpdateSecretRequest\) \(\*api.UpdateSecretResponse, error\)](<#Client.UpdateSecret>)
- [type Interface](<#Interface>)
- [type Request](<#Request>)
- [type Response](<#Response>)


<a name="Client"></a>
## type [Client](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L23-L26>)

Client provides a generic HTTP client for API operations

```go
type Client struct {
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func [New](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L29>)

```go
func New(cfg *config.Config, log *slog.Logger) *Client
```

New creates a new API client

<a name="Client.ClaimAPIKey"></a>
### func \(\*Client\) [ClaimAPIKey](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L385>)

```go
func (c *Client) ClaimAPIKey(ctx context.Context, token string) (*api.ClaimAPIKeyResponse, error)
```

ClaimAPIKey claims a user's API key

<a name="Client.CreateSecret"></a>
### func \(\*Client\) [CreateSecret](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L467>)

```go
func (c *Client) CreateSecret(ctx context.Context, req api.CreateSecretRequest) (*api.CreateSecretResponse, error)
```

CreateSecret creates a new secret

<a name="Client.CreateUser"></a>
### func \(\*Client\) [CreateUser](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L192>)

```go
func (c *Client) CreateUser(ctx context.Context, req api.CreateUserRequest) (*api.CreateUserResponse, error)
```

CreateUser creates a new user using the API

<a name="Client.DeleteSecret"></a>
### func \(\*Client\) [DeleteSecret](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L525>)

```go
func (c *Client) DeleteSecret(ctx context.Context, name string) (*api.DeleteSecretResponse, error)
```

DeleteSecret deletes a secret by name

<a name="Client.Do"></a>
### func \(\*Client\) [Do](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L116>)

```go
func (c *Client) Do(ctx context.Context, req Request) (*Response, error)
```

Do makes an HTTP request to the API

<a name="Client.DoJSON"></a>
### func \(\*Client\) [DoJSON](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L163>)

```go
func (c *Client) DoJSON(ctx context.Context, req Request, result any) error
```

DoJSON makes a request and unmarshals the response into the provided interface

<a name="Client.FetchBackendLogs"></a>
### func \(\*Client\) [FetchBackendLogs](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L292>)

```go
func (c *Client) FetchBackendLogs(ctx context.Context, requestID string) (*api.TraceResponse, error)
```

FetchBackendLogs fetches backend infrastructure logs and related resources for a request ID

<a name="Client.GetExecutionStatus"></a>
### func \(\*Client\) [GetExecutionStatus](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L305>)

```go
func (c *Client) GetExecutionStatus(ctx context.Context, executionID string) (*api.ExecutionStatusResponse, error)
```

GetExecutionStatus gets the status of an execution

<a name="Client.GetHealth"></a>
### func \(\*Client\) [GetHealth](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L236>)

```go
func (c *Client) GetHealth(ctx context.Context) (*api.HealthResponse, error)
```

GetHealth checks the API health status

<a name="Client.GetImage"></a>
### func \(\*Client\) [GetImage](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L440>)

```go
func (c *Client) GetImage(ctx context.Context, image string) (*api.ImageInfo, error)
```

GetImage retrieves a single container image by ID or name

<a name="Client.GetLogs"></a>
### func \(\*Client\) [GetLogs](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L279>)

```go
func (c *Client) GetLogs(ctx context.Context, executionID string) (*api.LogsResponse, error)
```

GetLogs gets the logs for an execution The response includes a WebSocketURL field for streaming logs if WebSocket is configured

<a name="Client.GetSecret"></a>
### func \(\*Client\) [GetSecret](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L481>)

```go
func (c *Client) GetSecret(ctx context.Context, name string) (*api.GetSecretResponse, error)
```

GetSecret retrieves a secret by name

<a name="Client.KillExecution"></a>
### func \(\*Client\) [KillExecution](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L319>)

```go
func (c *Client) KillExecution(ctx context.Context, executionID string) (*api.KillExecutionResponse, error)
```

KillExecution stops a running execution by its ID Returns nil response if the execution was already terminated \(204 No Content\)

<a name="Client.ListExecutions"></a>
### func \(\*Client\) [ListExecutions](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L354>)

```go
func (c *Client) ListExecutions(ctx context.Context, limit int, statuses string) ([]api.Execution, error)
```

ListExecutions fetches executions with optional filtering and pagination. Parameters:

- limit: maximum number of executions to return \(0 returns all\)
- statuses: comma\-separated list of execution statuses to filter by \(e.g., "RUNNING,TERMINATING"\)

<a name="Client.ListImages"></a>
### func \(\*Client\) [ListImages](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L427>)

```go
func (c *Client) ListImages(ctx context.Context) (*api.ListImagesResponse, error)
```

ListImages retrieves all registered container images

<a name="Client.ListSecrets"></a>
### func \(\*Client\) [ListSecrets](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L494>)

```go
func (c *Client) ListSecrets(ctx context.Context) (*api.ListSecretsResponse, error)
```

ListSecrets lists all secrets

<a name="Client.ListUsers"></a>
### func \(\*Client\) [ListUsers](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L222>)

```go
func (c *Client) ListUsers(ctx context.Context) (*api.ListUsersResponse, error)
```

ListUsers lists all users

<a name="Client.ReconcileHealth"></a>
### func \(\*Client\) [ReconcileHealth](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L265>)

```go
func (c *Client) ReconcileHealth(ctx context.Context) (*api.HealthReconcileResponse, error)
```

ReconcileHealth triggers a full health reconciliation on the server. Requires authentication and returns a reconciliation report.

<a name="Client.RegisterImage"></a>
### func \(\*Client\) [RegisterImage](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L398-L405>)

```go
func (c *Client) RegisterImage(ctx context.Context, image string, isDefault *bool, taskRoleName, taskExecutionRoleName *string, cpu, memory *int, runtimePlatform *string) (*api.RegisterImageResponse, error)
```

RegisterImage registers a new container image for execution, optionally marking it as the default

<a name="Client.RevokeUser"></a>
### func \(\*Client\) [RevokeUser](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L207>)

```go
func (c *Client) RevokeUser(ctx context.Context, req api.RevokeUserRequest) (*api.RevokeUserResponse, error)
```

RevokeUser revokes a user's API key

<a name="Client.RunCommand"></a>
### func \(\*Client\) [RunCommand](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L250>)

```go
func (c *Client) RunCommand(ctx context.Context, req *api.ExecutionRequest) (*api.ExecutionResponse, error)
```

RunCommand executes a command remotely via the runvoy API.

<a name="Client.UnregisterImage"></a>
### func \(\*Client\) [UnregisterImage](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L454>)

```go
func (c *Client) UnregisterImage(ctx context.Context, image string) (*api.RemoveImageResponse, error)
```

UnregisterImage removes a container image from the registry

<a name="Client.UpdateSecret"></a>
### func \(\*Client\) [UpdateSecret](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L507-L511>)

```go
func (c *Client) UpdateSecret(ctx context.Context, name string, req api.UpdateSecretRequest) (*api.UpdateSecretResponse, error)
```

UpdateSecret updates a secret by name

<a name="Interface"></a>
## type [Interface](<https://github.com/runvoy/runvoy/blob/main/internal/client/interface.go#L11-L40>)

Interface defines the API client interface for dependency injection and testing

```go
type Interface interface {
    // Health
    ReconcileHealth(ctx context.Context) (*api.HealthReconcileResponse, error)
    GetLogs(ctx context.Context, executionID string) (*api.LogsResponse, error)
    FetchBackendLogs(ctx context.Context, requestID string) (*api.TraceResponse, error)
    GetExecutionStatus(ctx context.Context, executionID string) (*api.ExecutionStatusResponse, error)
    RunCommand(ctx context.Context, req *api.ExecutionRequest) (*api.ExecutionResponse, error)
    KillExecution(ctx context.Context, executionID string) (*api.KillExecutionResponse, error)
    ListExecutions(ctx context.Context, limit int, statuses string) ([]api.Execution, error)
    ClaimAPIKey(ctx context.Context, token string) (*api.ClaimAPIKeyResponse, error)
    CreateUser(ctx context.Context, req api.CreateUserRequest) (*api.CreateUserResponse, error)
    RevokeUser(ctx context.Context, req api.RevokeUserRequest) (*api.RevokeUserResponse, error)
    ListUsers(ctx context.Context) (*api.ListUsersResponse, error)
    RegisterImage(
        ctx context.Context,
        image string,
        isDefault *bool,
        taskRoleName, taskExecutionRoleName *string,
        cpu, memory *int,
        runtimePlatform *string,
    ) (*api.RegisterImageResponse, error)
    ListImages(ctx context.Context) (*api.ListImagesResponse, error)
    GetImage(ctx context.Context, image string) (*api.ImageInfo, error)
    UnregisterImage(ctx context.Context, image string) (*api.RemoveImageResponse, error)
    CreateSecret(ctx context.Context, req api.CreateSecretRequest) (*api.CreateSecretResponse, error)
    GetSecret(ctx context.Context, name string) (*api.GetSecretResponse, error)
    ListSecrets(ctx context.Context) (*api.ListSecretsResponse, error)
    UpdateSecret(ctx context.Context, name string, req api.UpdateSecretRequest) (*api.UpdateSecretResponse, error)
    DeleteSecret(ctx context.Context, name string) (*api.DeleteSecretResponse, error)
}
```

<a name="Request"></a>
## type [Request](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L37-L41>)

Request represents an API request

```go
type Request struct {
    Method string
    Path   string
    Body   any
}
```

<a name="Response"></a>
## type [Response](<https://github.com/runvoy/runvoy/blob/main/internal/client/client.go#L44-L47>)

Response represents an API response

```go
type Response struct {
    StatusCode int
    Body       []byte
}
```

# config

```go
import "runvoy/internal/config"
```

Package config manages configuration for the runvoy CLI and services. It uses Viper for unified configuration management from files and environment variables.

## Index

- [func GetConfigPath\(\) \(string, error\)](<#GetConfigPath>)
- [func Save\(config \*Config\) error](<#Save>)
- [type Config](<#Config>)
  - [func Load\(\) \(\*Config, error\)](<#Load>)
  - [func LoadCLI\(\) \(\*Config, error\)](<#LoadCLI>)
  - [func LoadEventProcessor\(\) \(\*Config, error\)](<#LoadEventProcessor>)
  - [func LoadOrchestrator\(\) \(\*Config, error\)](<#LoadOrchestrator>)
  - [func MustLoadEventProcessor\(\) \*Config](<#MustLoadEventProcessor>)
  - [func MustLoadOrchestrator\(\) \*Config](<#MustLoadOrchestrator>)
  - [func \(c \*Config\) GetDefaultStackName\(\) string](<#Config.GetDefaultStackName>)
  - [func \(c \*Config\) GetLogLevel\(\) slog.Level](<#Config.GetLogLevel>)
  - [func \(c \*Config\) GetProviderIdentifier\(\) string](<#Config.GetProviderIdentifier>)


<a name="GetConfigPath"></a>
## func [GetConfigPath](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L242>)

```go
func GetConfigPath() (string, error)
```

GetConfigPath returns the path to the config file

<a name="Save"></a>
## func [Save](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L200>)

```go
func Save(config *Config) error
```

Save saves the configuration to the user's home directory. Overwrites the existing config file if it exists.

<a name="Config"></a>
## type [Config](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L26-L44>)

Config represents the unified configuration structure for both CLI and services. It supports loading from YAML files and environment variables. Provider\-specific configurations are nested under their respective provider keys.

```go
type Config struct {
    // CLI Configuration
    APIEndpoint string `mapstructure:"api_endpoint" yaml:"api_endpoint" validate:"omitempty,url"`
    APIKey      string `mapstructure:"api_key" yaml:"api_key"`
    WebURL      string `mapstructure:"web_url" yaml:"web_url" validate:"omitempty,url"`

    // Backend Service Configuration
    BackendProvider    constants.BackendProvider `mapstructure:"backend_provider" yaml:"backend_provider"`
    InitTimeout        time.Duration             `mapstructure:"init_timeout"`
    LogLevel           string                    `mapstructure:"log_level"`
    Port               int                       `mapstructure:"port" validate:"omitempty"`
    RequestTimeout     time.Duration             `mapstructure:"request_timeout"`
    CORSAllowedOrigins []string                  `mapstructure:"cors_allowed_origins" yaml:"cors_allowed_origins"`

    // Provider-specific configurations
    AWS *awsconfig.Config `mapstructure:"aws" yaml:"aws,omitempty"`
}
```

<a name="Load"></a>
### func [Load](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L52>)

```go
func Load() (*Config, error)
```

Load loads the configuration using Viper. For CLI: loads from \~/.runvoy/config.yaml For services: loads from environment variables with RUNVOY\_ prefix Environment variables take precedence over config file values.

<a name="LoadCLI"></a>
### func [LoadCLI](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L102>)

```go
func LoadCLI() (*Config, error)
```

LoadCLI loads configuration specifically for CLI usage. Returns an error if the config file doesn't exist.

<a name="LoadEventProcessor"></a>
### func [LoadEventProcessor](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L149>)

```go
func LoadEventProcessor() (*Config, error)
```

LoadEventProcessor loads configuration for the event processor service. Loads from environment variables and validates required fields.

<a name="LoadOrchestrator"></a>
### func [LoadOrchestrator](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L120>)

```go
func LoadOrchestrator() (*Config, error)
```

LoadOrchestrator loads configuration for the orchestrator service. Loads from environment variables and validates required fields. This maintains parity with the Lambda orchestrator which requires all AWS resources.

<a name="MustLoadEventProcessor"></a>
### func [MustLoadEventProcessor](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L189>)

```go
func MustLoadEventProcessor() *Config
```

MustLoadEventProcessor loads event processor configuration and exits on error. Suitable for application startup where configuration errors should be fatal.

<a name="MustLoadOrchestrator"></a>
### func [MustLoadOrchestrator](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L178>)

```go
func MustLoadOrchestrator() *Config
```

MustLoadOrchestrator loads orchestrator configuration and exits on error. Suitable for application startup where configuration errors should be fatal.

<a name="Config.GetDefaultStackName"></a>
### func \(\*Config\) [GetDefaultStackName](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L264>)

```go
func (c *Config) GetDefaultStackName() string
```

GetDefaultStackName returns the default infrastructure stack name. Returns the configured value or the default if not set.

<a name="Config.GetLogLevel"></a>
### func \(\*Config\) [GetLogLevel](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L254>)

```go
func (c *Config) GetLogLevel() slog.Level
```

GetLogLevel returns the slog.Level from the string configuration. Defaults to INFO if the level string is invalid.

<a name="Config.GetProviderIdentifier"></a>
### func \(\*Config\) [GetProviderIdentifier](<https://github.com/runvoy/runvoy/blob/main/internal/config/config.go#L273>)

```go
func (c *Config) GetProviderIdentifier() string
```

GetProviderIdentifier returns the lowercase provider identifier string. For AWS, returns "aws".

# constants

```go
import "runvoy/internal/constants"
```

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

Package constants defines global constants used throughout runvoy.

## Index

- [Constants](<#constants>)
- [Variables](<#variables>)
- [func CanTransition\(from, to ExecutionStatus\) bool](<#CanTransition>)
- [func ConfigDirPath\(homeDir string\) string](<#ConfigDirPath>)
- [func ConfigFilePath\(homeDir string\) string](<#ConfigFilePath>)
- [func GetVersion\(\) \*string](<#GetVersion>)
- [type BackendProvider](<#BackendProvider>)
- [type ConfigCtxKeyType](<#ConfigCtxKeyType>)
- [type Environment](<#Environment>)
- [type ExecutionStatus](<#ExecutionStatus>)
  - [func TerminalExecutionStatuses\(\) \[\]ExecutionStatus](<#TerminalExecutionStatuses>)
- [type Service](<#Service>)
- [type StartTimeCtxKeyType](<#StartTimeCtxKeyType>)


## Constants

<a name="APIKeyByteSize"></a>APIKeyByteSize is the number of random bytes used to generate API keys

```go
const APIKeyByteSize = 24
```

<a name="APIKeyHeader"></a>APIKeyHeader is the HTTP header name for API key authentication

```go
const APIKeyHeader = "X-API-Key"
```

<a name="BoxBorderPadding"></a>BoxBorderPadding is the padding used in box borders

```go
const BoxBorderPadding = 2
```

<a name="ClaimURLExpirationMinutes"></a>ClaimURLExpirationMinutes is the number of minutes after which a claim URL expires

```go
const ClaimURLExpirationMinutes = 15
```

<a name="ConfigDirName"></a>ConfigDirName is the name of the configuration directory in the user's home directory

```go
const ConfigDirName = "." + ProjectName
```

<a name="ConfigDirPermissions"></a>ConfigDirPermissions is the file system permissions for config directory \(0750\)

```go
const ConfigDirPermissions = 0750
```

<a name="ConfigFileName"></a>ConfigFileName is the name of the global configuration file

```go
const ConfigFileName = "config.yaml"
```

<a name="ConfigFilePermissions"></a>ConfigFilePermissions is the file system permissions for config file \(0600\)

```go
const ConfigFilePermissions = 0600
```

<a name="ConnectionTTLHours"></a>ConnectionTTLHours is the time\-to\-live for connection records in the database \(24 hours\)

```go
const ConnectionTTLHours = 24
```

<a name="ContentTypeHeader"></a>ContentTypeHeader is the HTTP Content\-Type header name.

```go
const ContentTypeHeader = "Content-Type"
```

<a name="DefaultContextTimeout"></a>DefaultContextTimeout is the default timeout for context operations

```go
const DefaultContextTimeout = 10 * time.Second
```

<a name="DefaultGitRef"></a>DefaultGitRef is the default Git reference to use if no reference is provided

```go
const DefaultGitRef = "main"
```

<a name="DefaultWebURL"></a>DefaultWebURL is the default URL of the web application HTML file. This can be overridden via configuration \(RUNVOY\_WEB\_URL env var or config file\).

```go
const DefaultWebURL = "https://runvoy.site/"
```

<a name="EnvVarSplitLimit"></a>EnvVarSplitLimit is the limit for splitting environment variable strings \(KEY=VALUE\)

```go
const EnvVarSplitLimit = 2
```

<a name="ExecutionsSliceInitialCapacity"></a>ExecutionsSliceInitialCapacity is the initial capacity for executions slices

```go
const ExecutionsSliceInitialCapacity = 64
```

<a name="ExpectedArgsCreateConfigFile"></a>ExpectedArgsCreateConfigFile is the expected number of arguments for create\-config\-file script

```go
const ExpectedArgsCreateConfigFile = 2
```

<a name="ExpectedArgsSeedAdminUser"></a>ExpectedArgsSeedAdminUser is the expected number of arguments for seed\-admin\-user script

```go
const ExpectedArgsSeedAdminUser = 3
```

<a name="ExpectedArgsTruncateDynamoDBTable"></a>ExpectedArgsTruncateDynamoDBTable is the expected number of arguments for truncate\-dynamodb\-table script

```go
const ExpectedArgsTruncateDynamoDBTable = 2
```

<a name="FunctionalityLogStreaming"></a>FunctionalityLogStreaming identifies connections used for streaming execution logs

```go
const FunctionalityLogStreaming = "log_streaming"
```

<a name="HTTPStatusBadRequest"></a>HTTPStatusBadRequest is the HTTP status code for bad requests \(400\)

```go
const HTTPStatusBadRequest = 400
```

<a name="HTTPStatusServerError"></a>HTTPStatusServerError is the HTTP status code for server errors \(500\)

```go
const HTTPStatusServerError = 500
```

<a name="HeaderSeparatorLength"></a>HeaderSeparatorLength is the length of the header separator line

```go
const HeaderSeparatorLength = 50
```

<a name="LocalDevelopmentURL"></a>LocalDevelopmentURL is the default URL of the local development server.

```go
const LocalDevelopmentURL = "http://localhost:5173/"
```

<a name="LongScriptContextTimeout"></a>LongScriptContextTimeout is the timeout for longer script context operations

```go
const LongScriptContextTimeout = 30 * time.Second
```

<a name="MaxConcurrentSends"></a>MaxConcurrentSends is the maximum number of concurrent sends to WebSocket connections

```go
const MaxConcurrentSends = 10
```

<a name="MillisecondsPerSecond"></a>MillisecondsPerSecond is the number of milliseconds in a second

```go
const MillisecondsPerSecond = 1000
```

<a name="MinimumArgsDeleteS3Buckets"></a>MinimumArgsDeleteS3Buckets is the minimum number of arguments for delete\-s3\-buckets script \(script name \+ at least 1 bucket\)

```go
const MinimumArgsDeleteS3Buckets = 2
```

<a name="MinimumArgsUpdateReadmeHelp"></a>MinimumArgsUpdateReadmeHelp is the minimum number of arguments for update\-readme\-help script

```go
const MinimumArgsUpdateReadmeHelp = 2
```

<a name="MinutesPerHour"></a>MinutesPerHour is the number of minutes in an hour

```go
const MinutesPerHour = 60
```

<a name="PercentageMultiplier"></a>PercentageMultiplier is the multiplier to convert fraction to percentage

```go
const PercentageMultiplier = 100
```

<a name="PlaybookDirName"></a>PlaybookDirName is the name of the playbook directory in the current working directory

```go
const PlaybookDirName = ".runvoy"
```

<a name="ProgressBarWidth"></a>ProgressBarWidth is the default width for progress bars

```go
const ProgressBarWidth = 40
```

<a name="ProjectName"></a>ProjectName is the name of the CLI tool and application

```go
const ProjectName = "runvoy"
```

<a name="RegexMatchCountEnvVar"></a>RegexMatchCountEnvVar is the expected number of regex matches for environment variable parsing

```go
const RegexMatchCountEnvVar = 3
```

<a name="RequestIDLogField"></a>RequestIDLogField is the field name used for request ID in log entries

```go
const RequestIDLogField = "request_id"
```

<a name="ResourceApplicationTagKey"></a>ResourceApplicationTagKey is the tag key for Application. This tag is used to identify the application that manages a resource.

```go
const ResourceApplicationTagKey = "Application"
```

<a name="ResourceManagedByTagKey"></a>ResourceManagedByTagKey is the tag key for ManagedBy. This tag is used to identify what system or tool manages a resource.

```go
const ResourceManagedByTagKey = "ManagedBy"
```

<a name="ScriptContextTimeout"></a>ScriptContextTimeout is the timeout for script context operations

```go
const ScriptContextTimeout = 10 * time.Second
```

<a name="SecondsPerMinute"></a>SecondsPerMinute is the number of seconds in a minute

```go
const SecondsPerMinute = 60
```

<a name="SecretTokenByteSize"></a>SecretTokenByteSize is the number of random bytes used to generate secret tokens

```go
const SecretTokenByteSize = 24
```

<a name="ServerIdleTimeout"></a>ServerIdleTimeout is the HTTP server idle timeout

```go
const ServerIdleTimeout = 60 * time.Second
```

<a name="ServerReadTimeout"></a>ServerReadTimeout is the HTTP server read timeout

```go
const ServerReadTimeout = 15 * time.Second
```

<a name="ServerShutdownTimeout"></a>ServerShutdownTimeout is the timeout for graceful server shutdown

```go
const ServerShutdownTimeout = 5 * time.Second
```

<a name="ServerWriteTimeout"></a>ServerWriteTimeout is the HTTP server write timeout

```go
const ServerWriteTimeout = 15 * time.Second
```

<a name="SpinnerTickerInterval"></a>SpinnerTickerInterval is the interval between spinner frame updates

```go
const SpinnerTickerInterval = 80 * time.Millisecond
```

<a name="TestContextTimeout"></a>TestContextTimeout is the timeout for test contexts

```go
const TestContextTimeout = 5 * time.Second
```

<a name="UUIDByteSize"></a>UUIDByteSize is the number of random bytes used to generate UUIDs 16 bytes = 128 bits, same as a UUID

```go
const UUIDByteSize = 16
```

## Variables

<a name="DefaultCORSAllowedOrigins"></a>DefaultCORSAllowedOrigins is the default list of allowed CORS origins. Defaults to the web application URL and local development URL.

```go
var DefaultCORSAllowedOrigins = []string{
    DefaultWebURL,
    LocalDevelopmentURL,
}
```

<a name="PlaybookFileExtensions"></a>PlaybookFileExtensions are the valid file extensions for playbook files

```go
var PlaybookFileExtensions = []string{".yaml", ".yml"}
```

<a name="CanTransition"></a>
## func [CanTransition](<https://github.com/runvoy/runvoy/blob/main/internal/constants/execution.go#L54>)

```go
func CanTransition(from, to ExecutionStatus) bool
```

CanTransition checks if a status transition from 'from' to 'to' is valid. Returns true if the transition is allowed, false otherwise. If the source status is not in the validTransitions map, returns false.

<a name="ConfigDirPath"></a>
## func [ConfigDirPath](<https://github.com/runvoy/runvoy/blob/main/internal/constants/config.go#L25>)

```go
func ConfigDirPath(homeDir string) string
```

ConfigDirPath returns the full path to the global configuration directory.

<a name="ConfigFilePath"></a>
## func [ConfigFilePath](<https://github.com/runvoy/runvoy/blob/main/internal/constants/config.go#L30>)

```go
func ConfigFilePath(homeDir string) string
```

ConfigFilePath returns the full path to the global configuration file

<a name="GetVersion"></a>
## func [GetVersion](<https://github.com/runvoy/runvoy/blob/main/internal/constants/version.go#L7>)

```go
func GetVersion() *string
```

GetVersion returns the current version of runvoy.

<a name="BackendProvider"></a>
## type [BackendProvider](<https://github.com/runvoy/runvoy/blob/main/internal/constants/types.go#L5>)

BackendProvider represents the backend infrastructure provider.

```go
type BackendProvider string
```

<a name="AWS"></a>

```go
const (
    // AWS is the Amazon Web Services backend provider.
    AWS BackendProvider = "AWS"
)
```

<a name="ConfigCtxKeyType"></a>
## type [ConfigCtxKeyType](<https://github.com/runvoy/runvoy/blob/main/internal/constants/context.go#L5>)

ConfigCtxKeyType is the type for the config context key

```go
type ConfigCtxKeyType string
```

<a name="ConfigCtxKey"></a>ConfigCtxKey is the key used to store config in context

```go
const ConfigCtxKey ConfigCtxKeyType = "config"
```

<a name="Environment"></a>
## type [Environment](<https://github.com/runvoy/runvoy/blob/main/internal/constants/types.go#L14>)

Environment represents the execution environment \(e.g., CLI, Lambda\).

```go
type Environment string
```

<a name="Development"></a>Environment types for logger configuration

```go
const (
    Development Environment = "development"
    Production  Environment = "production"
    CLI         Environment = "cli"
)
```

<a name="ExecutionStatus"></a>
## type [ExecutionStatus](<https://github.com/runvoy/runvoy/blob/main/internal/constants/execution.go#L9>)

ExecutionStatus represents the business\-level status of a command execution. This is distinct from EcsStatus, which reflects the AWS ECS task lifecycle. Execution statuses are used throughout the API and stored in the database.

```go
type ExecutionStatus string
```

<a name="ExecutionStarting"></a>

```go
const (
    // ExecutionStarting indicates the command has been accepted and is being scheduled
    ExecutionStarting ExecutionStatus = "STARTING"
    // ExecutionRunning indicates the command is currently executing
    ExecutionRunning ExecutionStatus = "RUNNING"
    // ExecutionSucceeded indicates the command completed successfully
    ExecutionSucceeded ExecutionStatus = "SUCCEEDED"
    // ExecutionFailed indicates the command failed with an error
    ExecutionFailed ExecutionStatus = "FAILED"
    // ExecutionStopped indicates the command was manually terminated
    ExecutionStopped ExecutionStatus = "STOPPED"
    // ExecutionTerminating indicates a stop request is in progress
    ExecutionTerminating ExecutionStatus = "TERMINATING"

    // DefaultExecutionListLimit is the default number of executions returned by the list endpoint
    DefaultExecutionListLimit = 10
)
```

<a name="TerminalExecutionStatuses"></a>
### func [TerminalExecutionStatuses](<https://github.com/runvoy/runvoy/blob/main/internal/constants/execution.go#L30>)

```go
func TerminalExecutionStatuses() []ExecutionStatus
```

TerminalExecutionStatuses returns all statuses that represent completed executions

<a name="Service"></a>
## type [Service](<https://github.com/runvoy/runvoy/blob/main/internal/constants/types.go#L24>)

Service represents a runvoy service component.

```go
type Service string
```

<a name="OrchestratorService"></a>

```go
const (
    // OrchestratorService is the main orchestrator service.
    OrchestratorService Service = "orchestrator"
    // EventProcessorService is the event processing service.
    EventProcessorService Service = "event-processor"
)
```

<a name="StartTimeCtxKeyType"></a>
## type [StartTimeCtxKeyType](<https://github.com/runvoy/runvoy/blob/main/internal/constants/context.go#L11>)

StartTimeCtxKeyType is the type for start time context keys

```go
type StartTimeCtxKeyType string
```

<a name="StartTimeCtxKey"></a>StartTimeCtxKey is the key used to store the start time in context

```go
const StartTimeCtxKey StartTimeCtxKeyType = "startTime"
```

# database

```go
import "runvoy/internal/database"
```

Package database defines repository interfaces for data persistence. It provides abstractions for user and execution storage.

Package database defines the repository interfaces for data persistence. This file contains the SecretsRepository interface for secret metadata management.

## Index

- [Variables](<#variables>)
- [type ConnectionRepository](<#ConnectionRepository>)
- [type ExecutionRepository](<#ExecutionRepository>)
- [type ImageRepository](<#ImageRepository>)
- [type Repositories](<#Repositories>)
- [type SecretsRepository](<#SecretsRepository>)
- [type TokenRepository](<#TokenRepository>)
- [type UserRepository](<#UserRepository>)


## Variables

<a name="ErrSecretNotFound"></a>Errors for secrets operations

```go
var (
    ErrSecretNotFound      = appErrors.ErrSecretNotFound("secret not found", nil)
    ErrSecretAlreadyExists = appErrors.ErrSecretAlreadyExists("secret already exists", nil)
)
```

<a name="ConnectionRepository"></a>
## type [ConnectionRepository](<https://github.com/runvoy/runvoy/blob/main/internal/database/repository.go#L88-L98>)

ConnectionRepository defines the interface for WebSocket connection\-related database operations.

```go
type ConnectionRepository interface {
    // CreateConnection stores a new WebSocket connection record in the database.
    CreateConnection(ctx context.Context, connection *api.WebSocketConnection) error

    // DeleteConnections removes WebSocket connections from the database.
    DeleteConnections(ctx context.Context, connectionIDs []string) (int, error)

    // GetConnectionsByExecutionID retrieves all active WebSocket connection records for a given execution ID.
    // Returns the complete connection objects including token and other metadata.
    GetConnectionsByExecutionID(ctx context.Context, executionID string) ([]*api.WebSocketConnection, error)
}
```

<a name="ExecutionRepository"></a>
## type [ExecutionRepository](<https://github.com/runvoy/runvoy/blob/main/internal/database/repository.go#L65-L85>)

ExecutionRepository defines the interface for execution\-related database operations.

```go
type ExecutionRepository interface {
    // CreateExecution stores a new execution record in the database.
    CreateExecution(ctx context.Context, execution *api.Execution) error

    // GetExecution retrieves an execution by its execution ID.
    GetExecution(ctx context.Context, executionID string) (*api.Execution, error)

    // UpdateExecution updates an existing execution record.
    UpdateExecution(ctx context.Context, execution *api.Execution) error

    // ListExecutions returns executions from the database with optional filtering and pagination.
    // Parameters:
    //   - limit: maximum number of executions to return. Use 0 to fetch all executions.
    //   - statuses: optional slice of execution statuses to filter by.
    //              If empty, all executions are returned.
    // Results are ordered newest first.
    ListExecutions(ctx context.Context, limit int, statuses []string) ([]*api.Execution, error)

    // GetExecutionsByRequestID retrieves all executions created or modified by a specific request ID.
    GetExecutionsByRequestID(ctx context.Context, requestID string) ([]*api.Execution, error)
}
```

<a name="ImageRepository"></a>
## type [ImageRepository](<https://github.com/runvoy/runvoy/blob/main/internal/database/repository.go#L114-L117>)

ImageRepository defines the interface for image metadata storage operations.

```go
type ImageRepository interface {
    // GetImagesByRequestID retrieves all images created or modified by a specific request ID.
    GetImagesByRequestID(ctx context.Context, requestID string) ([]api.ImageInfo, error)
}
```

<a name="Repositories"></a>
## type [Repositories](<https://github.com/runvoy/runvoy/blob/main/internal/database/repository.go#L122-L129>)

Repositories groups all database repository interfaces together. This struct is used to pass repositories as a cohesive unit while maintaining explicit access to individual repositories in service methods.

```go
type Repositories struct {
    User       UserRepository
    Execution  ExecutionRepository
    Connection ConnectionRepository
    Token      TokenRepository
    Image      ImageRepository
    Secrets    SecretsRepository
}
```

<a name="SecretsRepository"></a>
## type [SecretsRepository](<https://github.com/runvoy/runvoy/blob/main/internal/database/secrets.go#L20-L49>)

SecretsRepository defines the interface for persisting secret data. Implementations handle storing and retrieving secrets in their preferred storage backend.

```go
type SecretsRepository interface {
    // CreateSecret stores a new secret.
    // The secret's CreatedBy field must be set by the caller.
    // The repository sets CreatedAt and UpdatedAt timestamps.
    // Returns an error if a secret with the same name already exists.
    CreateSecret(ctx context.Context, secret *api.Secret) error

    // GetSecret retrieves a secret by name.
    // If includeValue is true, the secret value will be decrypted and included in the response.
    // Returns an error if the secret is not found.
    GetSecret(ctx context.Context, name string, includeValue bool) (*api.Secret, error)

    // ListSecrets retrieves all secrets.
    // If includeValue is true, secret values will be decrypted and included in the response.
    ListSecrets(ctx context.Context, includeValue bool) ([]*api.Secret, error)

    // UpdateSecret updates a secret's value and/or editable properties.
    // The secret's UpdatedBy field must be set by the caller.
    // The Name field identifies which secret to update.
    // The updatedAt timestamp is always refreshed.
    // Returns an error if the secret is not found.
    UpdateSecret(ctx context.Context, secret *api.Secret) error

    // DeleteSecret removes a secret from storage.
    // Returns an error if the secret is not found.
    DeleteSecret(ctx context.Context, name string) error

    // GetSecretsByRequestID retrieves all secrets created or modified by a specific request ID.
    GetSecretsByRequestID(ctx context.Context, requestID string) ([]*api.Secret, error)
}
```

<a name="TokenRepository"></a>
## type [TokenRepository](<https://github.com/runvoy/runvoy/blob/main/internal/database/repository.go#L101-L111>)

TokenRepository defines the interface for WebSocket token validation operations.

```go
type TokenRepository interface {
    // CreateToken stores a new WebSocket authentication token with metadata.
    CreateToken(ctx context.Context, token *api.WebSocketToken) error

    // GetToken retrieves a token by its value and validates it hasn't expired.
    // Returns nil if the token doesn't exist or has expired (DynamoDB TTL handles expiration).
    GetToken(ctx context.Context, tokenValue string) (*api.WebSocketToken, error)

    // DeleteToken removes a token from the database (used after validation or explicit cleanup).
    DeleteToken(ctx context.Context, tokenValue string) error
}
```

<a name="UserRepository"></a>
## type [UserRepository](<https://github.com/runvoy/runvoy/blob/main/internal/database/repository.go#L15-L62>)

UserRepository defines the interface for user\-related database operations. This abstraction allows for different implementations \(DynamoDB, PostgreSQL, etc.\) without changing the business logic layer.

```go
type UserRepository interface {
    // CreateUser stores a new user with their hashed API key in the database.
    // If expiresAtUnix is 0, no TTL is set (permanent user).
    // If expiresAtUnix is > 0, it sets expires_at for automatic deletion.
    // Returns an error if the user already exists or if the operation fails.
    CreateUser(ctx context.Context, user *api.User, apiKeyHash string, expiresAtUnix int64) error

    // RemoveExpiration removes the expires_at field from a user record, making them permanent.
    RemoveExpiration(ctx context.Context, email string) error

    // GetUserByEmail retrieves a user by their email address.
    // Returns nil if the user doesn't exist.
    GetUserByEmail(ctx context.Context, email string) (*api.User, error)

    // GetUserByAPIKeyHash retrieves a user by their hashed API key.
    // Used for authentication. Returns nil if no user has this API key.
    GetUserByAPIKeyHash(ctx context.Context, apiKeyHash string) (*api.User, error)

    // UpdateLastUsed updates the last_used timestamp for a user.
    // Called after successful API key authentication.
    UpdateLastUsed(ctx context.Context, email string) (*time.Time, error)

    // RevokeUser marks a user's API key as revoked without deleting the record.
    // Useful for audit trails.
    RevokeUser(ctx context.Context, email string) error

    // CreatePendingAPIKey stores a pending API key with a secret token.
    CreatePendingAPIKey(ctx context.Context, pending *api.PendingAPIKey) error

    // GetPendingAPIKey retrieves a pending API key by its secret token.
    // Returns nil if the token doesn't exist or has expired.
    GetPendingAPIKey(ctx context.Context, secretToken string) (*api.PendingAPIKey, error)

    // MarkAsViewed atomically marks a pending key as viewed with the IP address.
    MarkAsViewed(ctx context.Context, secretToken string, ipAddress string) error

    // DeletePendingAPIKey removes a pending API key from the database.
    DeletePendingAPIKey(ctx context.Context, secretToken string) error

    // ListUsers returns all users in the system (excluding API key hashes for security).
    // Used by admins to view all users and their basic information.
    ListUsers(ctx context.Context) ([]*api.User, error)

    // GetUsersByRequestID retrieves all users created or modified by a specific request ID.
    GetUsersByRequestID(ctx context.Context, requestID string) ([]*api.User, error)
}
```

# errors

```go
import "runvoy/internal/errors"
```

Package errors provides error types and handling for runvoy. It includes custom error types with HTTP status codes and error codes.

## Index

- [Constants](<#constants>)
- [func GetErrorCode\(err error\) string](<#GetErrorCode>)
- [func GetErrorDetails\(err error\) string](<#GetErrorDetails>)
- [func GetErrorMessage\(err error\) string](<#GetErrorMessage>)
- [func GetStatusCode\(err error\) int](<#GetStatusCode>)
- [type AppError](<#AppError>)
  - [func ErrAPIKeyRevoked\(cause error\) \*AppError](<#ErrAPIKeyRevoked>)
  - [func ErrBadRequest\(message string, cause error\) \*AppError](<#ErrBadRequest>)
  - [func ErrConflict\(message string, cause error\) \*AppError](<#ErrConflict>)
  - [func ErrDatabaseError\(message string, cause error\) \*AppError](<#ErrDatabaseError>)
  - [func ErrForbidden\(message string, cause error\) \*AppError](<#ErrForbidden>)
  - [func ErrInternalError\(message string, cause error\) \*AppError](<#ErrInternalError>)
  - [func ErrInvalidAPIKey\(cause error\) \*AppError](<#ErrInvalidAPIKey>)
  - [func ErrNotFound\(message string, cause error\) \*AppError](<#ErrNotFound>)
  - [func ErrSecretAlreadyExists\(message string, cause error\) \*AppError](<#ErrSecretAlreadyExists>)
  - [func ErrSecretNotFound\(message string, cause error\) \*AppError](<#ErrSecretNotFound>)
  - [func ErrServiceUnavailable\(message string, cause error\) \*AppError](<#ErrServiceUnavailable>)
  - [func ErrUnauthorized\(message string, cause error\) \*AppError](<#ErrUnauthorized>)
  - [func NewClientError\(statusCode int, code, message string, cause error\) \*AppError](<#NewClientError>)
  - [func NewServerError\(statusCode int, code, message string, cause error\) \*AppError](<#NewServerError>)
  - [func \(e \*AppError\) Error\(\) string](<#AppError.Error>)
  - [func \(e \*AppError\) Is\(target error\) bool](<#AppError.Is>)
  - [func \(e \*AppError\) Unwrap\(\) error](<#AppError.Unwrap>)


## Constants

<a name="ErrCodeInvalidRequest"></a>Predefined error codes

```go
const (
    // Client error codes
    ErrCodeInvalidRequest = "INVALID_REQUEST"
    ErrCodeUnauthorized   = "UNAUTHORIZED"
    ErrCodeForbidden      = "FORBIDDEN"
    ErrCodeNotFound       = "NOT_FOUND"
    ErrCodeConflict       = "CONFLICT"
    ErrCodeSecretNotFound = "SECRET_NOT_FOUND"
    ErrCodeSecretExists   = "SECRET_ALREADY_EXISTS"
    ErrCodeInvalidAPIKey  = "INVALID_API_KEY" //nolint:gosec
    ErrCodeAPIKeyRevoked  = "API_KEY_REVOKED" //nolint:gosec

    // Server error codes
    ErrCodeInternalError      = "INTERNAL_ERROR"
    ErrCodeDatabaseError      = "DATABASE_ERROR"
    ErrCodeServiceUnavailable = "SERVICE_UNAVAILABLE"
)
```

<a name="GetErrorCode"></a>
## func [GetErrorCode](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L165>)

```go
func GetErrorCode(err error) string
```

GetErrorCode extracts the error code from an error. Returns empty string if the error is not an AppError.

<a name="GetErrorDetails"></a>
## func [GetErrorDetails](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L184>)

```go
func GetErrorDetails(err error) string
```

GetErrorDetails extracts detailed error information including the underlying cause. Returns the underlying error message if available, otherwise returns the main error message.

<a name="GetErrorMessage"></a>
## func [GetErrorMessage](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L174>)

```go
func GetErrorMessage(err error) string
```

GetErrorMessage extracts a user\-friendly message from an error.

<a name="GetStatusCode"></a>
## func [GetStatusCode](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L155>)

```go
func GetStatusCode(err error) int
```

GetStatusCode extracts the HTTP status code from an error. Returns 500 if the error is not an AppError.

<a name="AppError"></a>
## type [AppError](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L12-L21>)

AppError represents an application error with an associated HTTP status code.

```go
type AppError struct {
    // Code is an optional error code string for programmatic handling
    Code string
    // Message is a user-friendly error message
    Message string
    // StatusCode is the HTTP status code to return
    StatusCode int
    // Cause is the underlying error (for error wrapping)
    Cause error
}
```

<a name="ErrAPIKeyRevoked"></a>
### func [ErrAPIKeyRevoked](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L107>)

```go
func ErrAPIKeyRevoked(cause error) *AppError
```

ErrAPIKeyRevoked creates an API key revoked error \(401\).

<a name="ErrBadRequest"></a>
### func [ErrBadRequest](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L122>)

```go
func ErrBadRequest(message string, cause error) *AppError
```

ErrBadRequest creates a bad request error \(400\).

<a name="ErrConflict"></a>
### func [ErrConflict](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L117>)

```go
func ErrConflict(message string, cause error) *AppError
```

ErrConflict creates a conflict error \(409\).

<a name="ErrDatabaseError"></a>
### func [ErrDatabaseError](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L143>)

```go
func ErrDatabaseError(message string, cause error) *AppError
```

ErrDatabaseError creates a database error \(503 Service Unavailable\). Database failures are typically transient issues.

<a name="ErrForbidden"></a>
### func [ErrForbidden](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L97>)

```go
func ErrForbidden(message string, cause error) *AppError
```

ErrForbidden creates a forbidden error \(403\).

<a name="ErrInternalError"></a>
### func [ErrInternalError](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L137>)

```go
func ErrInternalError(message string, cause error) *AppError
```

ErrInternalError creates an internal server error \(500\).

<a name="ErrInvalidAPIKey"></a>
### func [ErrInvalidAPIKey](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L102>)

```go
func ErrInvalidAPIKey(cause error) *AppError
```

ErrInvalidAPIKey creates an invalid API key error \(401\).

<a name="ErrNotFound"></a>
### func [ErrNotFound](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L112>)

```go
func ErrNotFound(message string, cause error) *AppError
```

ErrNotFound creates a not found error \(404\).

<a name="ErrSecretAlreadyExists"></a>
### func [ErrSecretAlreadyExists](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L132>)

```go
func ErrSecretAlreadyExists(message string, cause error) *AppError
```

ErrSecretAlreadyExists creates a secret already exists error \(409\).

<a name="ErrSecretNotFound"></a>
### func [ErrSecretNotFound](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L127>)

```go
func ErrSecretNotFound(message string, cause error) *AppError
```

ErrSecretNotFound creates a secret not found error \(404\).

<a name="ErrServiceUnavailable"></a>
### func [ErrServiceUnavailable](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L149>)

```go
func ErrServiceUnavailable(message string, cause error) *AppError
```

ErrServiceUnavailable creates a service unavailable error \(503\). Use this for resources that are temporarily unavailable but may become available soon.

<a name="ErrUnauthorized"></a>
### func [ErrUnauthorized](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L92>)

```go
func ErrUnauthorized(message string, cause error) *AppError
```

ErrUnauthorized creates an unauthorized error \(401\).

<a name="NewClientError"></a>
### func [NewClientError](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L64>)

```go
func NewClientError(statusCode int, code, message string, cause error) *AppError
```

NewClientError creates a new client error \(4xx status codes\).

<a name="NewServerError"></a>
### func [NewServerError](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L77>)

```go
func NewServerError(statusCode int, code, message string, cause error) *AppError
```

NewServerError creates a new server error \(5xx status codes\).

<a name="AppError.Error"></a>
### func \(\*AppError\) [Error](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L24>)

```go
func (e *AppError) Error() string
```

Error implements the error interface.

<a name="AppError.Is"></a>
### func \(\*AppError\) [Is](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L37>)

```go
func (e *AppError) Is(target error) bool
```

Is allows errors.Is to work with AppError.

<a name="AppError.Unwrap"></a>
### func \(\*AppError\) [Unwrap](<https://github.com/runvoy/runvoy/blob/main/internal/errors/errors.go#L32>)

```go
func (e *AppError) Unwrap() error
```

Unwrap returns the underlying error for error unwrapping.

# logger

```go
import "runvoy/internal/logger"
```

Package logger provides structured logging utilities for runvoy. It includes context\-aware logging and log level management.

## Index

- [func ClearContextExtractors\(\)](<#ClearContextExtractors>)
- [func DeriveRequestLogger\(ctx context.Context, base \*slog.Logger\) \*slog.Logger](<#DeriveRequestLogger>)
- [func ExtractRequestIDFromContext\(ctx context.Context\) string](<#ExtractRequestIDFromContext>)
- [func GetDeadlineInfo\(ctx context.Context\) \[\]any](<#GetDeadlineInfo>)
- [func GetRequestID\(ctx context.Context\) string](<#GetRequestID>)
- [func Initialize\(env constants.Environment, level slog.Level\) \*slog.Logger](<#Initialize>)
- [func RegisterContextExtractor\(extractor ContextExtractor\)](<#RegisterContextExtractor>)
- [func SliceToMap\(args \[\]any\) map\[string\]any](<#SliceToMap>)
- [func WithRequestID\(ctx context.Context, requestID string\) context.Context](<#WithRequestID>)
- [type ContextExtractor](<#ContextExtractor>)


<a name="ClearContextExtractors"></a>
## func [ClearContextExtractors](<https://github.com/runvoy/runvoy/blob/main/internal/logger/context.go#L41>)

```go
func ClearContextExtractors()
```

ClearContextExtractors removes all registered context extractors. This is primarily useful for testing.

<a name="DeriveRequestLogger"></a>
## func [DeriveRequestLogger](<https://github.com/runvoy/runvoy/blob/main/internal/logger/context.go#L91>)

```go
func DeriveRequestLogger(ctx context.Context, base *slog.Logger) *slog.Logger
```

DeriveRequestLogger returns a logger enriched with request\-scoped fields available in the provided context. It first checks for a request ID set via WithRequestID, then tries all registered ContextExtractors in order. This allows supporting multiple providers \(AWS Lambda, HTTP servers, etc.\) without hardcoding provider\-specific logic.

IMPORTANT: The requestID field is always added at the root level of the log entry \(never nested in a "context" object\). This ensures we can query logs by requestID directly using e.g. filter requestID = "value". Do NOT add requestID to any "context" map objects in log calls.

<a name="ExtractRequestIDFromContext"></a>
## func [ExtractRequestIDFromContext](<https://github.com/runvoy/runvoy/blob/main/internal/logger/context.go#L67>)

```go
func ExtractRequestIDFromContext(ctx context.Context) string
```

ExtractRequestIDFromContext attempts to extract a request ID from the context using the same priority as DeriveRequestLogger: first checks for a request ID set via WithRequestID, then tries all registered ContextExtractors in order. Returns the first request ID found, or an empty string if none is found. This allows middleware to extract request IDs without knowing about provider\-specific implementations \(e.g., AWS Lambda\).

<a name="GetDeadlineInfo"></a>
## func [GetDeadlineInfo](<https://github.com/runvoy/runvoy/blob/main/internal/logger/context.go#L111>)

```go
func GetDeadlineInfo(ctx context.Context) []any
```

GetDeadlineInfo returns logging attributes for context deadline information. Returns the absolute deadline time and remaining duration if set, or "none" if no deadline.

<a name="GetRequestID"></a>
## func [GetRequestID](<https://github.com/runvoy/runvoy/blob/main/internal/logger/context.go#L53>)

```go
func GetRequestID(ctx context.Context) string
```

GetRequestID extracts the request ID from the context. The request ID is set by server middleware when available.

<a name="Initialize"></a>
## func [Initialize](<https://github.com/runvoy/runvoy/blob/main/internal/logger/logger.go#L76>)

```go
func Initialize(env constants.Environment, level slog.Level) *slog.Logger
```

Initialize sets up the global slog logger based on the environment

<a name="RegisterContextExtractor"></a>
## func [RegisterContextExtractor](<https://github.com/runvoy/runvoy/blob/main/internal/logger/context.go#L35>)

```go
func RegisterContextExtractor(extractor ContextExtractor)
```

RegisterContextExtractor registers a new context extractor. Extractors are called in the order they are registered.

<a name="SliceToMap"></a>
## func [SliceToMap](<https://github.com/runvoy/runvoy/blob/main/internal/logger/context.go#L127>)

```go
func SliceToMap(args []any) map[string]any
```

SliceToMap converts a slice of alternating key\-value pairs to a map\[string\]any. It expects the slice to have an even number of elements with string keys. Non\-string keys are skipped.

<a name="WithRequestID"></a>
## func [WithRequestID](<https://github.com/runvoy/runvoy/blob/main/internal/logger/context.go#L47>)

```go
func WithRequestID(ctx context.Context, requestID string) context.Context
```

WithRequestID returns a new context with the given request ID attached. This should be used by server middleware to add request IDs to the context.

<a name="ContextExtractor"></a>
## type [ContextExtractor](<https://github.com/runvoy/runvoy/blob/main/internal/logger/context.go#L23-L27>)

ContextExtractor defines an interface for extracting request IDs from various context sources \(e.g., AWS Lambda, HTTP servers, other cloud providers\). This interface allows the logger to remain portable and not bound to any specific provider implementation.

```go
type ContextExtractor interface {
    // ExtractRequestID attempts to extract a request ID from the given context.
    // Returns the request ID and true if found, empty string and false otherwise.
    ExtractRequestID(ctx context.Context) (requestID string, found bool)
}
```

# secrets

```go
import "runvoy/internal/secrets"
```

Package secrets provides shared utilities for secret detection and handling.

## Index

- [Variables](<#variables>)
- [func GetSecretVariableNames\(env map\[string\]string\) \[\]string](<#GetSecretVariableNames>)
- [func MergeSecretVarNames\(known, detected \[\]string\) \[\]string](<#MergeSecretVarNames>)


## Variables

<a name="DefaultSecretPatterns"></a>DefaultSecretPatterns contains the default patterns used to identify environment variable names that should be treated as secrets.

```go
var DefaultSecretPatterns = []string{
    "ACCESS_KEY",
    "API_KEY",
    "API_SECRET",
    "GITHUB_SECRET",
    "GITHUB_TOKEN",
    "PASSWORD",
    "PRIVATE_KEY",
    "SECRET_KEY",
    "SECRET",
    "TOKEN",
}
```

<a name="GetSecretVariableNames"></a>
## func [GetSecretVariableNames](<https://github.com/runvoy/runvoy/blob/main/internal/secrets/patterns.go#L24>)

```go
func GetSecretVariableNames(env map[string]string) []string
```

GetSecretVariableNames returns a list of variable names from the given environment that should be treated as secrets based on pattern matching. These variables will be processed without exposing their values in logs.

<a name="MergeSecretVarNames"></a>
## func [MergeSecretVarNames](<https://github.com/runvoy/runvoy/blob/main/internal/secrets/patterns.go#L43>)

```go
func MergeSecretVarNames(known, detected []string) []string
```

MergeSecretVarNames merges known secret variable names with pattern\-detected ones, removing duplicates. This allows combining explicitly known secrets with pattern\-based detection for comprehensive coverage.

# server

```go
import "runvoy/internal/server"
```

Package server implements the HTTP server and handlers for runvoy. It provides REST API endpoints for user management and command execution.

## Index

- [type Router](<#Router>)
  - [func NewRouter\(svc \*orchestrator.Service, requestTimeout time.Duration, allowedOrigins \[\]string\) \*Router](<#NewRouter>)
  - [func \(r \*Router\) ChiMux\(\) \*chi.Mux](<#Router.ChiMux>)
  - [func \(r \*Router\) GetLoggerFromContext\(ctx context.Context\) \*slog.Logger](<#Router.GetLoggerFromContext>)
  - [func \(r \*Router\) Handler\(\) http.Handler](<#Router.Handler>)
  - [func \(r \*Router\) ServeHTTP\(w http.ResponseWriter, req \*http.Request\)](<#Router.ServeHTTP>)
  - [func \(r \*Router\) WithContext\(ctx context.Context, svc \*orchestrator.Service\) context.Context](<#Router.WithContext>)


<a name="Router"></a>
## type [Router](<https://github.com/runvoy/runvoy/blob/main/internal/server/router.go#L16-L19>)

Router wraps a chi router with service dependencies for handling API requests.

```go
type Router struct {
    // contains filtered or unexported fields
}
```

<a name="NewRouter"></a>
### func [NewRouter](<https://github.com/runvoy/runvoy/blob/main/internal/server/router.go#L32-L36>)

```go
func NewRouter(svc *orchestrator.Service, requestTimeout time.Duration, allowedOrigins []string) *Router
```

NewRouter creates a new chi router with routes configured. If requestTimeout is \> 0, adds a per\-request timeout middleware. If requestTimeout is 0, no timeout middleware is added, allowing the environment \(e.g., Lambda with its own timeout\) to handle timeouts.

<a name="Router.ChiMux"></a>
### func \(\*Router\) [ChiMux](<https://github.com/runvoy/runvoy/blob/main/internal/server/router.go#L89>)

```go
func (r *Router) ChiMux() *chi.Mux
```

ChiMux returns the underlying chi router for advanced usage

<a name="Router.GetLoggerFromContext"></a>
### func \(\*Router\) [GetLoggerFromContext](<https://github.com/runvoy/runvoy/blob/main/internal/server/middleware.go#L277>)

```go
func (r *Router) GetLoggerFromContext(ctx context.Context) *slog.Logger
```

GetLoggerFromContext extracts the logger from request context Returns the request\-scoped logger \(with request ID if available\) or falls back to service logger

<a name="Router.Handler"></a>
### func \(\*Router\) [Handler](<https://github.com/runvoy/runvoy/blob/main/internal/server/router.go#L94>)

```go
func (r *Router) Handler() http.Handler
```

Handler returns an http.Handler for the router

<a name="Router.ServeHTTP"></a>
### func \(\*Router\) [ServeHTTP](<https://github.com/runvoy/runvoy/blob/main/internal/server/router.go#L84>)

```go
func (r *Router) ServeHTTP(w http.ResponseWriter, req *http.Request)
```

ServeHTTP implements http.Handler for use with chi router

<a name="Router.WithContext"></a>
### func \(\*Router\) [WithContext](<https://github.com/runvoy/runvoy/blob/main/internal/server/router.go#L99>)

```go
func (r *Router) WithContext(ctx context.Context, svc *orchestrator.Service) context.Context
```

WithContext adds the service to the request context

# testutil

```go
import "runvoy/internal/testutil"
```

Package testutil provides shared testing utilities and helpers.

## Index

- [func AssertAppErrorCode\(t \*testing.T, err error, expectedCode string, \_ ...any\) bool](<#AssertAppErrorCode>)
- [func AssertAppErrorStatus\(t \*testing.T, err error, expectedStatus int, \_ ...any\) bool](<#AssertAppErrorStatus>)
- [func AssertEqual\(t \*testing.T, expected, actual any, msgAndArgs ...any\) bool](<#AssertEqual>)
- [func AssertError\(t \*testing.T, err error, msgAndArgs ...any\) bool](<#AssertError>)
- [func AssertErrorType\(t \*testing.T, err, target error, \_ ...any\) bool](<#AssertErrorType>)
- [func AssertNil\(t \*testing.T, obj any, msgAndArgs ...any\) bool](<#AssertNil>)
- [func AssertNoError\(t \*testing.T, err error, msgAndArgs ...any\) bool](<#AssertNoError>)
- [func AssertNotEmpty\(t \*testing.T, obj any, msgAndArgs ...any\) bool](<#AssertNotEmpty>)
- [func AssertNotNil\(t \*testing.T, obj any, msgAndArgs ...any\) bool](<#AssertNotNil>)
- [func SilentLogger\(\) \*slog.Logger](<#SilentLogger>)
- [func TestContext\(\) context.Context](<#TestContext>)
- [func TestLogger\(\) \*slog.Logger](<#TestLogger>)
- [type ExecutionBuilder](<#ExecutionBuilder>)
  - [func NewExecutionBuilder\(\) \*ExecutionBuilder](<#NewExecutionBuilder>)
  - [func \(b \*ExecutionBuilder\) Build\(\) \*api.Execution](<#ExecutionBuilder.Build>)
  - [func \(b \*ExecutionBuilder\) Completed\(\) \*ExecutionBuilder](<#ExecutionBuilder.Completed>)
  - [func \(b \*ExecutionBuilder\) Failed\(\) \*ExecutionBuilder](<#ExecutionBuilder.Failed>)
  - [func \(b \*ExecutionBuilder\) WithCommand\(cmd string\) \*ExecutionBuilder](<#ExecutionBuilder.WithCommand>)
  - [func \(b \*ExecutionBuilder\) WithCreatedBy\(email string\) \*ExecutionBuilder](<#ExecutionBuilder.WithCreatedBy>)
  - [func \(b \*ExecutionBuilder\) WithExecutionID\(id string\) \*ExecutionBuilder](<#ExecutionBuilder.WithExecutionID>)
  - [func \(b \*ExecutionBuilder\) WithLogStreamName\(name string\) \*ExecutionBuilder](<#ExecutionBuilder.WithLogStreamName>)
  - [func \(b \*ExecutionBuilder\) WithStatus\(status string\) \*ExecutionBuilder](<#ExecutionBuilder.WithStatus>)
- [type UserBuilder](<#UserBuilder>)
  - [func NewUserBuilder\(\) \*UserBuilder](<#NewUserBuilder>)
  - [func \(b \*UserBuilder\) Build\(\) \*api.User](<#UserBuilder.Build>)
  - [func \(b \*UserBuilder\) Revoked\(\) \*UserBuilder](<#UserBuilder.Revoked>)
  - [func \(b \*UserBuilder\) WithCreatedAt\(t time.Time\) \*UserBuilder](<#UserBuilder.WithCreatedAt>)
  - [func \(b \*UserBuilder\) WithEmail\(email string\) \*UserBuilder](<#UserBuilder.WithEmail>)
  - [func \(b \*UserBuilder\) WithLastUsed\(t time.Time\) \*UserBuilder](<#UserBuilder.WithLastUsed>)
  - [func \(b \*UserBuilder\) WithRole\(role string\) \*UserBuilder](<#UserBuilder.WithRole>)


<a name="AssertAppErrorCode"></a>
## func [AssertAppErrorCode](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/assert.go#L22>)

```go
func AssertAppErrorCode(t *testing.T, err error, expectedCode string, _ ...any) bool
```

AssertAppErrorCode checks if the error has a specific error code.

<a name="AssertAppErrorStatus"></a>
## func [AssertAppErrorStatus](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/assert.go#L32>)

```go
func AssertAppErrorStatus(t *testing.T, err error, expectedStatus int, _ ...any) bool
```

AssertAppErrorStatus checks if the error has a specific HTTP status code.

<a name="AssertEqual"></a>
## func [AssertEqual](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/assert.go#L54>)

```go
func AssertEqual(t *testing.T, expected, actual any, msgAndArgs ...any) bool
```

AssertEqual is a wrapper around assert.Equal with context.

<a name="AssertError"></a>
## func [AssertError](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/assert.go#L48>)

```go
func AssertError(t *testing.T, err error, msgAndArgs ...any) bool
```

AssertError is a wrapper around assert.Error with context.

<a name="AssertErrorType"></a>
## func [AssertErrorType](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/assert.go#L13>)

```go
func AssertErrorType(t *testing.T, err, target error, _ ...any) bool
```

AssertErrorType checks if the error is of a specific type using errors.Is.

<a name="AssertNil"></a>
## func [AssertNil](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/assert.go#L66>)

```go
func AssertNil(t *testing.T, obj any, msgAndArgs ...any) bool
```

AssertNil is a wrapper around assert.Nil with context.

<a name="AssertNoError"></a>
## func [AssertNoError](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/assert.go#L42>)

```go
func AssertNoError(t *testing.T, err error, msgAndArgs ...any) bool
```

AssertNoError is a wrapper around assert.NoError with context.

<a name="AssertNotEmpty"></a>
## func [AssertNotEmpty](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/assert.go#L60>)

```go
func AssertNotEmpty(t *testing.T, obj any, msgAndArgs ...any) bool
```

AssertNotEmpty is a wrapper around assert.NotEmpty with context.

<a name="AssertNotNil"></a>
## func [AssertNotNil](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/assert.go#L72>)

```go
func AssertNotNil(t *testing.T, obj any, msgAndArgs ...any) bool
```

AssertNotNil is a wrapper around assert.NotNil with context.

<a name="SilentLogger"></a>
## func [SilentLogger](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L156>)

```go
func SilentLogger() *slog.Logger
```

SilentLogger creates a logger that discards all output.

<a name="TestContext"></a>
## func [TestContext](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L142>)

```go
func TestContext() context.Context
```

TestContext creates a test context with a reasonable timeout. Note: The cancel function is intentionally not returned since test contexts are expected to be short\-lived and will be cleaned up when the test completes.

<a name="TestLogger"></a>
## func [TestLogger](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L149>)

```go
func TestLogger() *slog.Logger
```

TestLogger creates a logger suitable for testing \(outputs to stderr\).

<a name="ExecutionBuilder"></a>
## type [ExecutionBuilder](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L67-L69>)

ExecutionBuilder provides a fluent interface for building test executions.

```go
type ExecutionBuilder struct {
    // contains filtered or unexported fields
}
```

<a name="NewExecutionBuilder"></a>
### func [NewExecutionBuilder](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L72>)

```go
func NewExecutionBuilder() *ExecutionBuilder
```

NewExecutionBuilder creates a new ExecutionBuilder with sensible defaults.

<a name="ExecutionBuilder.Build"></a>
### func \(\*ExecutionBuilder\) [Build](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L135>)

```go
func (b *ExecutionBuilder) Build() *api.Execution
```

Build returns the constructed Execution.

<a name="ExecutionBuilder.Completed"></a>
### func \(\*ExecutionBuilder\) [Completed](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L117>)

```go
func (b *ExecutionBuilder) Completed() *ExecutionBuilder
```

Completed marks the execution as completed.

<a name="ExecutionBuilder.Failed"></a>
### func \(\*ExecutionBuilder\) [Failed](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L126>)

```go
func (b *ExecutionBuilder) Failed() *ExecutionBuilder
```

Failed marks the execution as failed.

<a name="ExecutionBuilder.WithCommand"></a>
### func \(\*ExecutionBuilder\) [WithCommand](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L92>)

```go
func (b *ExecutionBuilder) WithCommand(cmd string) *ExecutionBuilder
```

WithCommand sets the execution command.

<a name="ExecutionBuilder.WithCreatedBy"></a>
### func \(\*ExecutionBuilder\) [WithCreatedBy](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L104>)

```go
func (b *ExecutionBuilder) WithCreatedBy(email string) *ExecutionBuilder
```

WithCreatedBy sets the creator email.

<a name="ExecutionBuilder.WithExecutionID"></a>
### func \(\*ExecutionBuilder\) [WithExecutionID](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L86>)

```go
func (b *ExecutionBuilder) WithExecutionID(id string) *ExecutionBuilder
```

WithExecutionID sets the execution ID.

<a name="ExecutionBuilder.WithLogStreamName"></a>
### func \(\*ExecutionBuilder\) [WithLogStreamName](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L111>)

```go
func (b *ExecutionBuilder) WithLogStreamName(name string) *ExecutionBuilder
```

WithLogStreamName sets the log stream name.

<a name="ExecutionBuilder.WithStatus"></a>
### func \(\*ExecutionBuilder\) [WithStatus](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L98>)

```go
func (b *ExecutionBuilder) WithStatus(status string) *ExecutionBuilder
```

WithStatus sets the execution status.

<a name="UserBuilder"></a>
## type [UserBuilder](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L16-L18>)

UserBuilder provides a fluent interface for building test users.

```go
type UserBuilder struct {
    // contains filtered or unexported fields
}
```

<a name="NewUserBuilder"></a>
### func [NewUserBuilder](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L21>)

```go
func NewUserBuilder() *UserBuilder
```

NewUserBuilder creates a new UserBuilder with sensible defaults.

<a name="UserBuilder.Build"></a>
### func \(\*UserBuilder\) [Build](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L62>)

```go
func (b *UserBuilder) Build() *api.User
```

Build returns the constructed User.

<a name="UserBuilder.Revoked"></a>
### func \(\*UserBuilder\) [Revoked](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L56>)

```go
func (b *UserBuilder) Revoked() *UserBuilder
```

Revoked marks the user as revoked.

<a name="UserBuilder.WithCreatedAt"></a>
### func \(\*UserBuilder\) [WithCreatedAt](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L44>)

```go
func (b *UserBuilder) WithCreatedAt(t time.Time) *UserBuilder
```

WithCreatedAt sets the user's creation time.

<a name="UserBuilder.WithEmail"></a>
### func \(\*UserBuilder\) [WithEmail](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L32>)

```go
func (b *UserBuilder) WithEmail(email string) *UserBuilder
```

WithEmail sets the user's email.

<a name="UserBuilder.WithLastUsed"></a>
### func \(\*UserBuilder\) [WithLastUsed](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L50>)

```go
func (b *UserBuilder) WithLastUsed(t time.Time) *UserBuilder
```

WithLastUsed sets the user's last used time.

<a name="UserBuilder.WithRole"></a>
### func \(\*UserBuilder\) [WithRole](<https://github.com/runvoy/runvoy/blob/main/internal/testutil/fixtures.go#L38>)

```go
func (b *UserBuilder) WithRole(role string) *UserBuilder
```

WithRole sets the user's role.

# axiom\-forwarder

```go
import "runvoy/scripts/axiom-forwarder"
```

Package main implements an AWS Lambda function that forwards CloudWatch Logs to Axiom. This is a standalone utility kept in the runvoy repository for convenience.

## Index



# create\-config\-file

```go
import "runvoy/scripts/create-config-file"
```

Package main provides a utility to create a configuration file for runvoy.

## Index



# delete\-s3\-buckets

```go
import "runvoy/scripts/delete-s3-buckets"
```

Package main provides a utility script to delete non\-empty S3 buckets. It deletes all object versions, delete markers, and objects before deleting the bucket.

## Index



# generate\-cli\-docs

```go
import "runvoy/scripts/generate-cli-docs"
```

Package main provides a utility to generate a single markdown file documenting all CLI commands.

## Index



# seed\-admin\-user

```go
import "runvoy/scripts/seed-admin-user"
```

seed\-admin\-user is a utility script to seed the admin user into the database. This script is intentionally kept for operational purposes \(initial setup, recovery, etc.\).

## Index



# sync\-env\-vars

```go
import "runvoy/scripts/sync-env-vars"
```

Package main provides a utility to synchronize environment variables between Lambda functions and local .env files.

## Index



# truncate\-dynamodb\-table

```go
import "runvoy/scripts/truncate-dynamodb-table"
```

Package main provides a utility script to truncate \(delete all records from\) a DynamoDB table. It scans all items from the table and deletes them in batches.

## Index



# update\-readme\-help

```go
import "runvoy/scripts/update-readme-help"
```

Package main provides a utility to update the README.md with the latest CLI help output and version.

## Index



# cmd

```go
import "runvoy/cmd/cli/cmd"
```

Package cmd implements the CLI commands for the runvoy tool.

## Index

- [func Execute\(\)](<#Execute>)
- [func RootCmd\(\) \*cobra.Command](<#RootCmd>)
- [type ClaimService](<#ClaimService>)
  - [func NewClaimService\(apiClient client.Interface, outputter OutputInterface, configSaver ConfigSaver\) \*ClaimService](<#NewClaimService>)
  - [func \(s \*ClaimService\) ClaimAPIKey\(ctx context.Context, token string, cfg \*config.Config\) error](<#ClaimService.ClaimAPIKey>)
- [type ConfigLoader](<#ConfigLoader>)
  - [func NewConfigLoader\(\) ConfigLoader](<#NewConfigLoader>)
- [type ConfigLoaderFunc](<#ConfigLoaderFunc>)
  - [func \(f ConfigLoaderFunc\) Load\(\) \(\*config.Config, error\)](<#ConfigLoaderFunc.Load>)
- [type ConfigPathGetter](<#ConfigPathGetter>)
  - [func NewConfigPathGetter\(\) ConfigPathGetter](<#NewConfigPathGetter>)
- [type ConfigPathGetterFunc](<#ConfigPathGetterFunc>)
  - [func \(f ConfigPathGetterFunc\) GetConfigPath\(\) \(string, error\)](<#ConfigPathGetterFunc.GetConfigPath>)
- [type ConfigSaver](<#ConfigSaver>)
  - [func NewConfigSaver\(\) ConfigSaver](<#NewConfigSaver>)
- [type ConfigSaverFunc](<#ConfigSaverFunc>)
  - [func \(f ConfigSaverFunc\) Save\(cfg \*config.Config\) error](<#ConfigSaverFunc.Save>)
- [type ConfigureService](<#ConfigureService>)
  - [func NewConfigureService\(outputter OutputInterface, configSaver ConfigSaver, configLoader ConfigLoader, configPathGetter ConfigPathGetter\) \*ConfigureService](<#NewConfigureService>)
  - [func \(s \*ConfigureService\) Configure\(\_ context.Context\) error](<#ConfigureService.Configure>)
- [type ExecuteCommandRequest](<#ExecuteCommandRequest>)
- [type ImagesService](<#ImagesService>)
  - [func NewImagesService\(apiClient client.Interface, outputter OutputInterface\) \*ImagesService](<#NewImagesService>)
  - [func \(s \*ImagesService\) ListImages\(ctx context.Context\) error](<#ImagesService.ListImages>)
  - [func \(s \*ImagesService\) RegisterImage\(ctx context.Context, image string, isDefault \*bool, taskRoleName, taskExecutionRoleName \*string, cpu, memory \*int, runtimePlatform \*string\) error](<#ImagesService.RegisterImage>)
  - [func \(s \*ImagesService\) ShowImage\(ctx context.Context, image string\) error](<#ImagesService.ShowImage>)
  - [func \(s \*ImagesService\) UnregisterImage\(ctx context.Context, image string\) error](<#ImagesService.UnregisterImage>)
- [type KillService](<#KillService>)
  - [func NewKillService\(apiClient client.Interface, outputter OutputInterface\) \*KillService](<#NewKillService>)
  - [func \(s \*KillService\) KillExecution\(ctx context.Context, executionID string\) error](<#KillService.KillExecution>)
- [type ListService](<#ListService>)
  - [func NewListService\(apiClient client.Interface, outputter OutputInterface\) \*ListService](<#NewListService>)
  - [func \(s \*ListService\) ListExecutions\(ctx context.Context, limit int, statuses string\) error](<#ListService.ListExecutions>)
- [type LogsService](<#LogsService>)
  - [func NewLogsService\(apiClient client.Interface, outputter OutputInterface, sleeper Sleeper\) \*LogsService](<#NewLogsService>)
  - [func \(s \*LogsService\) DisplayLogs\(ctx context.Context, executionID, webURL string\) error](<#LogsService.DisplayLogs>)
- [type OutputInterface](<#OutputInterface>)
  - [func NewOutputWrapper\(\) OutputInterface](<#NewOutputWrapper>)
- [type PlaybookOverrides](<#PlaybookOverrides>)
- [type PlaybookService](<#PlaybookService>)
  - [func NewPlaybookService\(loader \*playbooks.PlaybookLoader, executor \*playbooks.PlaybookExecutor, outputter OutputInterface\) \*PlaybookService](<#NewPlaybookService>)
  - [func \(s \*PlaybookService\) ListPlaybooks\(\_ context.Context\) error](<#PlaybookService.ListPlaybooks>)
  - [func \(s \*PlaybookService\) RunPlaybook\(ctx context.Context, name string, userEnv map\[string\]string, overrides \*PlaybookOverrides, webURL string, runService \*RunService\) error](<#PlaybookService.RunPlaybook>)
  - [func \(s \*PlaybookService\) ShowPlaybook\(\_ context.Context, name string\) error](<#PlaybookService.ShowPlaybook>)
- [type RealSleeper](<#RealSleeper>)
  - [func \(r \*RealSleeper\) Sleep\(duration time.Duration\)](<#RealSleeper.Sleep>)
- [type RunService](<#RunService>)
  - [func NewRunService\(apiClient client.Interface, outputter OutputInterface\) \*RunService](<#NewRunService>)
  - [func \(s \*RunService\) ExecuteCommand\(ctx context.Context, req \*ExecuteCommandRequest\) error](<#RunService.ExecuteCommand>)
- [type SecretsService](<#SecretsService>)
  - [func NewSecretsService\(apiClient client.Interface, outputter OutputInterface\) \*SecretsService](<#NewSecretsService>)
  - [func \(s \*SecretsService\) CreateSecret\(ctx context.Context, name, keyName, value, description string\) error](<#SecretsService.CreateSecret>)
  - [func \(s \*SecretsService\) DeleteSecret\(ctx context.Context, name string\) error](<#SecretsService.DeleteSecret>)
  - [func \(s \*SecretsService\) GetSecret\(ctx context.Context, name string\) error](<#SecretsService.GetSecret>)
  - [func \(s \*SecretsService\) ListSecrets\(ctx context.Context\) error](<#SecretsService.ListSecrets>)
  - [func \(s \*SecretsService\) UpdateSecret\(ctx context.Context, name, keyName, value, description string\) error](<#SecretsService.UpdateSecret>)
- [type Sleeper](<#Sleeper>)
- [type StatusService](<#StatusService>)
  - [func NewStatusService\(apiClient client.Interface, outputter OutputInterface\) \*StatusService](<#NewStatusService>)
  - [func \(s \*StatusService\) DisplayStatus\(ctx context.Context, executionID string\) error](<#StatusService.DisplayStatus>)
- [type TraceService](<#TraceService>)
  - [func NewTraceService\(apiClient client.Interface, outputter OutputInterface\) \*TraceService](<#NewTraceService>)
  - [func \(s \*TraceService\) DisplayBackendLogs\(ctx context.Context, requestID string\) error](<#TraceService.DisplayBackendLogs>)
- [type UsersService](<#UsersService>)
  - [func NewUsersService\(apiClient client.Interface, outputter OutputInterface\) \*UsersService](<#NewUsersService>)
  - [func \(s \*UsersService\) CreateUser\(ctx context.Context, email, role string\) error](<#UsersService.CreateUser>)
  - [func \(s \*UsersService\) ListUsers\(ctx context.Context\) error](<#UsersService.ListUsers>)
  - [func \(s \*UsersService\) RevokeUser\(ctx context.Context, email string\) error](<#UsersService.RevokeUser>)


<a name="Execute"></a>
## func [Execute](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/root.go#L109>)

```go
func Execute()
```

Execute runs the root command and handles cleanup of timeout context.

<a name="RootCmd"></a>
## func [RootCmd](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/root.go#L189>)

```go
func RootCmd() *cobra.Command
```

RootCmd returns the root command for use by tools like doc generators.

<a name="ClaimService"></a>
## type [ClaimService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/claim.go#L44-L48>)

ClaimService handles API key claiming logic

```go
type ClaimService struct {
    // contains filtered or unexported fields
}
```

<a name="NewClaimService"></a>
### func [NewClaimService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/claim.go#L51>)

```go
func NewClaimService(apiClient client.Interface, outputter OutputInterface, configSaver ConfigSaver) *ClaimService
```

NewClaimService creates a new ClaimService with the provided dependencies

<a name="ClaimService.ClaimAPIKey"></a>
### func \(\*ClaimService\) [ClaimAPIKey](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/claim.go#L60>)

```go
func (s *ClaimService) ClaimAPIKey(ctx context.Context, token string, cfg *config.Config) error
```

ClaimAPIKey claims an API key using the provided token and saves it to the config

<a name="ConfigLoader"></a>
## type [ConfigLoader](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L40-L42>)

ConfigLoader defines an interface for loading configuration

```go
type ConfigLoader interface {
    Load() (*config.Config, error)
}
```

<a name="NewConfigLoader"></a>
### func [NewConfigLoader](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L79>)

```go
func NewConfigLoader() ConfigLoader
```

NewConfigLoader creates a ConfigLoader using the global config.Load function

<a name="ConfigLoaderFunc"></a>
## type [ConfigLoaderFunc](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L55>)

ConfigLoaderFunc adapts a function to the ConfigLoader interface

```go
type ConfigLoaderFunc func() (*config.Config, error)
```

<a name="ConfigLoaderFunc.Load"></a>
### func \(ConfigLoaderFunc\) [Load](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L58>)

```go
func (f ConfigLoaderFunc) Load() (*config.Config, error)
```

Load executes the underlying function to load configuration

<a name="ConfigPathGetter"></a>
## type [ConfigPathGetter](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L50-L52>)

ConfigPathGetter defines an interface for retrieving the configuration path

```go
type ConfigPathGetter interface {
    GetConfigPath() (string, error)
}
```

<a name="NewConfigPathGetter"></a>
### func [NewConfigPathGetter](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L89>)

```go
func NewConfigPathGetter() ConfigPathGetter
```

NewConfigPathGetter creates a ConfigPathGetter using the global config.GetConfigPath function

<a name="ConfigPathGetterFunc"></a>
## type [ConfigPathGetterFunc](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L71>)

ConfigPathGetterFunc adapts a function to the ConfigPathGetter interface

```go
type ConfigPathGetterFunc func() (string, error)
```

<a name="ConfigPathGetterFunc.GetConfigPath"></a>
### func \(ConfigPathGetterFunc\) [GetConfigPath](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L74>)

```go
func (f ConfigPathGetterFunc) GetConfigPath() (string, error)
```

GetConfigPath executes the underlying function to retrieve the config path

<a name="ConfigSaver"></a>
## type [ConfigSaver](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L45-L47>)

ConfigSaver defines an interface for saving configuration

```go
type ConfigSaver interface {
    Save(*config.Config) error
}
```

<a name="NewConfigSaver"></a>
### func [NewConfigSaver](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L84>)

```go
func NewConfigSaver() ConfigSaver
```

NewConfigSaver creates a ConfigSaver using the global config.Save function

<a name="ConfigSaverFunc"></a>
## type [ConfigSaverFunc](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L63>)

ConfigSaverFunc adapts a function to the ConfigSaver interface

```go
type ConfigSaverFunc func(*config.Config) error
```

<a name="ConfigSaverFunc.Save"></a>
### func \(ConfigSaverFunc\) [Save](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L66>)

```go
func (f ConfigSaverFunc) Save(cfg *config.Config) error
```

Save executes the underlying function to persist configuration

<a name="ConfigureService"></a>
## type [ConfigureService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L94-L99>)

ConfigureService handles configuration logic

```go
type ConfigureService struct {
    // contains filtered or unexported fields
}
```

<a name="NewConfigureService"></a>
### func [NewConfigureService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L102-L107>)

```go
func NewConfigureService(outputter OutputInterface, configSaver ConfigSaver, configLoader ConfigLoader, configPathGetter ConfigPathGetter) *ConfigureService
```

NewConfigureService creates a new ConfigureService with the provided dependencies

<a name="ConfigureService.Configure"></a>
### func \(\*ConfigureService\) [Configure](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/configure.go#L117>)

```go
func (s *ConfigureService) Configure(_ context.Context) error
```

Configure runs the interactive configuration flow

<a name="ExecuteCommandRequest"></a>
## type [ExecuteCommandRequest](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/run.go#L108-L117>)

ExecuteCommandRequest contains all parameters needed to execute a command

```go
type ExecuteCommandRequest struct {
    Command string
    GitRepo string
    GitRef  string
    GitPath string
    Image   string
    Env     map[string]string
    Secrets []string
    WebURL  string
}
```

<a name="ImagesService"></a>
## type [ImagesService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/images.go#L165-L168>)

ImagesService handles image management logic

```go
type ImagesService struct {
    // contains filtered or unexported fields
}
```

<a name="NewImagesService"></a>
### func [NewImagesService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/images.go#L171>)

```go
func NewImagesService(apiClient client.Interface, outputter OutputInterface) *ImagesService
```

NewImagesService creates a new ImagesService with the provided dependencies

<a name="ImagesService.ListImages"></a>
### func \(\*ImagesService\) [ListImages](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/images.go#L200>)

```go
func (s *ImagesService) ListImages(ctx context.Context) error
```

ListImages lists all registered images

<a name="ImagesService.RegisterImage"></a>
### func \(\*ImagesService\) [RegisterImage](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/images.go#L179-L183>)

```go
func (s *ImagesService) RegisterImage(ctx context.Context, image string, isDefault *bool, taskRoleName, taskExecutionRoleName *string, cpu, memory *int, runtimePlatform *string) error
```

RegisterImage registers a new image

<a name="ImagesService.ShowImage"></a>
### func \(\*ImagesService\) [ShowImage](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/images.go#L226>)

```go
func (s *ImagesService) ShowImage(ctx context.Context, image string) error
```

ShowImage shows detailed information about a single image

<a name="ImagesService.UnregisterImage"></a>
### func \(\*ImagesService\) [UnregisterImage](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/images.go#L275>)

```go
func (s *ImagesService) UnregisterImage(ctx context.Context, image string) error
```

UnregisterImage unregisters an image

<a name="KillService"></a>
## type [KillService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/kill.go#L41-L44>)

KillService handles execution killing logic

```go
type KillService struct {
    // contains filtered or unexported fields
}
```

<a name="NewKillService"></a>
### func [NewKillService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/kill.go#L47>)

```go
func NewKillService(apiClient client.Interface, outputter OutputInterface) *KillService
```

NewKillService creates a new KillService with the provided dependencies

<a name="KillService.KillExecution"></a>
### func \(\*KillService\) [KillExecution](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/kill.go#L55>)

```go
func (s *KillService) KillExecution(ctx context.Context, executionID string) error
```

KillExecution kills a running execution and displays the results

<a name="ListService"></a>
## type [ListService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/list.go#L77-L80>)

ListService handles execution listing and formatting logic

```go
type ListService struct {
    // contains filtered or unexported fields
}
```

<a name="NewListService"></a>
### func [NewListService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/list.go#L83>)

```go
func NewListService(apiClient client.Interface, outputter OutputInterface) *ListService
```

NewListService creates a new ListService with the provided dependencies

<a name="ListService.ListExecutions"></a>
### func \(\*ListService\) [ListExecutions](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/list.go#L91>)

```go
func (s *ListService) ListExecutions(ctx context.Context, limit int, statuses string) error
```

ListExecutions lists executions with optional filtering and displays them in a table format

<a name="LogsService"></a>
## type [LogsService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/logs.go#L112-L116>)

LogsService handles log display logic

```go
type LogsService struct {
    // contains filtered or unexported fields
}
```

<a name="NewLogsService"></a>
### func [NewLogsService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/logs.go#L119>)

```go
func NewLogsService(apiClient client.Interface, outputter OutputInterface, sleeper Sleeper) *LogsService
```

NewLogsService creates a new LogsService with the provided dependencies

<a name="LogsService.DisplayLogs"></a>
### func \(\*LogsService\) [DisplayLogs](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/logs.go#L288>)

```go
func (s *LogsService) DisplayLogs(ctx context.Context, executionID, webURL string) error
```

DisplayLogs retrieves static logs and then streams new logs via WebSocket in real\-time If the execution has already completed, it displays static logs only and skips WebSocket streaming

<a name="OutputInterface"></a>
## type [OutputInterface](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/output_interface.go#L6-L17>)

OutputInterface defines the interface for output operations to enable dependency injection and testing

```go
type OutputInterface interface {
    Infof(format string, a ...any)
    Errorf(format string, a ...any)
    Successf(format string, a ...any)
    Warningf(format string, a ...any)
    Table(headers []string, rows [][]string)
    Blank()
    Bold(text string) string
    Cyan(text string) string
    KeyValue(key, value string)
    Prompt(prompt string) string
}
```

<a name="NewOutputWrapper"></a>
### func [NewOutputWrapper](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/output_interface.go#L23>)

```go
func NewOutputWrapper() OutputInterface
```

NewOutputWrapper creates a new output wrapper that implements OutputInterface

<a name="PlaybookOverrides"></a>
## type [PlaybookOverrides](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/playbook.go#L140-L146>)

PlaybookOverrides contains values to override in a playbook

```go
type PlaybookOverrides struct {
    Image   string
    GitRepo string
    GitRef  string
    GitPath string
    Secrets []string
}
```

<a name="PlaybookService"></a>
## type [PlaybookService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/playbook.go#L120-L124>)

PlaybookService handles playbook operations

```go
type PlaybookService struct {
    // contains filtered or unexported fields
}
```

<a name="NewPlaybookService"></a>
### func [NewPlaybookService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/playbook.go#L127-L131>)

```go
func NewPlaybookService(loader *playbooks.PlaybookLoader, executor *playbooks.PlaybookExecutor, outputter OutputInterface) *PlaybookService
```

NewPlaybookService creates a new PlaybookService

<a name="PlaybookService.ListPlaybooks"></a>
### func \(\*PlaybookService\) [ListPlaybooks](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/playbook.go#L149>)

```go
func (s *PlaybookService) ListPlaybooks(_ context.Context) error
```

ListPlaybooks lists all available playbooks

<a name="PlaybookService.RunPlaybook"></a>
### func \(\*PlaybookService\) [RunPlaybook](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/playbook.go#L241-L248>)

```go
func (s *PlaybookService) RunPlaybook(ctx context.Context, name string, userEnv map[string]string, overrides *PlaybookOverrides, webURL string, runService *RunService) error
```

RunPlaybook executes a playbook with optional overrides

<a name="PlaybookService.ShowPlaybook"></a>
### func \(\*PlaybookService\) [ShowPlaybook](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/playbook.go#L201>)

```go
func (s *PlaybookService) ShowPlaybook(_ context.Context, name string) error
```

ShowPlaybook displays the full content of a playbook

<a name="RealSleeper"></a>
## type [RealSleeper](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/logs.go#L34>)

RealSleeper implements Sleeper using the standard time.Sleep

```go
type RealSleeper struct{}
```

<a name="RealSleeper.Sleep"></a>
### func \(\*RealSleeper\) [Sleep](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/logs.go#L37>)

```go
func (r *RealSleeper) Sleep(duration time.Duration)
```

Sleep pauses execution for the specified duration

<a name="RunService"></a>
## type [RunService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/run.go#L120-L123>)

RunService handles command execution logic

```go
type RunService struct {
    // contains filtered or unexported fields
}
```

<a name="NewRunService"></a>
### func [NewRunService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/run.go#L126>)

```go
func NewRunService(apiClient client.Interface, outputter OutputInterface) *RunService
```

NewRunService creates a new RunService with the provided dependencies

<a name="RunService.ExecuteCommand"></a>
### func \(\*RunService\) [ExecuteCommand](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/run.go#L134>)

```go
func (s *RunService) ExecuteCommand(ctx context.Context, req *ExecuteCommandRequest) error
```

ExecuteCommand executes a command remotely and displays the results

<a name="SecretsService"></a>
## type [SecretsService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/secrets.go#L160-L163>)

SecretsService handles secrets management logic

```go
type SecretsService struct {
    // contains filtered or unexported fields
}
```

<a name="NewSecretsService"></a>
### func [NewSecretsService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/secrets.go#L166>)

```go
func NewSecretsService(apiClient client.Interface, outputter OutputInterface) *SecretsService
```

NewSecretsService creates a new SecretsService with the provided dependencies

<a name="SecretsService.CreateSecret"></a>
### func \(\*SecretsService\) [CreateSecret](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/secrets.go#L174>)

```go
func (s *SecretsService) CreateSecret(ctx context.Context, name, keyName, value, description string) error
```

CreateSecret creates a new secret with the given name, key name, value, and optional description

<a name="SecretsService.DeleteSecret"></a>
### func \(\*SecretsService\) [DeleteSecret](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/secrets.go#L305>)

```go
func (s *SecretsService) DeleteSecret(ctx context.Context, name string) error
```

DeleteSecret deletes a secret by name

<a name="SecretsService.GetSecret"></a>
### func \(\*SecretsService\) [GetSecret](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/secrets.go#L203>)

```go
func (s *SecretsService) GetSecret(ctx context.Context, name string) error
```

GetSecret retrieves a secret by name

<a name="SecretsService.ListSecrets"></a>
### func \(\*SecretsService\) [ListSecrets](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/secrets.go#L241>)

```go
func (s *SecretsService) ListSecrets(ctx context.Context) error
```

ListSecrets lists all secrets and displays them in a table format

<a name="SecretsService.UpdateSecret"></a>
### func \(\*SecretsService\) [UpdateSecret](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/secrets.go#L274>)

```go
func (s *SecretsService) UpdateSecret(ctx context.Context, name, keyName, value, description string) error
```

UpdateSecret updates a secret's metadata and/or value

<a name="Sleeper"></a>
## type [Sleeper](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/logs.go#L29-L31>)

Sleeper provides a testable interface for introducing delays

```go
type Sleeper interface {
    Sleep(duration time.Duration)
}
```

<a name="StatusService"></a>
## type [StatusService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/status.go#L40-L43>)

StatusService handles status display logic

```go
type StatusService struct {
    // contains filtered or unexported fields
}
```

<a name="NewStatusService"></a>
### func [NewStatusService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/status.go#L46>)

```go
func NewStatusService(apiClient client.Interface, outputter OutputInterface) *StatusService
```

NewStatusService creates a new StatusService with the provided dependencies

<a name="StatusService.DisplayStatus"></a>
### func \(\*StatusService\) [DisplayStatus](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/status.go#L54>)

```go
func (s *StatusService) DisplayStatus(ctx context.Context, executionID string) error
```

DisplayStatus retrieves and displays the status of an execution

<a name="TraceService"></a>
## type [TraceService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/trace.go#L43-L46>)

TraceService handles backend logs display logic

```go
type TraceService struct {
    // contains filtered or unexported fields
}
```

<a name="NewTraceService"></a>
### func [NewTraceService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/trace.go#L49>)

```go
func NewTraceService(apiClient client.Interface, outputter OutputInterface) *TraceService
```

NewTraceService creates a new TraceService with the provided dependencies

<a name="TraceService.DisplayBackendLogs"></a>
### func \(\*TraceService\) [DisplayBackendLogs](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/trace.go#L59>)

```go
func (s *TraceService) DisplayBackendLogs(ctx context.Context, requestID string) error
```

DisplayBackendLogs retrieves and displays backend infrastructure logs and related resources for a request ID

<a name="UsersService"></a>
## type [UsersService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/users.go#L86-L89>)

UsersService handles user management logic

```go
type UsersService struct {
    // contains filtered or unexported fields
}
```

<a name="NewUsersService"></a>
### func [NewUsersService](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/users.go#L92>)

```go
func NewUsersService(apiClient client.Interface, outputter OutputInterface) *UsersService
```

NewUsersService creates a new UsersService with the provided dependencies

<a name="UsersService.CreateUser"></a>
### func \(\*UsersService\) [CreateUser](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/users.go#L100>)

```go
func (s *UsersService) CreateUser(ctx context.Context, email, role string) error
```

CreateUser creates a new user with the given email and role

<a name="UsersService.ListUsers"></a>
### func \(\*UsersService\) [ListUsers](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/users.go#L128>)

```go
func (s *UsersService) ListUsers(ctx context.Context) error
```

ListUsers lists all users and displays them in a table format

<a name="UsersService.RevokeUser"></a>
### func \(\*UsersService\) [RevokeUser](<https://github.com/runvoy/runvoy/blob/main/cmd/cli/cmd/users.go#L161>)

```go
func (s *UsersService) RevokeUser(ctx context.Context, email string) error
```

RevokeUser revokes a user's API key

# server

```go
import "runvoy/cmd/local/server"
```

Package server provides the async event processor HTTP server setup.

## Index

- [func NewRouter\(proc processor.Processor, log \*slog.Logger\) \*chi.Mux](<#NewRouter>)


<a name="NewRouter"></a>
## func [NewRouter](<https://github.com/runvoy/runvoy/blob/main/cmd/local/server/server.go#L18>)

```go
func NewRouter(proc processor.Processor, log *slog.Logger) *chi.Mux
```

NewRouter creates a chi router for the async event processor.

# authorization

```go
import "runvoy/internal/auth/authorization"
```

Package authorization provides Casbin\-based authorization enforcement for runvoy. It implements role\-based access control \(RBAC\) with resource ownership support.

## Index

- [Variables](<#variables>)
- [func FormatResourceID\(resourceType, resourceID string\) string](<#FormatResourceID>)
- [func FormatRole\(role Role\) string](<#FormatRole>)
- [func IsValidRole\(roleStr string\) bool](<#IsValidRole>)
- [func NewEmbeddedAdapter\(fsys fs.FS, pathBase string\) persist.Adapter](<#NewEmbeddedAdapter>)
- [func ValidRoles\(\) \[\]string](<#ValidRoles>)
- [type Action](<#Action>)
- [type Enforcer](<#Enforcer>)
  - [func NewEnforcer\(log \*slog.Logger\) \(\*Enforcer, error\)](<#NewEnforcer>)
  - [func \(e \*Enforcer\) AddOwnershipForResource\(ctx context.Context, resourceID, ownerEmail string\) error](<#Enforcer.AddOwnershipForResource>)
  - [func \(e \*Enforcer\) AddRoleForUser\(ctx context.Context, user string, role Role\) error](<#Enforcer.AddRoleForUser>)
  - [func \(e \*Enforcer\) Enforce\(ctx context.Context, subject, object string, action Action\) \(bool, error\)](<#Enforcer.Enforce>)
  - [func \(e \*Enforcer\) GetAllNamedGroupingPolicies\(ptype string\) \(\[\]\[\]string, error\)](<#Enforcer.GetAllNamedGroupingPolicies>)
  - [func \(e \*Enforcer\) GetRolesForUser\(user string\) \(\[\]string, error\)](<#Enforcer.GetRolesForUser>)
  - [func \(e \*Enforcer\) HasOwnershipForResource\(resourceID, ownerEmail string\) \(bool, error\)](<#Enforcer.HasOwnershipForResource>)
  - [func \(e \*Enforcer\) Hydrate\(ctx context.Context, userRepo database.UserRepository, executionRepo database.ExecutionRepository, secretsRepo database.SecretsRepository, imageRepo ImageRepository\) error](<#Enforcer.Hydrate>)
  - [func \(e \*Enforcer\) LoadResourceOwnerships\(ctx context.Context, ownerships map\[string\]string\) error](<#Enforcer.LoadResourceOwnerships>)
  - [func \(e \*Enforcer\) LoadRolesForUsers\(ctx context.Context, userRoles map\[string\]string\) error](<#Enforcer.LoadRolesForUsers>)
  - [func \(e \*Enforcer\) RemoveAllOwnershipsForResource\(ctx context.Context, resourceID string\) error](<#Enforcer.RemoveAllOwnershipsForResource>)
  - [func \(e \*Enforcer\) RemoveOwnershipForResource\(ctx context.Context, resourceID, ownerEmail string\) error](<#Enforcer.RemoveOwnershipForResource>)
  - [func \(e \*Enforcer\) RemoveRoleForUser\(ctx context.Context, user, role string\) error](<#Enforcer.RemoveRoleForUser>)
- [type ImageRepository](<#ImageRepository>)
- [type Role](<#Role>)
  - [func NewRole\(roleStr string\) \(Role, error\)](<#NewRole>)
  - [func \(r Role\) String\(\) string](<#Role.String>)
  - [func \(r Role\) Valid\(\) bool](<#Role.Valid>)


## Variables

<a name="CasbinFS"></a>CasbinFS embeds the Casbin model and policy files into the binary. This allows the application to run without requiring these files to be present on the filesystem.

```go
var CasbinFS embed.FS
```

<a name="FormatResourceID"></a>
## func [FormatResourceID](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/roles.go#L75>)

```go
func FormatResourceID(resourceType, resourceID string) string
```

FormatResourceID converts a resource type and ID to the Casbin resource format. Example: FormatResourceID\("secret", "secret\-123"\) returns "secret:secret\-123"

<a name="FormatRole"></a>
## func [FormatRole](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/roles.go#L69>)

```go
func FormatRole(role Role) string
```

FormatRole converts a role to the Casbin role format. Example: FormatRole\(RoleAdmin\) returns "role:admin"

<a name="IsValidRole"></a>
## func [IsValidRole](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/roles.go#L85>)

```go
func IsValidRole(roleStr string) bool
```

IsValidRole checks if a role name string is valid.

<a name="NewEmbeddedAdapter"></a>
## func [NewEmbeddedAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L36>)

```go
func NewEmbeddedAdapter(fsys fs.FS, pathBase string) persist.Adapter
```

NewEmbeddedAdapter creates a new adapter for reading Casbin config from an embedded filesystem. The adapter supports in\-memory policy modifications at runtime but does not persist changes back to the embedded files, as they are read\-only.

<a name="ValidRoles"></a>
## func [ValidRoles](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/roles.go#L80>)

```go
func ValidRoles() []string
```

ValidRoles returns a list of all valid role names as strings.

<a name="Action"></a>
## type [Action](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/roles.go#L30>)

Action is a typed string representing an action in the authorization system.

```go
type Action string
```

<a name="ActionCreate"></a>Action constants for Casbin enforcement. These correspond to the HTTP methods mapped to CRUD actions.

```go
const (
    ActionCreate Action = "create"
    ActionRead   Action = "read"
    ActionUpdate Action = "update"
    ActionDelete Action = "delete"
    ActionKill   Action = "kill"
    ActionUse    Action = "use"
)
```

<a name="Enforcer"></a>
## type [Enforcer](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L21-L24>)

Enforcer wraps the Casbin enforcer with additional functionality.

```go
type Enforcer struct {
    // contains filtered or unexported fields
}
```

<a name="NewEnforcer"></a>
### func [NewEnforcer](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L97>)

```go
func NewEnforcer(log *slog.Logger) (*Enforcer, error)
```

NewEnforcer creates a new Casbin enforcer using embedded Casbin configuration files. The model and policy are embedded in the binary at build time, so no filesystem access is required.

<a name="Enforcer.AddOwnershipForResource"></a>
### func \(\*Enforcer\) [AddOwnershipForResource](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L207>)

```go
func (e *Enforcer) AddOwnershipForResource(ctx context.Context, resourceID, ownerEmail string) error
```

AddOwnershipForResource adds ownership mapping for a resource. This allows the owner to access their own resources.

Example usage:

```
err := e.AddOwnershipForResource(ctx, "secret:secret-123", "user@example.com")
```

<a name="Enforcer.AddRoleForUser"></a>
### func \(\*Enforcer\) [AddRoleForUser](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L158>)

```go
func (e *Enforcer) AddRoleForUser(ctx context.Context, user string, role Role) error
```

AddRoleForUser assigns a role to a user. Returns an error if the role is invalid or empty.

Example usage:

```
err := e.AddRoleForUser(ctx, "user@example.com", RoleDeveloper)
```

<a name="Enforcer.Enforce"></a>
### func \(\*Enforcer\) [Enforce](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L128>)

```go
func (e *Enforcer) Enforce(ctx context.Context, subject, object string, action Action) (bool, error)
```

Enforce checks if a subject \(user\) can perform an action on an object \(resource\). Returns true if the action is allowed, false otherwise.

Example usage:

```
allowed, err := e.Enforce(ctx, "user@example.com", "/api/secrets/secret-123", "read")
```

<a name="Enforcer.GetAllNamedGroupingPolicies"></a>
### func \(\*Enforcer\) [GetAllNamedGroupingPolicies](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L313>)

```go
func (e *Enforcer) GetAllNamedGroupingPolicies(ptype string) ([][]string, error)
```

GetAllNamedGroupingPolicies returns all grouping policies for the given policy type \(e.g., "g2" for ownership\).

<a name="Enforcer.GetRolesForUser"></a>
### func \(\*Enforcer\) [GetRolesForUser](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L304>)

```go
func (e *Enforcer) GetRolesForUser(user string) ([]string, error)
```

GetRolesForUser returns all roles assigned to a user.

<a name="Enforcer.HasOwnershipForResource"></a>
### func \(\*Enforcer\) [HasOwnershipForResource](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L253>)

```go
func (e *Enforcer) HasOwnershipForResource(resourceID, ownerEmail string) (bool, error)
```

HasOwnershipForResource checks if the provided user currently owns the resource.

<a name="Enforcer.Hydrate"></a>
### func \(\*Enforcer\) [Hydrate](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/hydrate.go#L22-L28>)

```go
func (e *Enforcer) Hydrate(ctx context.Context, userRepo database.UserRepository, executionRepo database.ExecutionRepository, secretsRepo database.SecretsRepository, imageRepo ImageRepository) error
```

Hydrate loads all user roles and resource ownerships into the Casbin enforcer. This should be called during initialization to populate the enforcer with current data.

<a name="Enforcer.LoadResourceOwnerships"></a>
### func \(\*Enforcer\) [LoadResourceOwnerships](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L262>)

```go
func (e *Enforcer) LoadResourceOwnerships(ctx context.Context, ownerships map[string]string) error
```

LoadResourceOwnerships loads resource ownership mappings into the enforcer.

<a name="Enforcer.LoadRolesForUsers"></a>
### func \(\*Enforcer\) [LoadRolesForUsers](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L286>)

```go
func (e *Enforcer) LoadRolesForUsers(ctx context.Context, userRoles map[string]string) error
```

LoadRolesForUsers loads role assignments for multiple users into the enforcer. This is typically called at startup to initialize the enforcer with current user roles. The roleStr values should be valid role names \(admin, operator, developer, viewer\).

Example usage:

```
roles := map[string]string{
  "admin@example.com": "admin",
  "dev@example.com": "developer",
}
err := e.LoadRolesForUsers(ctx, roles)
```

<a name="Enforcer.RemoveAllOwnershipsForResource"></a>
### func \(\*Enforcer\) [RemoveAllOwnershipsForResource](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L242>)

```go
func (e *Enforcer) RemoveAllOwnershipsForResource(ctx context.Context, resourceID string) error
```

RemoveAllOwnershipsForResource removes every ownership mapping for the given resource identifier. This is useful when deleting a resource without knowing its owner ahead of time.

<a name="Enforcer.RemoveOwnershipForResource"></a>
### func \(\*Enforcer\) [RemoveOwnershipForResource](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L224>)

```go
func (e *Enforcer) RemoveOwnershipForResource(ctx context.Context, resourceID, ownerEmail string) error
```

RemoveOwnershipForResource removes ownership mapping for a resource.

<a name="Enforcer.RemoveRoleForUser"></a>
### func \(\*Enforcer\) [RemoveRoleForUser](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/enforcer.go#L185>)

```go
func (e *Enforcer) RemoveRoleForUser(ctx context.Context, user, role string) error
```

RemoveRoleForUser removes a role from a user.

Example usage:

```
err := e.RemoveRoleForUser(ctx, "user@example.com", "role:developer")
```

<a name="ImageRepository"></a>
## type [ImageRepository](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/hydrate.go#L16-L18>)

ImageRepository defines the interface for listing images. This is a minimal interface to avoid import cycles.

```go
type ImageRepository interface {
    ListImages(ctx context.Context) ([]api.ImageInfo, error)
}
```

<a name="Role"></a>
## type [Role](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/roles.go#L11>)

Role is a typed string representing a user role in the authorization system. Valid roles: admin, operator, developer, viewer

```go
type Role string
```

<a name="RoleAdmin"></a>Role constants for Casbin role\-based access control. These correspond to the roles defined in casbin/policy.csv.

```go
const (
    // RoleAdmin has full access to all resources and operations.
    RoleAdmin Role = "admin"

    // RoleOperator can manage images, secrets, and executions but cannot manage users.
    RoleOperator Role = "operator"

    // RoleDeveloper can create and manage their own resources and execute commands.
    RoleDeveloper Role = "developer"

    // RoleViewer has read-only access to executions.
    RoleViewer Role = "viewer"
)
```

<a name="NewRole"></a>
### func [NewRole](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/roles.go#L45>)

```go
func NewRole(roleStr string) (Role, error)
```

NewRole creates a new Role from a string, validating it against known roles. Returns an error if the role string is empty or not a valid role.

<a name="Role.String"></a>
### func \(Role\) [String](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/roles.go#L63>)

```go
func (r Role) String() string
```

String returns the string representation of the role.

<a name="Role.Valid"></a>
### func \(Role\) [Valid](<https://github.com/runvoy/runvoy/blob/main/internal/auth/authorization/roles.go#L58>)

```go
func (r Role) Valid() bool
```

Valid checks if the role is a valid known role.

# contract

```go
import "runvoy/internal/backend/contract"
```

Package contract defines all backend interfaces that providers must implement. These interfaces are separated into their own package to avoid circular dependencies between backend services \(orchestrator, processor\) and provider implementations. This package serves as the single source of truth for all backend provider dependencies.

## Index

- [type HealthManager](<#HealthManager>)
- [type ImageRegistry](<#ImageRegistry>)
- [type LogManager](<#LogManager>)
- [type ObservabilityManager](<#ObservabilityManager>)
- [type TaskManager](<#TaskManager>)
- [type WebSocketManager](<#WebSocketManager>)


<a name="HealthManager"></a>
## type [HealthManager](<https://github.com/runvoy/runvoy/blob/main/internal/backend/contract/interfaces.go#L106-L111>)

HealthManager abstracts provider\-specific health checks and resource reconciliation. This interface handles verifying and repairing inconsistencies between metadata storage and cloud resources.

```go
type HealthManager interface {
    // Reconcile checks and repairs inconsistencies between metadata storage and actual cloud resources.
    // It verifies compute resources (e.g., task definitions, containers), secrets, and identity/access resources.
    // Returns a comprehensive health report with all issues found and actions taken.
    Reconcile(ctx context.Context) (*api.HealthReport, error)
}
```

<a name="ImageRegistry"></a>
## type [ImageRegistry](<https://github.com/runvoy/runvoy/blob/main/internal/backend/contract/interfaces.go#L33-L60>)

ImageRegistry abstracts provider\-specific image management. This interface handles image registration, configuration, and lifecycle management.

```go
type ImageRegistry interface {
    // RegisterImage registers a Docker image as a task definition in the execution platform.
    // isDefault: if true, explicitly set as default.
    // taskRoleName: optional custom task role name (if nil, uses default from config).
    // taskExecutionRoleName: optional custom task execution role name (if nil, uses default from config).
    // cpu: optional CPU value (e.g., 256, 1024). Defaults to 256 if nil.
    // memory: optional Memory value in MB (e.g., 512, 2048). Defaults to 512 if nil.
    // runtimePlatform: optional runtime platform (e.g., "Linux/ARM64", "Linux/X86_64"). Defaults to "Linux/ARM64" if nil.
    // createdBy: email of the user registering the image.
    RegisterImage(
        ctx context.Context,
        image string,
        isDefault *bool,
        taskRoleName, taskExecutionRoleName *string,
        cpu, memory *int,
        runtimePlatform *string,
        createdBy string,
    ) error
    // ListImages lists all registered Docker images.
    ListImages(ctx context.Context) ([]api.ImageInfo, error)

    // GetImage retrieves a single Docker image by ID or name.
    // Accepts either an ImageID (e.g., "alpine:latest-a1b2c3d4") or an image name (e.g., "alpine:latest").
    GetImage(ctx context.Context, image string) (*api.ImageInfo, error)

    // RemoveImage removes a Docker image and deregisters its task definitions.
    RemoveImage(ctx context.Context, image string) error
}
```

<a name="LogManager"></a>
## type [LogManager](<https://github.com/runvoy/runvoy/blob/main/internal/backend/contract/interfaces.go#L64-L69>)

LogManager abstracts provider\-specific execution log retrieval. This interface handles fetching logs from user task executions.

```go
type LogManager interface {
    // FetchLogsByExecutionID retrieves execution logs for a specific execution.
    // Returns logs generated by the user's command execution in containers.
    // Returns empty slice if logs are not available or not supported by the provider.
    FetchLogsByExecutionID(ctx context.Context, executionID string) ([]api.LogEvent, error)
}
```

<a name="ObservabilityManager"></a>
## type [ObservabilityManager](<https://github.com/runvoy/runvoy/blob/main/internal/backend/contract/interfaces.go#L73-L77>)

ObservabilityManager provides access to backend infrastructure logs and metrics. This interface is for platform debugging and observability, separate from user execution logs.

```go
type ObservabilityManager interface {
    // FetchBackendLogs retrieves logs from the backend services for the provided requestID.
    // Returns logs from the backend services for debugging and tracing.
    FetchBackendLogs(ctx context.Context, requestID string) ([]api.LogEvent, error)
}
```

<a name="TaskManager"></a>
## type [TaskManager](<https://github.com/runvoy/runvoy/blob/main/internal/backend/contract/interfaces.go#L18-L29>)

TaskManager abstracts provider\-specific task execution \(e.g., AWS ECS, GCP Cloud Run, Azure Container Instances\). This interface handles the core responsibility of running and managing task lifecycles.

```go
type TaskManager interface {
    // StartTask triggers an execution on the underlying platform and returns
    // a stable executionID and the task creation timestamp.
    // The createdAt timestamp comes from the provider (e.g., ECS CreatedAt) when available.
    StartTask(
        ctx context.Context,
        userEmail string,
        req *api.ExecutionRequest) (executionID string, createdAt *time.Time, err error)
    // KillTask terminates a running task identified by executionID.
    // Returns an error if the task is already terminated or cannot be terminated.
    KillTask(ctx context.Context, executionID string) error
}
```

<a name="WebSocketManager"></a>
## type [WebSocketManager](<https://github.com/runvoy/runvoy/blob/main/internal/backend/contract/interfaces.go#L81-L102>)

WebSocketManager abstracts provider\-specific WebSocket management. This interface handles WebSocket connection lifecycle and log streaming.

```go
type WebSocketManager interface {
    // HandleRequest processes WebSocket lifecycle events (connect, disconnect, etc.).
    // Returns true if the event was handled, false otherwise.
    HandleRequest(ctx context.Context, rawEvent *json.RawMessage, reqLogger *slog.Logger) (bool, error)

    // NotifyExecutionCompletion sends disconnect notifications to all connected clients for an execution
    // and removes the connections.
    NotifyExecutionCompletion(ctx context.Context, executionID *string) error

    // SendLogsToExecution sends log events to all connected clients for an execution.
    SendLogsToExecution(ctx context.Context, executionID *string, logEvents []api.LogEvent) error

    // GenerateWebSocketURL creates a WebSocket token and returns the connection URL.
    // It stores the token for validation when the client connects.
    // Returns an empty string if URL generation fails (errors are logged).
    GenerateWebSocketURL(
        ctx context.Context,
        executionID string,
        userEmail *string,
        clientIPAtCreationTime *string,
    ) string
}
```

# health

```go
import "runvoy/internal/backend/health"
```

Package health provides health management functionality for runvoy. It defines the interface for reconciling resources between metadata storage and cloud provider services.

## Index

- [type AuthorizerHealthStatus](<#AuthorizerHealthStatus>)
- [type ComputeHealthStatus](<#ComputeHealthStatus>)
- [type IdentityHealthStatus](<#IdentityHealthStatus>)
- [type Issue](<#Issue>)
- [type Manager](<#Manager>)
- [type Report](<#Report>)
- [type SecretsHealthStatus](<#SecretsHealthStatus>)


<a name="AuthorizerHealthStatus"></a>
## type [AuthorizerHealthStatus](<https://github.com/runvoy/runvoy/blob/main/internal/backend/health/health.go#L60-L68>)

AuthorizerHealthStatus contains the health status for authorization data.

```go
type AuthorizerHealthStatus struct {
    UsersWithInvalidRoles      []string
    UsersWithMissingRoles      []string
    ResourcesWithMissingOwners []string
    OrphanedOwnerships         []string
    MissingOwnerships          []string
    TotalUsersChecked          int
    TotalResourcesChecked      int
}
```

<a name="ComputeHealthStatus"></a>
## type [ComputeHealthStatus](<https://github.com/runvoy/runvoy/blob/main/internal/backend/health/health.go#L32-L39>)

ComputeHealthStatus contains the health status for compute resources \(e.g., containers, task definitions\).

```go
type ComputeHealthStatus struct {
    TotalResources    int
    VerifiedCount     int
    RecreatedCount    int
    TagUpdatedCount   int
    OrphanedCount     int
    OrphanedResources []string
}
```

<a name="IdentityHealthStatus"></a>
## type [IdentityHealthStatus](<https://github.com/runvoy/runvoy/blob/main/internal/backend/health/health.go#L52-L57>)

IdentityHealthStatus contains the health status for identity and access management resources.

```go
type IdentityHealthStatus struct {
    DefaultRolesVerified bool
    CustomRolesVerified  int
    CustomRolesTotal     int
    MissingRoles         []string
}
```

<a name="Issue"></a>
## type [Issue](<https://github.com/runvoy/runvoy/blob/main/internal/backend/health/health.go#L71-L77>)

Issue represents a single health issue found during reconciliation.

```go
type Issue struct {
    ResourceType string // Provider-specific resource type (e.g., "ecs_task_definition", "cloud_run_service")
    ResourceID   string
    Severity     string // "error", "warning"
    Message      string
    Action       string // "recreated", "requires_manual_intervention", "reported", "tag_updated"
}
```

<a name="Manager"></a>
## type [Manager](<https://github.com/runvoy/runvoy/blob/main/internal/backend/health/health.go#L12-L17>)

Manager defines the interface for health checks and resource reconciliation. Different cloud providers can implement this interface to support their specific infrastructure.

```go
type Manager interface {
    // Reconcile checks and repairs inconsistencies between metadata storage and actual cloud resources.
    // It verifies compute resources (e.g., task definitions, containers), secrets, and identity/access resources.
    // Returns a comprehensive health report with all issues found and actions taken.
    Reconcile(ctx context.Context) (*Report, error)
}
```

<a name="Report"></a>
## type [Report](<https://github.com/runvoy/runvoy/blob/main/internal/backend/health/health.go#L20-L29>)

Report contains the results of a health reconciliation run.

```go
type Report struct {
    Timestamp        time.Time
    ComputeStatus    ComputeHealthStatus
    SecretsStatus    SecretsHealthStatus
    IdentityStatus   IdentityHealthStatus
    AuthorizerStatus AuthorizerHealthStatus
    Issues           []Issue
    ReconciledCount  int
    ErrorCount       int
}
```

<a name="SecretsHealthStatus"></a>
## type [SecretsHealthStatus](<https://github.com/runvoy/runvoy/blob/main/internal/backend/health/health.go#L42-L49>)

SecretsHealthStatus contains the health status for secrets/parameters.

```go
type SecretsHealthStatus struct {
    TotalSecrets       int
    VerifiedCount      int
    TagUpdatedCount    int
    MissingCount       int
    OrphanedCount      int
    OrphanedParameters []string
}
```

# orchestrator

```go
import "runvoy/internal/backend/orchestrator"
```

Package orchestrator provides the core orchestrator service for runvoy. This file contains health reconciliation functionality.

Package orchestrator provides the core orchestrator service for runvoy. It initializes and manages command execution and API request handling.

## Index

- [type ImageConfig](<#ImageConfig>)
- [type PermissionConfig](<#PermissionConfig>)
- [type ResourceConfig](<#ResourceConfig>)
- [type RuntimeConfig](<#RuntimeConfig>)
- [type Service](<#Service>)
  - [func Initialize\(ctx context.Context, cfg \*config.Config, baseLogger \*slog.Logger\) \(\*Service, error\)](<#Initialize>)
  - [func NewService\(ctx context.Context, repos \*database.Repositories, taskManager contract.TaskManager, imageRegistry contract.ImageRegistry, logManager contract.LogManager, observabilityManager contract.ObservabilityManager, log \*slog.Logger, provider constants.BackendProvider, wsManager contract.WebSocketManager, healthManager contract.HealthManager, enforcer \*authorization.Enforcer\) \(\*Service, error\)](<#NewService>)
  - [func \(s \*Service\) AuthenticateUser\(ctx context.Context, apiKey string\) \(\*api.User, error\)](<#Service.AuthenticateUser>)
  - [func \(s \*Service\) ClaimAPIKey\(ctx context.Context, secretToken string, ipAddress string\) \(\*api.ClaimAPIKeyResponse, error\)](<#Service.ClaimAPIKey>)
  - [func \(s \*Service\) CreateSecret\(ctx context.Context, req \*api.CreateSecretRequest, userEmail string\) error](<#Service.CreateSecret>)
  - [func \(s \*Service\) CreateUser\(ctx context.Context, req api.CreateUserRequest, createdByEmail string\) \(\*api.CreateUserResponse, error\)](<#Service.CreateUser>)
  - [func \(s \*Service\) DeleteSecret\(ctx context.Context, name string\) error](<#Service.DeleteSecret>)
  - [func \(s \*Service\) FetchBackendLogs\(ctx context.Context, requestID string\) \(\[\]api.LogEvent, error\)](<#Service.FetchBackendLogs>)
  - [func \(s \*Service\) FetchTrace\(ctx context.Context, requestID string\) \(\*api.TraceResponse, error\)](<#Service.FetchTrace>)
  - [func \(s \*Service\) GetEnforcer\(\) \*authorization.Enforcer](<#Service.GetEnforcer>)
  - [func \(s \*Service\) GetExecutionStatus\(ctx context.Context, executionID string\) \(\*api.ExecutionStatusResponse, error\)](<#Service.GetExecutionStatus>)
  - [func \(s \*Service\) GetImage\(ctx context.Context, image string\) \(\*api.ImageInfo, error\)](<#Service.GetImage>)
  - [func \(s \*Service\) GetLogsByExecutionID\(ctx context.Context, executionID string, userEmail \*string, clientIPAtCreationTime \*string\) \(\*api.LogsResponse, error\)](<#Service.GetLogsByExecutionID>)
  - [func \(s \*Service\) GetSecret\(ctx context.Context, name string\) \(\*api.Secret, error\)](<#Service.GetSecret>)
  - [func \(s \*Service\) ImageRegistry\(\) contract.ImageRegistry](<#Service.ImageRegistry>)
  - [func \(s \*Service\) KillExecution\(ctx context.Context, executionID string\) \(\*api.KillExecutionResponse, error\)](<#Service.KillExecution>)
  - [func \(s \*Service\) ListExecutions\(ctx context.Context, limit int, statuses \[\]string\) \(\[\]\*api.Execution, error\)](<#Service.ListExecutions>)
  - [func \(s \*Service\) ListImages\(ctx context.Context\) \(\*api.ListImagesResponse, error\)](<#Service.ListImages>)
  - [func \(s \*Service\) ListSecrets\(ctx context.Context\) \(\[\]\*api.Secret, error\)](<#Service.ListSecrets>)
  - [func \(s \*Service\) ListUsers\(ctx context.Context\) \(\*api.ListUsersResponse, error\)](<#Service.ListUsers>)
  - [func \(s \*Service\) LogManager\(\) contract.LogManager](<#Service.LogManager>)
  - [func \(s \*Service\) ObservabilityManager\(\) contract.ObservabilityManager](<#Service.ObservabilityManager>)
  - [func \(s \*Service\) ReconcileResources\(ctx context.Context\) \(\*api.HealthReport, error\)](<#Service.ReconcileResources>)
  - [func \(s \*Service\) RegisterImage\(ctx context.Context, req \*api.RegisterImageRequest, createdBy string\) \(\*api.RegisterImageResponse, error\)](<#Service.RegisterImage>)
  - [func \(s \*Service\) RemoveImage\(ctx context.Context, image string\) error](<#Service.RemoveImage>)
  - [func \(s \*Service\) ResolveImage\(ctx context.Context, image string\) \(\*api.ImageInfo, error\)](<#Service.ResolveImage>)
  - [func \(s \*Service\) RevokeUser\(ctx context.Context, email string\) error](<#Service.RevokeUser>)
  - [func \(s \*Service\) RunCommand\(ctx context.Context, userEmail string, req \*api.ExecutionRequest, resolvedImage \*api.ImageInfo\) \(\*api.ExecutionResponse, error\)](<#Service.RunCommand>)
  - [func \(s \*Service\) TaskManager\(\) contract.TaskManager](<#Service.TaskManager>)
  - [func \(s \*Service\) UpdateSecret\(ctx context.Context, name string, req \*api.UpdateSecretRequest, userEmail string\) error](<#Service.UpdateSecret>)
  - [func \(s \*Service\) UpdateUserLastUsed\(ctx context.Context, email string\) \(\*time.Time, error\)](<#Service.UpdateUserLastUsed>)
  - [func \(s \*Service\) ValidateExecutionResourceAccess\(ctx context.Context, userEmail string, req \*api.ExecutionRequest, resolvedImage \*api.ImageInfo\) error](<#Service.ValidateExecutionResourceAccess>)


<a name="ImageConfig"></a>
## type [ImageConfig](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/image_config.go#L5-L23>)

ImageConfig provides a provider\-agnostic way to configure image registration. It abstracts away provider\-specific details like IAM roles \(AWS\), service accounts \(GCP\), etc.

```go
type ImageConfig struct {
    // Image is the Docker image reference (e.g., "alpine:latest", "gcr.io/project/image:tag")
    Image string

    // IsDefault marks this image as the default for executions when no image is specified
    IsDefault *bool

    // Resources specifies compute resource requirements
    Resources *ResourceConfig

    // Runtime specifies platform and architecture requirements
    Runtime *RuntimeConfig

    // Permissions specifies execution permissions and roles
    Permissions *PermissionConfig

    // RegisteredBy tracks which user registered this image
    RegisteredBy string
}
```

<a name="PermissionConfig"></a>
## type [PermissionConfig](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/image_config.go#L54-L63>)

PermissionConfig abstracts execution permissions across providers. Different providers handle permissions differently: \- AWS: TaskRole \(app permissions\) and TaskExecutionRole \(infrastructure permissions\) \- GCP: Service Account \- Azure: Managed Identity

```go
type PermissionConfig struct {
    // TaskRole grants permissions to the running task/container
    // AWS: IAM role name, GCP: service account email, Azure: managed identity client ID
    TaskRole *string

    // ExecutionRole grants permissions to infrastructure to start the task
    // AWS-specific: IAM role for ECS to pull images, write logs, etc.
    // Not used by GCP or Azure
    ExecutionRole *string
}
```

<a name="ResourceConfig"></a>
## type [ResourceConfig](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/image_config.go#L30-L39>)

ResourceConfig abstracts CPU and memory requirements across providers. Different providers have different granularities and limits: \- AWS ECS: CPU in units \(256, 512, 1024, etc.\), Memory in MB \- GCP Cloud Run: CPU in millicores, Memory in MB/GB \- Azure Container Instances: CPU cores \(0.5, 1, 2, 4\), Memory in GB

```go
type ResourceConfig struct {
    // CPU in provider-specific units:
    // - AWS ECS: 256, 512, 1024, 2048, 4096 (CPU units)
    // - GCP Cloud Run: 1000, 2000, 4000 (millicores)
    // - Azure ACI: 1, 2, 4 (CPU cores)
    CPU *int

    // Memory in MB (will be converted to provider-specific units)
    Memory *int
}
```

<a name="RuntimeConfig"></a>
## type [RuntimeConfig](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/image_config.go#L43-L47>)

RuntimeConfig specifies platform and architecture requirements. Abstracts provider\-specific runtime platform specifications.

```go
type RuntimeConfig struct {
    // Platform specifies the OS and architecture (e.g., "linux/amd64", "linux/arm64")
    // All providers support these standard platform strings
    Platform *string
}
```

<a name="Service"></a>
## type [Service](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/main.go#L15-L26>)

Service provides the core business logic for command execution and user management.

```go
type Service struct {
    Logger   *slog.Logger
    Provider constants.BackendProvider
    // contains filtered or unexported fields
}
```

<a name="Initialize"></a>
### func [Initialize](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/init.go#L26-L29>)

```go
func Initialize(ctx context.Context, cfg *config.Config, baseLogger *slog.Logger) (*Service, error)
```

Initialize creates a new Service configured for the specified backend provider. It returns an error if the context is canceled, timed out, or if an unknown provider is specified. Callers should handle errors and potentially panic if initialization fails during startup. Also initializes the Casbin enforcer for authorization.

Supported cloud providers:

- "aws": Uses DynamoDB for storage, Fargate for execution
- "gcp": \(future\) E.g. using Google Cloud Run and Firestore for storage

<a name="NewService"></a>
### func [NewService](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/main.go#L37-L48>)

```go
func NewService(ctx context.Context, repos *database.Repositories, taskManager contract.TaskManager, imageRegistry contract.ImageRegistry, logManager contract.LogManager, observabilityManager contract.ObservabilityManager, log *slog.Logger, provider constants.BackendProvider, wsManager contract.WebSocketManager, healthManager contract.HealthManager, enforcer *authorization.Enforcer) (*Service, error)
```

NewService creates a new service instance and initializes the enforcer with user roles from the database. Returns an error if the enforcer is configured but user roles cannot be loaded \(critical initialization failure\). Core repositories \(repos.User, repos.Execution\) and enforcer are required for initialization and must be non\-nil. If wsManager is nil, WebSocket URL generation will be skipped. If repos.Secrets is nil, secrets operations will not be available. If repos.Image is nil, image\-by\-request\-ID queries will not be available. If healthManager is nil, health reconciliation will not be available.

<a name="Service.AuthenticateUser"></a>
### func \(\*Service\) [AuthenticateUser](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/users.go#L200>)

```go
func (s *Service) AuthenticateUser(ctx context.Context, apiKey string) (*api.User, error)
```

AuthenticateUser verifies an API key and returns the associated user. Returns appropriate errors for invalid API keys, revoked keys, or server errors.

<a name="Service.ClaimAPIKey"></a>
### func \(\*Service\) [ClaimAPIKey](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/users.go#L153-L157>)

```go
func (s *Service) ClaimAPIKey(ctx context.Context, secretToken string, ipAddress string) (*api.ClaimAPIKeyResponse, error)
```

ClaimAPIKey retrieves and claims a pending API key by its secret token.

<a name="Service.CreateSecret"></a>
### func \(\*Service\) [CreateSecret](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/secrets.go#L18-L22>)

```go
func (s *Service) CreateSecret(ctx context.Context, req *api.CreateSecretRequest, userEmail string) error
```

CreateSecret creates a new secret with the given name, description, key name, and value.

<a name="Service.CreateUser"></a>
### func \(\*Service\) [CreateUser](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/users.go#L90-L92>)

```go
func (s *Service) CreateUser(ctx context.Context, req api.CreateUserRequest, createdByEmail string) (*api.CreateUserResponse, error)
```

CreateUser creates a new user with an API key and returns a claim token. If no API key is provided in the request, one will be generated. Requires a valid role to be specified in the request.

<a name="Service.DeleteSecret"></a>
### func \(\*Service\) [DeleteSecret](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/secrets.go#L103>)

```go
func (s *Service) DeleteSecret(ctx context.Context, name string) error
```

DeleteSecret deletes a secret and its value.

<a name="Service.FetchBackendLogs"></a>
### func \(\*Service\) [FetchBackendLogs](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/executions.go#L229>)

```go
func (s *Service) FetchBackendLogs(ctx context.Context, requestID string) ([]api.LogEvent, error)
```

FetchBackendLogs retrieves backend infrastructure logs for the provided requestID. Returns logs from backend services for debugging and tracing.

<a name="Service.FetchTrace"></a>
### func \(\*Service\) [FetchTrace](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/executions.go#L238>)

```go
func (s *Service) FetchTrace(ctx context.Context, requestID string) (*api.TraceResponse, error)
```

FetchTrace retrieves backend logs and related resources for a request ID.

<a name="Service.GetEnforcer"></a>
### func \(\*Service\) [GetEnforcer](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/main.go#L79>)

```go
func (s *Service) GetEnforcer() *authorization.Enforcer
```

GetEnforcer returns the Casbin enforcer for authorization checks.

<a name="Service.GetExecutionStatus"></a>
### func \(\*Service\) [GetExecutionStatus](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/executions.go#L413>)

```go
func (s *Service) GetExecutionStatus(ctx context.Context, executionID string) (*api.ExecutionStatusResponse, error)
```

GetExecutionStatus returns the current status and metadata for a given execution ID.

<a name="Service.GetImage"></a>
### func \(\*Service\) [GetImage](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/images.go#L97>)

```go
func (s *Service) GetImage(ctx context.Context, image string) (*api.ImageInfo, error)
```

GetImage returns a single registered Docker image by ID or name.

<a name="Service.GetLogsByExecutionID"></a>
### func \(\*Service\) [GetLogsByExecutionID](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/executions.go#L186-L191>)

```go
func (s *Service) GetLogsByExecutionID(ctx context.Context, executionID string, userEmail *string, clientIPAtCreationTime *string) (*api.LogsResponse, error)
```

GetLogsByExecutionID returns aggregated Cloud logs for a given execution. WebSocket endpoint is stored without protocol \(normalized in config\). Always use wss:// for production WebSocket connections. userEmail: authenticated user email for audit trail. clientIPAtCreationTime: client IP captured when the token was created \(for tracing\). If task is not running, don't return a WebSocket URL.

<a name="Service.GetSecret"></a>
### func \(\*Service\) [GetSecret](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/secrets.go#L65>)

```go
func (s *Service) GetSecret(ctx context.Context, name string) (*api.Secret, error)
```

GetSecret retrieves a secret's metadata and value by name.

<a name="Service.ImageRegistry"></a>
### func \(\*Service\) [ImageRegistry](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/main.go#L89>)

```go
func (s *Service) ImageRegistry() contract.ImageRegistry
```

ImageRegistry returns the image management interface.

<a name="Service.KillExecution"></a>
### func \(\*Service\) [KillExecution](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/executions.go#L452>)

```go
func (s *Service) KillExecution(ctx context.Context, executionID string) (*api.KillExecutionResponse, error)
```

KillExecution terminates a running execution identified by executionID. It verifies the execution exists in the database and checks task status before termination. Updates the execution status to TERMINATING after successful task stop.

This operation is idempotent: if the execution is already in a terminal state \(SUCCEEDED, FAILED, STOPPED, TERMINATING\), it returns nil, nil \(which results in HTTP 204 No Content\), indicating that no action was taken. If termination is initiated, returns a KillExecutionResponse with the execution ID and a success message.

Returns an error if the execution is not found or termination fails.

<a name="Service.ListExecutions"></a>
### func \(\*Service\) [ListExecutions](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/executions.go#L520>)

```go
func (s *Service) ListExecutions(ctx context.Context, limit int, statuses []string) ([]*api.Execution, error)
```

ListExecutions returns executions from the database with optional filtering. Parameters:

- limit: maximum number of executions to return
- statuses: optional list of execution statuses to filter by

If statuses is provided, only executions matching one of the specified statuses are returned. Results are returned sorted by started\_at in descending order \(newest first\). Fields with no values are omitted in JSON due to omitempty tags on api.Execution.

<a name="Service.ListImages"></a>
### func \(\*Service\) [ListImages](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/images.go#L81>)

```go
func (s *Service) ListImages(ctx context.Context) (*api.ListImagesResponse, error)
```

ListImages returns all registered Docker images.

<a name="Service.ListSecrets"></a>
### func \(\*Service\) [ListSecrets](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/secrets.go#L70>)

```go
func (s *Service) ListSecrets(ctx context.Context) ([]*api.Secret, error)
```

ListSecrets retrieves all secrets with values.

<a name="Service.ListUsers"></a>
### func \(\*Service\) [ListUsers](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/users.go#L275>)

```go
func (s *Service) ListUsers(ctx context.Context) (*api.ListUsersResponse, error)
```

ListUsers returns all users in the system sorted by email \(excluding API key hashes for security\). Returns an error if the query fails. Sorting is delegated to the repository implementation \(e.g., DynamoDB GSI\).

<a name="Service.LogManager"></a>
### func \(\*Service\) [LogManager](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/main.go#L94>)

```go
func (s *Service) LogManager() contract.LogManager
```

LogManager returns the log management interface.

<a name="Service.ObservabilityManager"></a>
### func \(\*Service\) [ObservabilityManager](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/main.go#L99>)

```go
func (s *Service) ObservabilityManager() contract.ObservabilityManager
```

ObservabilityManager returns the observability interface.

<a name="Service.ReconcileResources"></a>
### func \(\*Service\) [ReconcileResources](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/health.go#L13>)

```go
func (s *Service) ReconcileResources(ctx context.Context) (*api.HealthReport, error)
```

ReconcileResources performs health reconciliation for all resources. This method allows synchronous execution via API.

<a name="Service.RegisterImage"></a>
### func \(\*Service\) [RegisterImage](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/images.go#L18-L22>)

```go
func (s *Service) RegisterImage(ctx context.Context, req *api.RegisterImageRequest, createdBy string) (*api.RegisterImageResponse, error)
```

RegisterImage registers a Docker image and creates the corresponding task definition. After successful registration, ownership is synced to the Casbin enforcer to maintain consistency with the database. If ownership sync fails, an error is logged but registration succeeds; ownership will be synced during the next hydration cycle or health reconcile.

<a name="Service.RemoveImage"></a>
### func \(\*Service\) [RemoveImage](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/images.go#L119>)

```go
func (s *Service) RemoveImage(ctx context.Context, image string) error
```

RemoveImage removes a Docker image and deregisters its task definitions.

<a name="Service.ResolveImage"></a>
### func \(\*Service\) [ResolveImage](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/images.go#L138>)

```go
func (s *Service) ResolveImage(ctx context.Context, image string) (*api.ImageInfo, error)
```

ResolveImage resolves a user\-provided image string to a specific ImageInfo. If image string is empty, returns the default image. This centralizes image resolution logic for authorization and execution.

<a name="Service.RevokeUser"></a>
### func \(\*Service\) [RevokeUser](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/users.go#L234>)

```go
func (s *Service) RevokeUser(ctx context.Context, email string) error
```

RevokeUser marks a user's API key as revoked. Returns an error if the user does not exist or revocation fails.

<a name="Service.RunCommand"></a>
### func \(\*Service\) [RunCommand](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/executions.go#L86-L91>)

```go
func (s *Service) RunCommand(ctx context.Context, userEmail string, req *api.ExecutionRequest, resolvedImage *api.ImageInfo) (*api.ExecutionResponse, error)
```

RunCommand starts a provider\-specific task and records the execution. The resolvedImage parameter contains the validated image that will be used for execution. The request's Image field is replaced with the imageID before passing to the runner. Secret references are resolved to environment variables before starting the task. Execution status is set to STARTING after the task has been accepted by the provider.

<a name="Service.TaskManager"></a>
### func \(\*Service\) [TaskManager](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/main.go#L84>)

```go
func (s *Service) TaskManager() contract.TaskManager
```

TaskManager returns the task execution interface.

<a name="Service.UpdateSecret"></a>
### func \(\*Service\) [UpdateSecret](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/secrets.go#L75-L80>)

```go
func (s *Service) UpdateSecret(ctx context.Context, name string, req *api.UpdateSecretRequest, userEmail string) error
```

UpdateSecret updates a secret \(metadata and/or value\).

<a name="Service.UpdateUserLastUsed"></a>
### func \(\*Service\) [UpdateUserLastUsed](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/users.go#L225>)

```go
func (s *Service) UpdateUserLastUsed(ctx context.Context, email string) (*time.Time, error)
```

UpdateUserLastUsed updates the user's last\_used timestamp after successful authentication. This is a best\-effort operation; callers may choose to log failures without failing the request.

<a name="Service.ValidateExecutionResourceAccess"></a>
### func \(\*Service\) [ValidateExecutionResourceAccess](<https://github.com/runvoy/runvoy/blob/main/internal/backend/orchestrator/executions.go#L24-L29>)

```go
func (s *Service) ValidateExecutionResourceAccess(ctx context.Context, userEmail string, req *api.ExecutionRequest, resolvedImage *api.ImageInfo) error
```

ValidateExecutionResourceAccess checks if a user can access all resources required for execution. The resolvedImage parameter contains the image that was resolved from the request and will be validated. All secrets referenced in the execution request are also validated for access. Returns an error if the user lacks access to any required resource.

# processor

```go
import "runvoy/internal/backend/processor"
```

Package processor provides event processing interfaces and utilities.

Package processor provides event processing functionality for cloud provider events. It handles asynchronous events from AWS services like EventBridge, CloudWatch Logs, and WebSocket lifecycle events.

## Index

- [type Processor](<#Processor>)
  - [func Initialize\(ctx context.Context, cfg \*config.Config, logger \*slog.Logger\) \(Processor, error\)](<#Initialize>)


<a name="Processor"></a>
## type [Processor](<https://github.com/runvoy/runvoy/blob/main/internal/backend/processor/backend.go#L11-L19>)

Processor defines the interface for event processing across different cloud providers. Each provider implements this interface to handle events specific to their platform.

```go
type Processor interface {
    // Handle processes a raw cloud event and returns a result (or nil for non-WebSocket events).
    // For WebSocket events, the result is a provider-specific response marshaled as JSON.
    Handle(ctx context.Context, rawEvent *json.RawMessage) (*json.RawMessage, error)

    // HandleEventJSON is a helper for testing that accepts raw JSON and returns an error.
    // It's used for test cases that expect error returns.
    HandleEventJSON(ctx context.Context, eventJSON *json.RawMessage) error
}
```

<a name="Initialize"></a>
### func [Initialize](<https://github.com/runvoy/runvoy/blob/main/internal/backend/processor/init.go#L24-L28>)

```go
func Initialize(ctx context.Context, cfg *config.Config, logger *slog.Logger) (Processor, error)
```

Initialize creates a new Processor configured for the backend provider specified in cfg. It returns an error if the context is canceled, timed out, or if an unknown provider is specified. Callers should handle errors and potentially panic if initialization fails during startup. Also initializes the Casbin enforcer for authorization.

Supported cloud providers:

- "aws": Uses CloudWatch events for ECS task state changes and API Gateway for WebSocket events
- "gcp": \(future\) Google Cloud Pub/Sub and Cloud Tasks for event processing

# websocket

```go
import "runvoy/internal/backend/websocket"
```

Package websocket provides WebSocket management for runvoy. It handles connection lifecycle events and manages WebSocket connections.

## Index

- [type Manager](<#Manager>)


<a name="Manager"></a>
## type [Manager](<https://github.com/runvoy/runvoy/blob/main/internal/backend/websocket/manager.go#L15-L36>)

Manager exposes the subset of WebSocket manager functionality used by the event processor. Different cloud providers can implement this interface to support their specific WebSocket infrastructure.

```go
type Manager interface {
    // HandleRequest processes WebSocket lifecycle events (connect, disconnect, etc.).
    // Returns true if the event was handled, false otherwise.
    HandleRequest(ctx context.Context, rawEvent *json.RawMessage, reqLogger *slog.Logger) (bool, error)

    // NotifyExecutionCompletion sends disconnect notifications to all connected clients for an execution
    // and removes the connections.
    NotifyExecutionCompletion(ctx context.Context, executionID *string) error

    // SendLogsToExecution sends log events to all connected clients for an execution.
    SendLogsToExecution(ctx context.Context, executionID *string, logEvents []api.LogEvent) error

    // GenerateWebSocketURL creates a WebSocket token and returns the connection URL.
    // It stores the token for validation when the client connects.
    // Returns an empty string if URL generation fails (errors are logged).
    GenerateWebSocketURL(
        ctx context.Context,
        executionID string,
        userEmail *string,
        clientIPAtCreationTime *string,
    ) string
}
```

# infra

```go
import "runvoy/internal/client/infra"
```

Package infra provides infrastructure deployment functionality.

Package infra provides infrastructure deployment functionality.

## Index

- [func BuildLogsURL\(webURL, executionID string\) string](<#BuildLogsURL>)
- [func ParseParameters\(params \[\]string\) \(map\[string\]string, error\)](<#ParseParameters>)
- [func SeedAdminUser\(ctx context.Context, adminEmail, region, tableName string\) \(string, error\)](<#SeedAdminUser>)
- [type AWSDeployer](<#AWSDeployer>)
  - [func NewAWSDeployer\(ctx context.Context, region string\) \(\*AWSDeployer, error\)](<#NewAWSDeployer>)
  - [func NewAWSDeployerWithClient\(client CloudFormationClient, region string\) \*AWSDeployer](<#NewAWSDeployerWithClient>)
  - [func \(d \*AWSDeployer\) CheckStackExists\(ctx context.Context, stackName string\) \(bool, error\)](<#AWSDeployer.CheckStackExists>)
  - [func \(d \*AWSDeployer\) Deploy\(ctx context.Context, opts \*DeployOptions\) \(\*DeployResult, error\)](<#AWSDeployer.Deploy>)
  - [func \(d \*AWSDeployer\) Destroy\(ctx context.Context, opts \*DestroyOptions\) \(\*DestroyResult, error\)](<#AWSDeployer.Destroy>)
  - [func \(d \*AWSDeployer\) GetRegion\(\) string](<#AWSDeployer.GetRegion>)
  - [func \(d \*AWSDeployer\) GetStackOutputs\(ctx context.Context, stackName string\) \(map\[string\]string, error\)](<#AWSDeployer.GetStackOutputs>)
- [type CloudFormationClient](<#CloudFormationClient>)
- [type DeployOptions](<#DeployOptions>)
- [type DeployResult](<#DeployResult>)
- [type Deployer](<#Deployer>)
  - [func NewDeployer\(ctx context.Context, provider, region string\) \(Deployer, error\)](<#NewDeployer>)
- [type DestroyOptions](<#DestroyOptions>)
- [type DestroyResult](<#DestroyResult>)
- [type TemplateSource](<#TemplateSource>)
  - [func ResolveTemplate\(provider, template, version, region string\) \(\*TemplateSource, error\)](<#ResolveTemplate>)


<a name="BuildLogsURL"></a>
## func [BuildLogsURL](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/urls.go#L14>)

```go
func BuildLogsURL(webURL, executionID string) string
```

BuildLogsURL constructs a properly formatted URL for viewing logs in the web viewer. It takes a base web URL and an execution ID, and returns a URL string with the /logs path and execution\_id query parameter properly encoded.

If URL parsing or path joining fails, it falls back to simple string concatenation to ensure a URL is always returned \(though it may not be perfectly formatted\).

<a name="ParseParameters"></a>
## func [ParseParameters](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy.go#L138>)

```go
func ParseParameters(params []string) (map[string]string, error)
```

ParseParameters parses KEY=VALUE parameter strings

<a name="SeedAdminUser"></a>
## func [SeedAdminUser](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/users.go#L21>)

```go
func SeedAdminUser(ctx context.Context, adminEmail, region, tableName string) (string, error)
```

SeedAdminUser seeds an admin user into the database and returns the generated API key. This function hides the DynamoDB implementation details from callers.

<a name="AWSDeployer"></a>
## type [AWSDeployer](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy_aws.go#L57-L60>)

AWSDeployer implements Deployer for AWS CloudFormation

```go
type AWSDeployer struct {
    // contains filtered or unexported fields
}
```

<a name="NewAWSDeployer"></a>
### func [NewAWSDeployer](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy_aws.go#L64>)

```go
func NewAWSDeployer(ctx context.Context, region string) (*AWSDeployer, error)
```

NewAWSDeployer creates a new AWS deployer with the given region. If region is empty, uses the AWS SDK default.

<a name="NewAWSDeployerWithClient"></a>
### func [NewAWSDeployerWithClient](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy_aws.go#L84>)

```go
func NewAWSDeployerWithClient(client CloudFormationClient, region string) *AWSDeployer
```

NewAWSDeployerWithClient creates a new AWS deployer with a custom client \(for testing\)

<a name="AWSDeployer.CheckStackExists"></a>
### func \(\*AWSDeployer\) [CheckStackExists](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy_aws.go#L212>)

```go
func (d *AWSDeployer) CheckStackExists(ctx context.Context, stackName string) (bool, error)
```

CheckStackExists checks if a CloudFormation stack exists

<a name="AWSDeployer.Deploy"></a>
### func \(\*AWSDeployer\) [Deploy](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy_aws.go#L124>)

```go
func (d *AWSDeployer) Deploy(ctx context.Context, opts *DeployOptions) (*DeployResult, error)
```

Deploy deploys or updates the CloudFormation stack

<a name="AWSDeployer.Destroy"></a>
### func \(\*AWSDeployer\) [Destroy](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy_aws.go#L407>)

```go
func (d *AWSDeployer) Destroy(ctx context.Context, opts *DestroyOptions) (*DestroyResult, error)
```

Destroy destroys the CloudFormation stack

<a name="AWSDeployer.GetRegion"></a>
### func \(\*AWSDeployer\) [GetRegion](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy_aws.go#L92>)

```go
func (d *AWSDeployer) GetRegion() string
```

GetRegion returns the AWS region being used

<a name="AWSDeployer.GetStackOutputs"></a>
### func \(\*AWSDeployer\) [GetStackOutputs](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy_aws.go#L384>)

```go
func (d *AWSDeployer) GetStackOutputs(ctx context.Context, stackName string) (map[string]string, error)
```

GetStackOutputs retrieves the outputs from a CloudFormation stack

<a name="CloudFormationClient"></a>
## type [CloudFormationClient](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy_aws.go#L28-L54>)

CloudFormationClient defines the interface for CloudFormation operations. This interface enables mocking for unit tests.

```go
type CloudFormationClient interface {
    DescribeStacks(
        ctx context.Context,
        params *cloudformation.DescribeStacksInput,
        optFns ...func(*cloudformation.Options),
    ) (*cloudformation.DescribeStacksOutput, error)
    DescribeStackEvents(
        ctx context.Context,
        params *cloudformation.DescribeStackEventsInput,
        optFns ...func(*cloudformation.Options),
    ) (*cloudformation.DescribeStackEventsOutput, error)
    CreateStack(
        ctx context.Context,
        params *cloudformation.CreateStackInput,
        optFns ...func(*cloudformation.Options),
    ) (*cloudformation.CreateStackOutput, error)
    UpdateStack(
        ctx context.Context,
        params *cloudformation.UpdateStackInput,
        optFns ...func(*cloudformation.Options),
    ) (*cloudformation.UpdateStackOutput, error)
    DeleteStack(
        ctx context.Context,
        params *cloudformation.DeleteStackInput,
        optFns ...func(*cloudformation.Options),
    ) (*cloudformation.DeleteStackOutput, error)
}
```

<a name="DeployOptions"></a>
## type [DeployOptions](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy.go#L21-L28>)

DeployOptions contains all options for deploying infrastructure

```go
type DeployOptions struct {
    StackName  string
    Template   string   // URL, S3 URI, or local file path
    Version    string   // Release version
    Parameters []string // KEY=VALUE format
    Wait       bool     // Wait for completion
    Region     string   // Provider region (optional)
}
```

<a name="DeployResult"></a>
## type [DeployResult](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy.go#L31-L37>)

DeployResult contains the result of a deployment operation

```go
type DeployResult struct {
    StackName     string
    OperationType string // "CREATE" or "UPDATE"
    Status        string
    Outputs       map[string]string
    NoChanges     bool // True if stack was already up to date
}
```

<a name="Deployer"></a>
## type [Deployer](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy.go#L61-L72>)

Deployer defines the interface for infrastructure deployment. Different cloud providers implement this interface.

```go
type Deployer interface {
    // Deploy deploys or updates infrastructure
    Deploy(ctx context.Context, opts *DeployOptions) (*DeployResult, error)
    // Destroy destroys infrastructure
    Destroy(ctx context.Context, opts *DestroyOptions) (*DestroyResult, error)
    // CheckStackExists checks if the infrastructure stack exists
    CheckStackExists(ctx context.Context, stackName string) (bool, error)
    // GetStackOutputs retrieves outputs from a deployed stack
    GetStackOutputs(ctx context.Context, stackName string) (map[string]string, error)
    // GetRegion returns the region being used
    GetRegion() string
}
```

<a name="NewDeployer"></a>
### func [NewDeployer](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy.go#L76>)

```go
func NewDeployer(ctx context.Context, provider, region string) (Deployer, error)
```

NewDeployer creates a Deployer for the specified provider. Currently supports: "aws"

<a name="DestroyOptions"></a>
## type [DestroyOptions](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy.go#L40-L44>)

DestroyOptions contains all options for destroying infrastructure

```go
type DestroyOptions struct {
    StackName string
    Wait      bool   // Wait for completion
    Region    string // Provider region (optional)
}
```

<a name="DestroyResult"></a>
## type [DestroyResult](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy.go#L47-L51>)

DestroyResult contains the result of a destroy operation

```go
type DestroyResult struct {
    StackName string
    Status    string
    NotFound  bool // True if stack was already deleted
}
```

<a name="TemplateSource"></a>
## type [TemplateSource](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy.go#L54-L57>)

TemplateSource represents the resolved template source

```go
type TemplateSource struct {
    URL  string // For remote templates (S3/HTTPS)
    Body string // For local file templates
}
```

<a name="ResolveTemplate"></a>
### func [ResolveTemplate](<https://github.com/runvoy/runvoy/blob/main/internal/client/infra/deploy.go#L90>)

```go
func ResolveTemplate(provider, template, version, region string) (*TemplateSource, error)
```

ResolveTemplate determines the template source from the given input. Returns a TemplateSource with either URL or Body populated. region is the provider region to use for building default template URLs.

# output

```go
import "runvoy/internal/client/output"
```

Package output provides formatted terminal output utilities. It includes colors, spinners, progress bars, and other CLI display helpers.

## Index

- [Variables](<#variables>)
- [func Blank\(\)](<#Blank>)
- [func Bold\(text string\) string](<#Bold>)
- [func Box\(text string\)](<#Box>)
- [func Bytes\(b int64\) string](<#Bytes>)
- [func Confirm\(prompt string\) bool](<#Confirm>)
- [func Cyan\(text string\) string](<#Cyan>)
- [func Duration\(d time.Duration\) string](<#Duration>)
- [func Errorf\(format string, a ...any\)](<#Errorf>)
- [func Fatalf\(format string, a ...any\)](<#Fatalf>)
- [func Gray\(text string\) string](<#Gray>)
- [func Green\(text string\) string](<#Green>)
- [func Header\(text string\)](<#Header>)
- [func Infof\(format string, a ...any\)](<#Infof>)
- [func KeyValue\(key, value string\)](<#KeyValue>)
- [func KeyValueBold\(key, value string\)](<#KeyValueBold>)
- [func List\(items \[\]string\)](<#List>)
- [func NumberedList\(items \[\]string\)](<#NumberedList>)
- [func Printf\(format string, a ...any\)](<#Printf>)
- [func Println\(a ...any\)](<#Println>)
- [func Prompt\(prompt string\) string](<#Prompt>)
- [func PromptRequired\(prompt string\) string](<#PromptRequired>)
- [func PromptSecret\(prompt string\) string](<#PromptSecret>)
- [func Red\(text string\) string](<#Red>)
- [func StatusBadge\(status string\) string](<#StatusBadge>)
- [func Step\(step, total int, message string\)](<#Step>)
- [func StepError\(step, total int, message string\)](<#StepError>)
- [func StepSuccess\(step, total int, message string\)](<#StepSuccess>)
- [func Subheader\(text string\)](<#Subheader>)
- [func Successf\(format string, a ...any\)](<#Successf>)
- [func Table\(headers \[\]string, rows \[\]\[\]string\)](<#Table>)
- [func Warningf\(format string, a ...any\)](<#Warningf>)
- [func Yellow\(text string\) string](<#Yellow>)
- [type ProgressBar](<#ProgressBar>)
  - [func NewProgressBar\(total int, message string\) \*ProgressBar](<#NewProgressBar>)
  - [func \(p \*ProgressBar\) Complete\(\)](<#ProgressBar.Complete>)
  - [func \(p \*ProgressBar\) Increment\(\)](<#ProgressBar.Increment>)
  - [func \(p \*ProgressBar\) Update\(current int\)](<#ProgressBar.Update>)
- [type Spinner](<#Spinner>)
  - [func NewSpinner\(message string\) \*Spinner](<#NewSpinner>)
  - [func \(s \*Spinner\) Error\(message string\)](<#Spinner.Error>)
  - [func \(s \*Spinner\) Start\(\)](<#Spinner.Start>)
  - [func \(s \*Spinner\) Stop\(\)](<#Spinner.Stop>)
  - [func \(s \*Spinner\) Success\(message string\)](<#Spinner.Success>)


## Variables

<a name="Stdout"></a>

```go
var (

    // Stdout is the output writer for normal output (can be overridden for testing).
    Stdout io.Writer = os.Stdout
    // Stderr is the output writer for error output (can be overridden for testing).
    Stderr io.Writer = os.Stderr
)
```

<a name="Blank"></a>
## func [Blank](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L135>)

```go
func Blank()
```

Blank prints a blank line

<a name="Bold"></a>
## func [Bold](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L150>)

```go
func Bold(text string) string
```

Bold prints text in bold

<a name="Box"></a>
## func [Box](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L184>)

```go
func Box(text string)
```

Box prints text in a rounded box \(to stderr\) Example:   Configuration saved\!  

<a name="Bytes"></a>
## func [Bytes](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L490>)

```go
func Bytes(b int64) string
```

Bytes formats bytes in a human\-readable way

<a name="Confirm"></a>
## func [Confirm](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L415>)

```go
func Confirm(prompt string) bool
```

Confirm prompts the user for yes/no confirmation Returns true if user confirms \(y/Y\), false otherwise

<a name="Cyan"></a>
## func [Cyan](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L155>)

```go
func Cyan(text string) string
```

Cyan prints text in cyan

<a name="Duration"></a>
## func [Duration](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L475>)

```go
func Duration(d time.Duration) string
```

Duration formats a duration in a human\-readable way

<a name="Errorf"></a>
## func [Errorf](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L71>)

```go
func Errorf(format string, a ...any)
```

Errorf prints an error message with an X symbol \(to stderr\) Example:  Failed to create stack: permission denied

<a name="Fatalf"></a>
## func [Fatalf](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L76>)

```go
func Fatalf(format string, a ...any)
```

Fatalf prints an error message and exits with code 1

<a name="Gray"></a>
## func [Gray](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L160>)

```go
func Gray(text string) string
```

Gray prints text in gray

<a name="Green"></a>
## func [Green](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L165>)

```go
func Green(text string) string
```

Green prints text in green

<a name="Header"></a>
## func [Header](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L106>)

```go
func Header(text string)
```

Header prints a section header with a separator line \(to stderr\) Example:  Initializing runvoy infrastructure 

<a name="Infof"></a>
## func [Infof](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L59>)

```go
func Infof(format string, a ...any)
```

Infof prints an informational message with an arrow \(to stderr\) Example:  Creating CloudFormation stack...

<a name="KeyValue"></a>
## func [KeyValue](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L124>)

```go
func KeyValue(key, value string)
```

KeyValue prints a key\-value pair with indentation Example: Stack name: runvoy

<a name="KeyValueBold"></a>
## func [KeyValueBold](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L130>)

```go
func KeyValueBold(key, value string)
```

KeyValueBold prints a key\-value pair with bold value Example: API Key: sk\_live\_abc123...

<a name="List"></a>
## func [List](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L273>)

```go
func List(items []string)
```

List prints a bulleted list Example:

- Item one
- Item two
- Item three

<a name="NumberedList"></a>
## func [NumberedList](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L284>)

```go
func NumberedList(items []string)
```

NumberedList prints a numbered list Example:

1. First step
2. Second step
3. Third step

<a name="Printf"></a>
## func [Printf](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L145>)

```go
func Printf(format string, a ...any)
```

Printf prints a formatted plain line

<a name="Println"></a>
## func [Println](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L140>)

```go
func Println(a ...any)
```

Println prints a plain line without any formatting

<a name="Prompt"></a>
## func [Prompt](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L426>)

```go
func Prompt(prompt string) string
```

Prompt prompts the user for input

<a name="PromptRequired"></a>
## func [PromptRequired](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L436>)

```go
func PromptRequired(prompt string) string
```

PromptRequired prompts the user for input and requires a non\-empty response

<a name="PromptSecret"></a>
## func [PromptSecret](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L449>)

```go
func PromptSecret(prompt string) string
```

PromptSecret prompts for sensitive input \(like passwords\) Note: This is a simple implementation. For production, consider using golang.org/x/term for proper terminal handling

<a name="Red"></a>
## func [Red](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L170>)

```go
func Red(text string) string
```

Red prints text in red

<a name="StatusBadge"></a>
## func [StatusBadge](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L459>)

```go
func StatusBadge(status string) string
```

StatusBadge prints a colored status badge

<a name="Step"></a>
## func [Step](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L83>)

```go
func Step(step, total int, message string)
```

Step prints a step in a multi\-step process \(to stderr\) Example: [1/3](<https://pkg.go.dev/1/3/>) Waiting for stack creation

<a name="StepError"></a>
## func [StepError](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L97>)

```go
func StepError(step, total int, message string)
```

StepError prints a failed step \(to stderr\) Example: [2/3](<https://pkg.go.dev/2/3/>)  Failed to generate API key

<a name="StepSuccess"></a>
## func [StepSuccess](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L90>)

```go
func StepSuccess(step, total int, message string)
```

StepSuccess prints a successful step completion \(to stderr\) Example: [1/3](<https://pkg.go.dev/1/3/>)  Stack created

<a name="Subheader"></a>
## func [Subheader](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L116>)

```go
func Subheader(text string)
```

Subheader prints a smaller section header \(to stderr\) Example: Configuration Details 

<a name="Successf"></a>
## func [Successf](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L53>)

```go
func Successf(format string, a ...any)
```

Successf prints a success message with a checkmark \(to stderr\) Example:  Stack created successfully

<a name="Table"></a>
## func [Table](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L216>)

```go
func Table(headers []string, rows [][]string)
```

Table prints a simple table with headers Example: Execution ID Status Duration    exec\_abc123 completed 10m 35s exec\_def456 running 2m 15s

<a name="Warningf"></a>
## func [Warningf](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L65>)

```go
func Warningf(format string, a ...any)
```

Warningf prints a warning message with a warning symbol \(to stderr\) Example:  Lock already held by alice@acme.com

<a name="Yellow"></a>
## func [Yellow](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L175>)

```go
func Yellow(text string) string
```

Yellow prints text in yellow

<a name="ProgressBar"></a>
## type [ProgressBar](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L357-L362>)

ProgressBar represents a simple text progress bar

```go
type ProgressBar struct {
    // contains filtered or unexported fields
}
```

<a name="NewProgressBar"></a>
### func [NewProgressBar](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L365>)

```go
func NewProgressBar(total int, message string) *ProgressBar
```

NewProgressBar creates a new progress bar

<a name="ProgressBar.Complete"></a>
### func \(\*ProgressBar\) [Complete](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L409>)

```go
func (p *ProgressBar) Complete()
```

Complete marks the progress bar as complete

<a name="ProgressBar.Increment"></a>
### func \(\*ProgressBar\) [Increment](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L404>)

```go
func (p *ProgressBar) Increment()
```

Increment increments the progress bar by 1

<a name="ProgressBar.Update"></a>
### func \(\*ProgressBar\) [Update](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L375>)

```go
func (p *ProgressBar) Update(current int)
```

Update updates the progress bar to the given value \(to stderr\)

<a name="Spinner"></a>
## type [Spinner](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L291-L297>)

Spinner represents a simple text spinner for long operations

```go
type Spinner struct {
    // contains filtered or unexported fields
}
```

<a name="NewSpinner"></a>
### func [NewSpinner](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L300>)

```go
func NewSpinner(message string) *Spinner
```

NewSpinner creates a new spinner with the given message

<a name="Spinner.Error"></a>
### func \(\*Spinner\) [Error](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L351>)

```go
func (s *Spinner) Error(message string)
```

Error stops the spinner and prints an error message

<a name="Spinner.Start"></a>
### func \(\*Spinner\) [Start](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L309>)

```go
func (s *Spinner) Start()
```

Start starts the spinner animation \(to stderr\)

<a name="Spinner.Stop"></a>
### func \(\*Spinner\) [Stop](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L335>)

```go
func (s *Spinner) Stop()
```

Stop stops the spinner and clears the line

<a name="Spinner.Success"></a>
### func \(\*Spinner\) [Success](<https://github.com/runvoy/runvoy/blob/main/internal/client/output/output.go#L345>)

```go
func (s *Spinner) Success(message string)
```

Success stops the spinner and prints a success message

# playbooks

```go
import "runvoy/internal/client/playbooks"
```

Package playbooks provides functionality for loading and managing playbooks.

Package playbooks provides functionality for loading and managing playbooks.

## Index

- [type PlaybookExecutor](<#PlaybookExecutor>)
  - [func NewPlaybookExecutor\(\) \*PlaybookExecutor](<#NewPlaybookExecutor>)
  - [func \(e \*PlaybookExecutor\) ToExecutionRequest\(playbook \*api.Playbook, userEnv map\[string\]string, userSecrets \[\]string\) \*api.ExecutionRequest](<#PlaybookExecutor.ToExecutionRequest>)
- [type PlaybookLoader](<#PlaybookLoader>)
  - [func NewPlaybookLoader\(\) \*PlaybookLoader](<#NewPlaybookLoader>)
  - [func \(l \*PlaybookLoader\) GetPlaybookDir\(\) \(string, error\)](<#PlaybookLoader.GetPlaybookDir>)
  - [func \(l \*PlaybookLoader\) ListPlaybooks\(\) \(\[\]string, error\)](<#PlaybookLoader.ListPlaybooks>)
  - [func \(l \*PlaybookLoader\) LoadPlaybook\(name string\) \(\*api.Playbook, error\)](<#PlaybookLoader.LoadPlaybook>)


<a name="PlaybookExecutor"></a>
## type [PlaybookExecutor](<https://github.com/runvoy/runvoy/blob/main/internal/client/playbooks/executor.go#L11>)

PlaybookExecutor converts Playbook to ExecutionRequest

```go
type PlaybookExecutor struct{}
```

<a name="NewPlaybookExecutor"></a>
### func [NewPlaybookExecutor](<https://github.com/runvoy/runvoy/blob/main/internal/client/playbooks/executor.go#L14>)

```go
func NewPlaybookExecutor() *PlaybookExecutor
```

NewPlaybookExecutor creates a new PlaybookExecutor

<a name="PlaybookExecutor.ToExecutionRequest"></a>
### func \(\*PlaybookExecutor\) [ToExecutionRequest](<https://github.com/runvoy/runvoy/blob/main/internal/client/playbooks/executor.go#L20-L24>)

```go
func (e *PlaybookExecutor) ToExecutionRequest(playbook *api.Playbook, userEnv map[string]string, userSecrets []string) *api.ExecutionRequest
```

ToExecutionRequest converts a Playbook to an ExecutionRequest. Combines multiple commands with && operator and merges env vars and secrets.

<a name="PlaybookLoader"></a>
## type [PlaybookLoader](<https://github.com/runvoy/runvoy/blob/main/internal/client/playbooks/loader.go#L18>)

PlaybookLoader handles loading and discovery of playbooks

```go
type PlaybookLoader struct{}
```

<a name="NewPlaybookLoader"></a>
### func [NewPlaybookLoader](<https://github.com/runvoy/runvoy/blob/main/internal/client/playbooks/loader.go#L21>)

```go
func NewPlaybookLoader() *PlaybookLoader
```

NewPlaybookLoader creates a new PlaybookLoader

<a name="PlaybookLoader.GetPlaybookDir"></a>
### func \(\*PlaybookLoader\) [GetPlaybookDir](<https://github.com/runvoy/runvoy/blob/main/internal/client/playbooks/loader.go#L27>)

```go
func (l *PlaybookLoader) GetPlaybookDir() (string, error)
```

GetPlaybookDir returns the path to the playbook directory. Checks current working directory first, falls back to home directory.

<a name="PlaybookLoader.ListPlaybooks"></a>
### func \(\*PlaybookLoader\) [ListPlaybooks](<https://github.com/runvoy/runvoy/blob/main/internal/client/playbooks/loader.go#L49>)

```go
func (l *PlaybookLoader) ListPlaybooks() ([]string, error)
```

ListPlaybooks scans the playbook directory for YAML files and returns playbook names. Returns empty list if directory doesn't exist.

<a name="PlaybookLoader.LoadPlaybook"></a>
### func \(\*PlaybookLoader\) [LoadPlaybook](<https://github.com/runvoy/runvoy/blob/main/internal/client/playbooks/loader.go#L81>)

```go
func (l *PlaybookLoader) LoadPlaybook(name string) (*api.Playbook, error)
```

LoadPlaybook loads and parses a playbook YAML file.

# aws

```go
import "runvoy/internal/config/aws"
```

Package aws contains AWS\-specific configuration helpers for Runvoy services.

## Index

- [func BindEnvVars\(v \*viper.Viper\)](<#BindEnvVars>)
- [func BuildTemplateURL\(version, region string\) string](<#BuildTemplateURL>)
- [func NormalizeVersion\(version string\) string](<#NormalizeVersion>)
- [func NormalizeWebSocketEndpoint\(endpoint string\) string](<#NormalizeWebSocketEndpoint>)
- [func ValidateEventProcessor\(cfg \*Config\) error](<#ValidateEventProcessor>)
- [func ValidateOrchestrator\(cfg \*Config\) error](<#ValidateOrchestrator>)
- [type Config](<#Config>)
  - [func \(c \*Config\) LoadSDKConfig\(ctx context.Context\) error](<#Config.LoadSDKConfig>)


<a name="BindEnvVars"></a>
## func [BindEnvVars](<https://github.com/runvoy/runvoy/blob/main/internal/config/aws/config.go#L55>)

```go
func BindEnvVars(v *viper.Viper)
```

BindEnvVars binds AWS\-specific environment variables to the provided Viper instance.

<a name="BuildTemplateURL"></a>
## func [BuildTemplateURL](<https://github.com/runvoy/runvoy/blob/main/internal/config/aws/config.go#L178>)

```go
func BuildTemplateURL(version, region string) string
```

BuildTemplateURL builds the S3 HTTPS URL for the CloudFormation template. The version is normalized to remove any 'v' prefix before building the URL. If region is empty, defaults to the ReleasesBucketRegion constant.

<a name="NormalizeVersion"></a>
## func [NormalizeVersion](<https://github.com/runvoy/runvoy/blob/main/internal/config/aws/config.go#L171>)

```go
func NormalizeVersion(version string) string
```

NormalizeVersion strips any 'v' prefix from the version string. S3 paths use versions without the 'v' prefix \(e.g., "0.1.0" not "v0.1.0"\).

<a name="NormalizeWebSocketEndpoint"></a>
## func [NormalizeWebSocketEndpoint](<https://github.com/runvoy/runvoy/blob/main/internal/config/aws/config.go#L150>)

```go
func NormalizeWebSocketEndpoint(endpoint string) string
```

NormalizeWebSocketEndpoint strips protocol prefixes from WebSocket endpoint URLs. Accepts: https://example.com, http://example.com, wss://example.com, ws://example.com, example.com Returns: example.com \(without protocol\)

<a name="ValidateEventProcessor"></a>
## func [ValidateEventProcessor](<https://github.com/runvoy/runvoy/blob/main/internal/config/aws/config.go#L114>)

```go
func ValidateEventProcessor(cfg *Config) error
```

ValidateEventProcessor validates required AWS fields for the event processor service.

<a name="ValidateOrchestrator"></a>
## func [ValidateOrchestrator](<https://github.com/runvoy/runvoy/blob/main/internal/config/aws/config.go#L81>)

```go
func ValidateOrchestrator(cfg *Config) error
```

ValidateOrchestrator validates required AWS fields for the orchestrator service.

<a name="Config"></a>
## type [Config](<https://github.com/runvoy/runvoy/blob/main/internal/config/aws/config.go#L18-L52>)

Config contains AWS\-specific configuration. These settings are only used when the backend provider is AWS.

```go
type Config struct {
    // DynamoDB Tables
    APIKeysTable              string `mapstructure:"api_keys_table"`
    ExecutionsTable           string `mapstructure:"executions_table"`
    ImageTaskDefsTable        string `mapstructure:"image_taskdefs_table"`
    PendingAPIKeysTable       string `mapstructure:"pending_api_keys_table"`
    SecretsMetadataTable      string `mapstructure:"secrets_metadata_table"`
    WebSocketConnectionsTable string `mapstructure:"websocket_connections_table"`
    WebSocketTokensTable      string `mapstructure:"websocket_tokens_table"`

    // ECS Configuration
    DefaultTaskExecRoleARN string `mapstructure:"default_task_exec_role_arn"`
    DefaultTaskRoleARN     string `mapstructure:"default_task_role_arn"`
    ECSCluster             string `mapstructure:"ecs_cluster"`
    SecurityGroup          string `mapstructure:"security_group"`
    Subnet1                string `mapstructure:"subnet_1"`
    Subnet2                string `mapstructure:"subnet_2"`
    TaskDefinition         string `mapstructure:"task_definition"`

    // CloudWatch Logs
    LogGroup string `mapstructure:"log_group"`

    // API Gateway WebSocket
    WebSocketAPIEndpoint string `mapstructure:"websocket_api_endpoint"`

    // Secrets Management
    SecretsPrefix    string `mapstructure:"secrets_prefix"`
    SecretsKMSKeyARN string `mapstructure:"secrets_kms_key_arn"`

    // Infrastructure defaults
    InfraDefaultStackName string `mapstructure:"infra_default_stack_name" yaml:"infra_default_stack_name"`

    // AWS SDK Configuration (credentials, region, etc.)
    SDKConfig *aws.Config `mapstructure:"-"`
}
```

<a name="Config.LoadSDKConfig"></a>
### func \(\*Config\) [LoadSDKConfig](<https://github.com/runvoy/runvoy/blob/main/internal/config/aws/config.go#L160>)

```go
func (c *Config) LoadSDKConfig(ctx context.Context) error
```

LoadSDKConfig loads the AWS SDK configuration from the environment.

# client

```go
import "runvoy/internal/providers/aws/client"
```

Package client provides AWS\-specific client interfaces for AWS services. This package contains the interfaces for the AWS clients used by the Runvoy orchestrator.

## Index

- [type CloudWatchLogsClient](<#CloudWatchLogsClient>)
- [type CloudWatchLogsClientAdapter](<#CloudWatchLogsClientAdapter>)
  - [func NewCloudWatchLogsClientAdapter\(client \*cloudwatchlogs.Client\) \*CloudWatchLogsClientAdapter](<#NewCloudWatchLogsClientAdapter>)
  - [func \(a \*CloudWatchLogsClientAdapter\) DescribeLogGroups\(ctx context.Context, params \*cloudwatchlogs.DescribeLogGroupsInput, optFns ...func\(\*cloudwatchlogs.Options\)\) \(\*cloudwatchlogs.DescribeLogGroupsOutput, error\)](<#CloudWatchLogsClientAdapter.DescribeLogGroups>)
  - [func \(a \*CloudWatchLogsClientAdapter\) DescribeLogStreams\(ctx context.Context, params \*cloudwatchlogs.DescribeLogStreamsInput, optFns ...func\(\*cloudwatchlogs.Options\)\) \(\*cloudwatchlogs.DescribeLogStreamsOutput, error\)](<#CloudWatchLogsClientAdapter.DescribeLogStreams>)
  - [func \(a \*CloudWatchLogsClientAdapter\) GetLogEvents\(ctx context.Context, params \*cloudwatchlogs.GetLogEventsInput, optFns ...func\(\*cloudwatchlogs.Options\)\) \(\*cloudwatchlogs.GetLogEventsOutput, error\)](<#CloudWatchLogsClientAdapter.GetLogEvents>)
  - [func \(a \*CloudWatchLogsClientAdapter\) GetQueryResults\(ctx context.Context, params \*cloudwatchlogs.GetQueryResultsInput, optFns ...func\(\*cloudwatchlogs.Options\)\) \(\*cloudwatchlogs.GetQueryResultsOutput, error\)](<#CloudWatchLogsClientAdapter.GetQueryResults>)
  - [func \(a \*CloudWatchLogsClientAdapter\) StartQuery\(ctx context.Context, params \*cloudwatchlogs.StartQueryInput, optFns ...func\(\*cloudwatchlogs.Options\)\) \(\*cloudwatchlogs.StartQueryOutput, error\)](<#CloudWatchLogsClientAdapter.StartQuery>)
- [type ECSClient](<#ECSClient>)
- [type ECSClientAdapter](<#ECSClientAdapter>)
  - [func NewECSClientAdapter\(client \*ecs.Client\) \*ECSClientAdapter](<#NewECSClientAdapter>)
  - [func \(a \*ECSClientAdapter\) DeleteTaskDefinitions\(ctx context.Context, params \*ecs.DeleteTaskDefinitionsInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.DeleteTaskDefinitionsOutput, error\)](<#ECSClientAdapter.DeleteTaskDefinitions>)
  - [func \(a \*ECSClientAdapter\) DeregisterTaskDefinition\(ctx context.Context, params \*ecs.DeregisterTaskDefinitionInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.DeregisterTaskDefinitionOutput, error\)](<#ECSClientAdapter.DeregisterTaskDefinition>)
  - [func \(a \*ECSClientAdapter\) DescribeTaskDefinition\(ctx context.Context, params \*ecs.DescribeTaskDefinitionInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.DescribeTaskDefinitionOutput, error\)](<#ECSClientAdapter.DescribeTaskDefinition>)
  - [func \(a \*ECSClientAdapter\) DescribeTasks\(ctx context.Context, params \*ecs.DescribeTasksInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.DescribeTasksOutput, error\)](<#ECSClientAdapter.DescribeTasks>)
  - [func \(a \*ECSClientAdapter\) ListTagsForResource\(ctx context.Context, params \*ecs.ListTagsForResourceInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.ListTagsForResourceOutput, error\)](<#ECSClientAdapter.ListTagsForResource>)
  - [func \(a \*ECSClientAdapter\) ListTaskDefinitions\(ctx context.Context, params \*ecs.ListTaskDefinitionsInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.ListTaskDefinitionsOutput, error\)](<#ECSClientAdapter.ListTaskDefinitions>)
  - [func \(a \*ECSClientAdapter\) ListTasks\(ctx context.Context, params \*ecs.ListTasksInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.ListTasksOutput, error\)](<#ECSClientAdapter.ListTasks>)
  - [func \(a \*ECSClientAdapter\) RegisterTaskDefinition\(ctx context.Context, params \*ecs.RegisterTaskDefinitionInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.RegisterTaskDefinitionOutput, error\)](<#ECSClientAdapter.RegisterTaskDefinition>)
  - [func \(a \*ECSClientAdapter\) RunTask\(ctx context.Context, params \*ecs.RunTaskInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.RunTaskOutput, error\)](<#ECSClientAdapter.RunTask>)
  - [func \(a \*ECSClientAdapter\) StopTask\(ctx context.Context, params \*ecs.StopTaskInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.StopTaskOutput, error\)](<#ECSClientAdapter.StopTask>)
  - [func \(a \*ECSClientAdapter\) TagResource\(ctx context.Context, params \*ecs.TagResourceInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.TagResourceOutput, error\)](<#ECSClientAdapter.TagResource>)
  - [func \(a \*ECSClientAdapter\) UntagResource\(ctx context.Context, params \*ecs.UntagResourceInput, optFns ...func\(\*ecs.Options\)\) \(\*ecs.UntagResourceOutput, error\)](<#ECSClientAdapter.UntagResource>)
- [type IAMClient](<#IAMClient>)
- [type IAMClientAdapter](<#IAMClientAdapter>)
  - [func NewIAMClientAdapter\(client \*iam.Client\) \*IAMClientAdapter](<#NewIAMClientAdapter>)
  - [func \(a \*IAMClientAdapter\) GetRole\(ctx context.Context, params \*iam.GetRoleInput, optFns ...func\(\*iam.Options\)\) \(\*iam.GetRoleOutput, error\)](<#IAMClientAdapter.GetRole>)


<a name="CloudWatchLogsClient"></a>
## type [CloudWatchLogsClient](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/cloudwatchlogs.go#L11-L37>)

CloudWatchLogsClient defines the interface for CloudWatch Logs operations used by the runner. This interface makes the code easier to test by allowing mock implementations.

```go
type CloudWatchLogsClient interface {
    DescribeLogGroups(
        ctx context.Context,
        params *cloudwatchlogs.DescribeLogGroupsInput,
        optFns ...func(*cloudwatchlogs.Options),
    ) (*cloudwatchlogs.DescribeLogGroupsOutput, error)
    DescribeLogStreams(
        ctx context.Context,
        params *cloudwatchlogs.DescribeLogStreamsInput,
        optFns ...func(*cloudwatchlogs.Options),
    ) (*cloudwatchlogs.DescribeLogStreamsOutput, error)
    GetLogEvents(
        ctx context.Context,
        params *cloudwatchlogs.GetLogEventsInput,
        optFns ...func(*cloudwatchlogs.Options),
    ) (*cloudwatchlogs.GetLogEventsOutput, error)
    StartQuery(
        ctx context.Context,
        params *cloudwatchlogs.StartQueryInput,
        optFns ...func(*cloudwatchlogs.Options),
    ) (*cloudwatchlogs.StartQueryOutput, error)
    GetQueryResults(
        ctx context.Context,
        params *cloudwatchlogs.GetQueryResultsInput,
        optFns ...func(*cloudwatchlogs.Options),
    ) (*cloudwatchlogs.GetQueryResultsOutput, error)
}
```

<a name="CloudWatchLogsClientAdapter"></a>
## type [CloudWatchLogsClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/cloudwatchlogs.go#L41-L43>)

CloudWatchLogsClientAdapter wraps the AWS SDK CloudWatch Logs client to implement CloudWatchLogsClient interface. This allows us to use the real AWS client in production while maintaining testability.

```go
type CloudWatchLogsClientAdapter struct {
    // contains filtered or unexported fields
}
```

<a name="NewCloudWatchLogsClientAdapter"></a>
### func [NewCloudWatchLogsClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/cloudwatchlogs.go#L46>)

```go
func NewCloudWatchLogsClientAdapter(client *cloudwatchlogs.Client) *CloudWatchLogsClientAdapter
```

NewCloudWatchLogsClientAdapter creates a new adapter wrapping the AWS SDK CloudWatch Logs client.

<a name="CloudWatchLogsClientAdapter.DescribeLogGroups"></a>
### func \(\*CloudWatchLogsClientAdapter\) [DescribeLogGroups](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/cloudwatchlogs.go#L51-L55>)

```go
func (a *CloudWatchLogsClientAdapter) DescribeLogGroups(ctx context.Context, params *cloudwatchlogs.DescribeLogGroupsInput, optFns ...func(*cloudwatchlogs.Options)) (*cloudwatchlogs.DescribeLogGroupsOutput, error)
```

DescribeLogGroups wraps the AWS SDK DescribeLogGroups operation.

<a name="CloudWatchLogsClientAdapter.DescribeLogStreams"></a>
### func \(\*CloudWatchLogsClientAdapter\) [DescribeLogStreams](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/cloudwatchlogs.go#L60-L64>)

```go
func (a *CloudWatchLogsClientAdapter) DescribeLogStreams(ctx context.Context, params *cloudwatchlogs.DescribeLogStreamsInput, optFns ...func(*cloudwatchlogs.Options)) (*cloudwatchlogs.DescribeLogStreamsOutput, error)
```

DescribeLogStreams wraps the AWS SDK DescribeLogStreams operation.

<a name="CloudWatchLogsClientAdapter.GetLogEvents"></a>
### func \(\*CloudWatchLogsClientAdapter\) [GetLogEvents](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/cloudwatchlogs.go#L69-L73>)

```go
func (a *CloudWatchLogsClientAdapter) GetLogEvents(ctx context.Context, params *cloudwatchlogs.GetLogEventsInput, optFns ...func(*cloudwatchlogs.Options)) (*cloudwatchlogs.GetLogEventsOutput, error)
```

GetLogEvents wraps the AWS SDK GetLogEvents operation.

<a name="CloudWatchLogsClientAdapter.GetQueryResults"></a>
### func \(\*CloudWatchLogsClientAdapter\) [GetQueryResults](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/cloudwatchlogs.go#L87-L91>)

```go
func (a *CloudWatchLogsClientAdapter) GetQueryResults(ctx context.Context, params *cloudwatchlogs.GetQueryResultsInput, optFns ...func(*cloudwatchlogs.Options)) (*cloudwatchlogs.GetQueryResultsOutput, error)
```

GetQueryResults wraps the AWS SDK GetQueryResults operation for CloudWatch Logs Insights.

<a name="CloudWatchLogsClientAdapter.StartQuery"></a>
### func \(\*CloudWatchLogsClientAdapter\) [StartQuery](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/cloudwatchlogs.go#L78-L82>)

```go
func (a *CloudWatchLogsClientAdapter) StartQuery(ctx context.Context, params *cloudwatchlogs.StartQueryInput, optFns ...func(*cloudwatchlogs.Options)) (*cloudwatchlogs.StartQueryOutput, error)
```

StartQuery wraps the AWS SDK StartQuery operation for CloudWatch Logs Insights.

<a name="ECSClient"></a>
## type [ECSClient](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L13-L74>)

ECSClient defines the interface for ECS operations used across AWS provider packages. This interface makes the code easier to test by allowing mock implementations.

```go
type ECSClient interface {
    RunTask(
        ctx context.Context,
        params *ecs.RunTaskInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.RunTaskOutput, error)
    TagResource(
        ctx context.Context,
        params *ecs.TagResourceInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.TagResourceOutput, error)
    ListTasks(
        ctx context.Context,
        params *ecs.ListTasksInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.ListTasksOutput, error)
    DescribeTasks(
        ctx context.Context,
        params *ecs.DescribeTasksInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.DescribeTasksOutput, error)
    StopTask(
        ctx context.Context,
        params *ecs.StopTaskInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.StopTaskOutput, error)
    DescribeTaskDefinition(
        ctx context.Context,
        params *ecs.DescribeTaskDefinitionInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.DescribeTaskDefinitionOutput, error)
    ListTagsForResource(
        ctx context.Context,
        params *ecs.ListTagsForResourceInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.ListTagsForResourceOutput, error)
    ListTaskDefinitions(
        ctx context.Context,
        params *ecs.ListTaskDefinitionsInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.ListTaskDefinitionsOutput, error)
    RegisterTaskDefinition(
        ctx context.Context,
        params *ecs.RegisterTaskDefinitionInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.RegisterTaskDefinitionOutput, error)
    DeregisterTaskDefinition(
        ctx context.Context,
        params *ecs.DeregisterTaskDefinitionInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.DeregisterTaskDefinitionOutput, error)
    DeleteTaskDefinitions(
        ctx context.Context,
        params *ecs.DeleteTaskDefinitionsInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.DeleteTaskDefinitionsOutput, error)
    UntagResource(
        ctx context.Context,
        params *ecs.UntagResourceInput,
        optFns ...func(*ecs.Options),
    ) (*ecs.UntagResourceOutput, error)
}
```

<a name="ECSClientAdapter"></a>
## type [ECSClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L78-L80>)

ECSClientAdapter wraps the AWS SDK ECS client to implement ECSClient interface. This allows us to use the real AWS client in production while maintaining testability.

```go
type ECSClientAdapter struct {
    // contains filtered or unexported fields
}
```

<a name="NewECSClientAdapter"></a>
### func [NewECSClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L83>)

```go
func NewECSClientAdapter(client *ecs.Client) *ECSClientAdapter
```

NewECSClientAdapter creates a new adapter wrapping the AWS SDK ECS client.

<a name="ECSClientAdapter.DeleteTaskDefinitions"></a>
### func \(\*ECSClientAdapter\) [DeleteTaskDefinitions](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L178-L182>)

```go
func (a *ECSClientAdapter) DeleteTaskDefinitions(ctx context.Context, params *ecs.DeleteTaskDefinitionsInput, optFns ...func(*ecs.Options)) (*ecs.DeleteTaskDefinitionsOutput, error)
```

DeleteTaskDefinitions wraps the AWS SDK DeleteTaskDefinitions operation.

<a name="ECSClientAdapter.DeregisterTaskDefinition"></a>
### func \(\*ECSClientAdapter\) [DeregisterTaskDefinition](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L169-L173>)

```go
func (a *ECSClientAdapter) DeregisterTaskDefinition(ctx context.Context, params *ecs.DeregisterTaskDefinitionInput, optFns ...func(*ecs.Options)) (*ecs.DeregisterTaskDefinitionOutput, error)
```

DeregisterTaskDefinition wraps the AWS SDK DeregisterTaskDefinition operation.

<a name="ECSClientAdapter.DescribeTaskDefinition"></a>
### func \(\*ECSClientAdapter\) [DescribeTaskDefinition](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L133-L137>)

```go
func (a *ECSClientAdapter) DescribeTaskDefinition(ctx context.Context, params *ecs.DescribeTaskDefinitionInput, optFns ...func(*ecs.Options)) (*ecs.DescribeTaskDefinitionOutput, error)
```

DescribeTaskDefinition wraps the AWS SDK DescribeTaskDefinition operation.

<a name="ECSClientAdapter.DescribeTasks"></a>
### func \(\*ECSClientAdapter\) [DescribeTasks](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L115-L119>)

```go
func (a *ECSClientAdapter) DescribeTasks(ctx context.Context, params *ecs.DescribeTasksInput, optFns ...func(*ecs.Options)) (*ecs.DescribeTasksOutput, error)
```

DescribeTasks wraps the AWS SDK DescribeTasks operation.

<a name="ECSClientAdapter.ListTagsForResource"></a>
### func \(\*ECSClientAdapter\) [ListTagsForResource](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L142-L146>)

```go
func (a *ECSClientAdapter) ListTagsForResource(ctx context.Context, params *ecs.ListTagsForResourceInput, optFns ...func(*ecs.Options)) (*ecs.ListTagsForResourceOutput, error)
```

ListTagsForResource wraps the AWS SDK ListTagsForResource operation.

<a name="ECSClientAdapter.ListTaskDefinitions"></a>
### func \(\*ECSClientAdapter\) [ListTaskDefinitions](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L151-L155>)

```go
func (a *ECSClientAdapter) ListTaskDefinitions(ctx context.Context, params *ecs.ListTaskDefinitionsInput, optFns ...func(*ecs.Options)) (*ecs.ListTaskDefinitionsOutput, error)
```

ListTaskDefinitions wraps the AWS SDK ListTaskDefinitions operation.

<a name="ECSClientAdapter.ListTasks"></a>
### func \(\*ECSClientAdapter\) [ListTasks](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L106-L110>)

```go
func (a *ECSClientAdapter) ListTasks(ctx context.Context, params *ecs.ListTasksInput, optFns ...func(*ecs.Options)) (*ecs.ListTasksOutput, error)
```

ListTasks wraps the AWS SDK ListTasks operation.

<a name="ECSClientAdapter.RegisterTaskDefinition"></a>
### func \(\*ECSClientAdapter\) [RegisterTaskDefinition](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L160-L164>)

```go
func (a *ECSClientAdapter) RegisterTaskDefinition(ctx context.Context, params *ecs.RegisterTaskDefinitionInput, optFns ...func(*ecs.Options)) (*ecs.RegisterTaskDefinitionOutput, error)
```

RegisterTaskDefinition wraps the AWS SDK RegisterTaskDefinition operation.

<a name="ECSClientAdapter.RunTask"></a>
### func \(\*ECSClientAdapter\) [RunTask](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L88-L92>)

```go
func (a *ECSClientAdapter) RunTask(ctx context.Context, params *ecs.RunTaskInput, optFns ...func(*ecs.Options)) (*ecs.RunTaskOutput, error)
```

RunTask wraps the AWS SDK RunTask operation.

<a name="ECSClientAdapter.StopTask"></a>
### func \(\*ECSClientAdapter\) [StopTask](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L124-L128>)

```go
func (a *ECSClientAdapter) StopTask(ctx context.Context, params *ecs.StopTaskInput, optFns ...func(*ecs.Options)) (*ecs.StopTaskOutput, error)
```

StopTask wraps the AWS SDK StopTask operation.

<a name="ECSClientAdapter.TagResource"></a>
### func \(\*ECSClientAdapter\) [TagResource](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L97-L101>)

```go
func (a *ECSClientAdapter) TagResource(ctx context.Context, params *ecs.TagResourceInput, optFns ...func(*ecs.Options)) (*ecs.TagResourceOutput, error)
```

TagResource wraps the AWS SDK TagResource operation.

<a name="ECSClientAdapter.UntagResource"></a>
### func \(\*ECSClientAdapter\) [UntagResource](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/ecs.go#L187-L191>)

```go
func (a *ECSClientAdapter) UntagResource(ctx context.Context, params *ecs.UntagResourceInput, optFns ...func(*ecs.Options)) (*ecs.UntagResourceOutput, error)
```

UntagResource wraps the AWS SDK UntagResource operation.

<a name="IAMClient"></a>
## type [IAMClient](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/iam.go#L11-L17>)

IAMClient defines the interface for IAM operations used across AWS provider packages. This interface makes the code easier to test by allowing mock implementations.

```go
type IAMClient interface {
    GetRole(
        ctx context.Context,
        params *iam.GetRoleInput,
        optFns ...func(*iam.Options),
    ) (*iam.GetRoleOutput, error)
}
```

<a name="IAMClientAdapter"></a>
## type [IAMClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/iam.go#L21-L23>)

IAMClientAdapter wraps the AWS SDK IAM client to implement IAMClient interface. This allows us to use the real AWS client in production while maintaining testability.

```go
type IAMClientAdapter struct {
    // contains filtered or unexported fields
}
```

<a name="NewIAMClientAdapter"></a>
### func [NewIAMClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/iam.go#L26>)

```go
func NewIAMClientAdapter(client *iam.Client) *IAMClientAdapter
```

NewIAMClientAdapter creates a new adapter wrapping the AWS SDK IAM client.

<a name="IAMClientAdapter.GetRole"></a>
### func \(\*IAMClientAdapter\) [GetRole](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/client/iam.go#L31-L35>)

```go
func (a *IAMClientAdapter) GetRole(ctx context.Context, params *iam.GetRoleInput, optFns ...func(*iam.Options)) (*iam.GetRoleOutput, error)
```

GetRole wraps the AWS SDK GetRole operation.

# constants

```go
import "runvoy/internal/providers/aws/constants"
```

Package constants provides AWS\-specific constants for CloudWatch logging and events.

Package constants provides AWS\-specific constants for ECS task execution.

Package constants provides AWS\-specific constants for infrastructure deployment.

Package constants provides AWS\-specific constants and utilities for log stream handling.

Package constants provides AWS\-specific constants for secrets management.

## Index

- [Constants](<#constants>)
- [func BuildLogStreamName\(executionID string\) string](<#BuildLogStreamName>)
- [func ExtractExecutionIDFromLogStream\(logStream string\) string](<#ExtractExecutionIDFromLogStream>)
- [func GetReleaseRegions\(\) \[\]string](<#GetReleaseRegions>)
- [func SupportedRuntimePlatforms\(\) \[\]string](<#SupportedRuntimePlatforms>)
- [func ValidateRegion\(region string\) error](<#ValidateRegion>)
- [type EcsStatus](<#EcsStatus>)


## Constants

<a name="DefaultInfraStackName"></a>

```go
const (
    // DefaultInfraStackName is the default CloudFormation stack name for AWS infra deployments
    DefaultInfraStackName = "runvoy-backend"

    // ReleasesBucketRegion is the AWS region where the releases bucket is located
    ReleasesBucketRegion = "us-east-1"

    // ReleasesBucket is the S3 bucket name for runvoy releases
    ReleasesBucket = "runvoy-releases-" + ReleasesBucketRegion

    // CloudFormationTemplateFile is the filename of the CloudFormation template in releases
    CloudFormationTemplateFile = "cloudformation-backend.yaml"
)
```

<a name="CloudWatchLogsDescribeLimit"></a>CloudWatchLogsDescribeLimit is the limit for CloudWatch Logs DescribeLogStreams API

```go
const CloudWatchLogsDescribeLimit = int32(50)
```

<a name="CloudWatchLogsEventsLimit"></a>CloudWatchLogsEventsLimit is the limit for CloudWatch Logs GetLogEvents API

```go
const CloudWatchLogsEventsLimit = int32(10000)
```

<a name="CloudWatchLogsQueryInitialDelay"></a>CloudWatchLogsQueryInitialDelay is the initial delay in seconds to allow CloudWatch Logs Insights query to become ready before polling

```go
const CloudWatchLogsQueryInitialDelay = 10 * time.Second
```

<a name="CloudWatchLogsQueryMaxAttempts"></a>CloudWatchLogsQueryMaxAttempts is the maximum number of polling attempts for CloudWatch Logs Insights query results

```go
const CloudWatchLogsQueryMaxAttempts = 30
```

<a name="CloudWatchLogsQueryPollInterval"></a>CloudWatchLogsQueryPollInterval is the polling interval in milliseconds for checking CloudWatch Logs Insights query results

```go
const CloudWatchLogsQueryPollInterval = time.Second
```

<a name="DefaultCPU"></a>DefaultCPU is the default CPU units for ECS task definitions

```go
const DefaultCPU = 256
```

<a name="DefaultExecutionListCapacity"></a>DefaultExecutionListCapacity is the initial slice capacity used when listing executions from DynamoDB without an explicit limit.

```go
const DefaultExecutionListCapacity = 16
```

<a name="DefaultMemory"></a>DefaultMemory is the default memory \(in MB\) for ECS task definitions

```go
const DefaultMemory = 512
```

<a name="DefaultRuntimePlatform"></a>DefaultRuntimePlatform is the default runtime platform for ECS task definitions

```go
const DefaultRuntimePlatform = DefaultRuntimePlatformOSFamily + "/" + DefaultRuntimePlatformArchitecture
```

<a name="DefaultRuntimePlatformArchitecture"></a>DefaultRuntimePlatformArchitecture is the default architecture for ECS task definitions

```go
const DefaultRuntimePlatformArchitecture = RuntimePlatformArchARM64
```

<a name="DefaultRuntimePlatformOSFamily"></a>DefaultRuntimePlatformOSFamily is the default OS family for ECS task definitions

```go
const DefaultRuntimePlatformOSFamily = "Linux"
```

<a name="ECSEphemeralStorageSizeGiB"></a>ECSEphemeralStorageSizeGiB is the ECS ephemeral storage size in GiB

```go
const ECSEphemeralStorageSizeGiB = 21
```

<a name="ECSTaskDefinitionMaxResults"></a>ECSTaskDefinitionMaxResults is the maximum number of results for ECS ListTaskDefinitions

```go
const ECSTaskDefinitionMaxResults = int32(100)
```

<a name="LogGroupPrefix"></a>LogGroupPrefix is the prefix for all runvoy Lambda log groups

```go
const LogGroupPrefix = "/aws/lambda/" + constants.ProjectName
```

<a name="LogStreamPartsCount"></a>LogStreamPartsCount is the expected number of parts in a log stream name Format: task/\{container\}/\{execution\_id\} = 3 parts

```go
const LogStreamPartsCount = 3
```

<a name="LogStreamPrefix"></a>LogStreamPrefix is the prefix for all log stream names for ECS tasks

```go
const LogStreamPrefix = "task"
```

<a name="RunnerContainerName"></a>RunnerContainerName is the ECS container name used for task execution. Must match the container override name passed in the ECS RunTask call.

```go
const RunnerContainerName = "runner"
```

<a name="RuntimePlatformArchARM64"></a>RuntimePlatformArchARM64 is the ARM64 architecture for ECS runtime platform

```go
const RuntimePlatformArchARM64 = "ARM64"
```

<a name="RuntimePlatformArchX8664"></a>RuntimePlatformArchX8664 is the x86\_64 architecture for ECS runtime platform

```go
const RuntimePlatformArchX8664 = "X86_64"
```

<a name="SSMParameterMaxResults"></a>SSMParameterMaxResults is the maximum number of results for SSM DescribeParameters

```go
const SSMParameterMaxResults = int32(50)
```

<a name="ScheduledEventHealthReconcile"></a>ScheduledEventHealthReconcile is the expected runvoy\_event payload value for EventBridge scheduled events that trigger health reconciliation.

```go
const ScheduledEventHealthReconcile = "health_reconcile"
```

<a name="SecretsPrefix"></a>SecretsPrefix is the prefix for AWS secrets management.

```go
const SecretsPrefix = "/runvoy/secrets" //nolint:gosec // G101: This is a constant, not a hardcoded credential
```

<a name="SharedVolumeName"></a>SharedVolumeName is the name of the shared volume between containers. Used for sharing the cloned git repository from sidecar to main container.

```go
const SharedVolumeName = "workspace"
```

<a name="SharedVolumePath"></a>SharedVolumePath is the mount path for the shared volume in both containers.

```go
const SharedVolumePath = "/workspace"
```

<a name="SidecarContainerName"></a>SidecarContainerName is the sidecar container name for auxiliary tasks. This container runs before the main runner container and handles tasks like .env file generation from user environment variables, git repository cloning, etc.

```go
const SidecarContainerName = "sidecar"
```

<a name="TaskDefinitionDockerImageTagKey"></a>TaskDefinitionDockerImageTagKey is the ECS tag key used to store the Docker image name for metadata

```go
const TaskDefinitionDockerImageTagKey = "DockerImage"
```

<a name="TaskDefinitionFamilyPrefix"></a>TaskDefinitionFamilyPrefix is the prefix for all runvoy task definition families Task definitions are named: \{ProjectName\}\-image\-\{sanitized\-image\-name\} e.g., "runvoy\-image\-hashicorp\-terraform\-1\-6" for image "hashicorp/terraform:1.6"

```go
const TaskDefinitionFamilyPrefix = constants.ProjectName + "-image"
```

<a name="TaskDefinitionIsDefaultTagKey"></a>TaskDefinitionIsDefaultTagKey is the ECS tag key used to mark a task definition as the default image

```go
const TaskDefinitionIsDefaultTagKey = "IsDefault"
```

<a name="TaskDefinitionIsDefaultTagValue"></a>TaskDefinitionIsDefaultTagValue is the tag value used to mark a task definition as the default image

```go
const TaskDefinitionIsDefaultTagValue = "true"
```

<a name="BuildLogStreamName"></a>
## func [BuildLogStreamName](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/constants/logstream.go#L11>)

```go
func BuildLogStreamName(executionID string) string
```

BuildLogStreamName constructs a CloudWatch Logs stream name for an execution. Format: task/\{container\}/\{execution\_id\} Example: task/runner/abc123

<a name="ExtractExecutionIDFromLogStream"></a>
## func [ExtractExecutionIDFromLogStream](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/constants/logstream.go#L18>)

```go
func ExtractExecutionIDFromLogStream(logStream string) string
```

ExtractExecutionIDFromLogStream extracts the execution ID from a CloudWatch Logs stream name. Expected format: task/\{container\}/\{execution\_id\} Returns empty string if the format is not recognized.

<a name="GetReleaseRegions"></a>
## func [GetReleaseRegions](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/constants/infra.go#L16>)

```go
func GetReleaseRegions() []string
```

GetReleaseRegions returns a slice of supported AWS regions for releases. The regions are parsed from the comma\-separated string injected at build time.

<a name="SupportedRuntimePlatforms"></a>
## func [SupportedRuntimePlatforms](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/constants/ecs.go#L80>)

```go
func SupportedRuntimePlatforms() []string
```

SupportedRuntimePlatforms returns the list of supported ECS runtime platforms.

<a name="ValidateRegion"></a>
## func [ValidateRegion](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/constants/infra.go#L35>)

```go
func ValidateRegion(region string) error
```

ValidateRegion validates that the given region is in the supported regions list. Returns an error if the region is not supported, or if no regions are configured.

<a name="EcsStatus"></a>
## type [EcsStatus](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/constants/ecs.go#L24>)

EcsStatus represents the AWS ECS Task LastStatus lifecycle values. These are string statuses returned by ECS DescribeTasks for Task.LastStatus.

```go
type EcsStatus string
```

<a name="EcsStatusProvisioning"></a>

```go
const (
    // EcsStatusProvisioning represents a task being provisioned
    EcsStatusProvisioning EcsStatus = "PROVISIONING"
    // EcsStatusPending represents a task pending activation
    EcsStatusPending EcsStatus = "PENDING"
    // EcsStatusActivating represents a task being activated
    EcsStatusActivating EcsStatus = "ACTIVATING"
    // EcsStatusRunning represents a task currently running
    EcsStatusRunning EcsStatus = "RUNNING"
    // EcsStatusDeactivating represents a task being deactivated
    EcsStatusDeactivating EcsStatus = "DEACTIVATING"
    // EcsStatusStopping represents a task being stopped
    EcsStatusStopping EcsStatus = "STOPPING"
    // EcsStatusDeprovisioning represents a task being deprovisioned
    EcsStatusDeprovisioning EcsStatus = "DEPROVISIONING"
    // EcsStatusStopped represents a task that has stopped
    EcsStatusStopped EcsStatus = "STOPPED"
)
```

# database

```go
import "runvoy/internal/providers/aws/database"
```

Package database provides AWS\-specific database implementations. This file contains a SecretsRepository that coordinates DynamoDB and Parameter Store.

## Index

- [type MetadataRepository](<#MetadataRepository>)
- [type Repositories](<#Repositories>)
  - [func CreateRepositories\(dynamoClient dynamoRepo.Client, ssmClient secrets.Client, cfg \*config.Config, log \*slog.Logger\) \*Repositories](<#CreateRepositories>)
- [type SecretsRepository](<#SecretsRepository>)
  - [func NewSecretsRepository\(metadataRepo MetadataRepository, valueStore secrets.ValueStore, logger \*slog.Logger\) \*SecretsRepository](<#NewSecretsRepository>)
  - [func \(sr \*SecretsRepository\) CreateSecret\(ctx context.Context, secret \*api.Secret\) error](<#SecretsRepository.CreateSecret>)
  - [func \(sr \*SecretsRepository\) DeleteSecret\(ctx context.Context, name string\) error](<#SecretsRepository.DeleteSecret>)
  - [func \(sr \*SecretsRepository\) GetSecret\(ctx context.Context, name string, includeValue bool\) \(\*api.Secret, error\)](<#SecretsRepository.GetSecret>)
  - [func \(sr \*SecretsRepository\) GetSecretsByRequestID\(ctx context.Context, requestID string\) \(\[\]\*api.Secret, error\)](<#SecretsRepository.GetSecretsByRequestID>)
  - [func \(sr \*SecretsRepository\) ListSecrets\(ctx context.Context, includeValue bool\) \(\[\]\*api.Secret, error\)](<#SecretsRepository.ListSecrets>)
  - [func \(sr \*SecretsRepository\) UpdateSecret\(ctx context.Context, secret \*api.Secret\) error](<#SecretsRepository.UpdateSecret>)


<a name="MetadataRepository"></a>
## type [MetadataRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/secrets.go#L18-L26>)

MetadataRepository defines the interface for secret metadata operations.

```go
type MetadataRepository interface {
    CreateSecret(ctx context.Context, secret *api.Secret) error
    GetSecret(ctx context.Context, name string) (*api.Secret, error)
    ListSecrets(ctx context.Context) ([]*api.Secret, error)
    UpdateSecretMetadata(ctx context.Context, name, keyName, description, updatedBy string) error
    DeleteSecret(ctx context.Context, name string) error
    SecretExists(ctx context.Context, name string) (bool, error)
    GetSecretsByRequestID(ctx context.Context, requestID string) ([]*api.Secret, error)
}
```

<a name="Repositories"></a>
## type [Repositories](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/repositories.go#L13-L20>)

Repositories bundles all AWS\-backed database repositories.

```go
type Repositories struct {
    UserRepo         database.UserRepository
    ExecutionRepo    database.ExecutionRepository
    ConnectionRepo   database.ConnectionRepository
    TokenRepo        database.TokenRepository
    ImageTaskDefRepo *dynamoRepo.ImageTaskDefRepository
    SecretsRepo      database.SecretsRepository
}
```

<a name="CreateRepositories"></a>
### func [CreateRepositories](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/repositories.go#L23-L28>)

```go
func CreateRepositories(dynamoClient dynamoRepo.Client, ssmClient secrets.Client, cfg *config.Config, log *slog.Logger) *Repositories
```

CreateRepositories creates all AWS\-backed database repositories from the provided clients and configuration.

<a name="SecretsRepository"></a>
## type [SecretsRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/secrets.go#L30-L34>)

SecretsRepository implements database.SecretsRepository for AWS. It coordinates DynamoDB \(metadata\) and Parameter Store \(values\) to provide a unified interface.

```go
type SecretsRepository struct {
    // contains filtered or unexported fields
}
```

<a name="NewSecretsRepository"></a>
### func [NewSecretsRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/secrets.go#L40-L44>)

```go
func NewSecretsRepository(metadataRepo MetadataRepository, valueStore secrets.ValueStore, logger *slog.Logger) *SecretsRepository
```

NewSecretsRepository creates a new AWS secrets repository.

<a name="SecretsRepository.CreateSecret"></a>
### func \(\*SecretsRepository\) [CreateSecret](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/secrets.go#L53-L56>)

```go
func (sr *SecretsRepository) CreateSecret(ctx context.Context, secret *api.Secret) error
```

CreateSecret stores a new secret with both metadata and value.

<a name="SecretsRepository.DeleteSecret"></a>
### func \(\*SecretsRepository\) [DeleteSecret](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/secrets.go#L180>)

```go
func (sr *SecretsRepository) DeleteSecret(ctx context.Context, name string) error
```

DeleteSecret removes both the metadata and value of a secret.

<a name="SecretsRepository.GetSecret"></a>
### func \(\*SecretsRepository\) [GetSecret](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/secrets.go#L77>)

```go
func (sr *SecretsRepository) GetSecret(ctx context.Context, name string, includeValue bool) (*api.Secret, error)
```

GetSecret retrieves a secret with its metadata and optionally its value.

<a name="SecretsRepository.GetSecretsByRequestID"></a>
### func \(\*SecretsRepository\) [GetSecretsByRequestID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/secrets.go#L198>)

```go
func (sr *SecretsRepository) GetSecretsByRequestID(ctx context.Context, requestID string) ([]*api.Secret, error)
```

GetSecretsByRequestID retrieves all secrets created or modified by a specific request ID.

<a name="SecretsRepository.ListSecrets"></a>
### func \(\*SecretsRepository\) [ListSecrets](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/secrets.go#L106>)

```go
func (sr *SecretsRepository) ListSecrets(ctx context.Context, includeValue bool) ([]*api.Secret, error)
```

ListSecrets retrieves all secrets with optionally their values.

<a name="SecretsRepository.UpdateSecret"></a>
### func \(\*SecretsRepository\) [UpdateSecret](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/secrets.go#L136-L139>)

```go
func (sr *SecretsRepository) UpdateSecret(ctx context.Context, secret *api.Secret) error
```

UpdateSecret updates a secret's metadata and/or value.

# ecsdefs

```go
import "runvoy/internal/providers/aws/ecsdefs"
```

Package ecsdefs contains shared ECS task definition utilities for AWS providers. It is intentionally decoupled from the orchestrator package so it can be reused by both the orchestrator and the health manager without creating import cycles.

## Index

- [func BuildTaskDefinitionInputForConfig\(ctx context.Context, family, image, taskExecRoleARN, taskRoleARN, logGroup, region string, cpu, memory, runtimePlatform string\) \*ecs.RegisterTaskDefinitionInput](<#BuildTaskDefinitionInputForConfig>)
- [func BuildTaskDefinitionTags\(image string, isDefault \*bool\) \[\]ecsTypes.Tag](<#BuildTaskDefinitionTags>)
- [func RecreateTaskDefinition\(ctx context.Context, ecsClient awsClient.ECSClient, cfg \*TaskDefinitionConfig, family string, image string, taskRoleARN string, taskExecRoleARN string, cpu, memory int, runtimePlatform string, isDefault bool, reqLogger \*slog.Logger\) \(string, error\)](<#RecreateTaskDefinition>)
- [func UpdateTaskDefinitionTags\(ctx context.Context, ecsClient awsClient.ECSClient, taskDefARN string, image string, isDefault bool, reqLogger \*slog.Logger\) error](<#UpdateTaskDefinitionTags>)
- [type TaskDefinitionConfig](<#TaskDefinitionConfig>)


<a name="BuildTaskDefinitionInputForConfig"></a>
## func [BuildTaskDefinitionInputForConfig](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/ecsdefs/taskdefs.go#L287-L291>)

```go
func BuildTaskDefinitionInputForConfig(ctx context.Context, family, image, taskExecRoleARN, taskRoleARN, logGroup, region string, cpu, memory, runtimePlatform string) *ecs.RegisterTaskDefinitionInput
```

BuildTaskDefinitionInputForConfig creates the RegisterTaskDefinitionInput for a new task definition.

<a name="BuildTaskDefinitionTags"></a>
## func [BuildTaskDefinitionTags](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/ecsdefs/taskdefs.go#L31>)

```go
func BuildTaskDefinitionTags(image string, isDefault *bool) []ecsTypes.Tag
```

BuildTaskDefinitionTags creates the tags to be applied to a task definition.

<a name="RecreateTaskDefinition"></a>
## func [RecreateTaskDefinition](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/ecsdefs/taskdefs.go#L60-L72>)

```go
func RecreateTaskDefinition(ctx context.Context, ecsClient awsClient.ECSClient, cfg *TaskDefinitionConfig, family string, image string, taskRoleARN string, taskExecRoleARN string, cpu, memory int, runtimePlatform string, isDefault bool, reqLogger *slog.Logger) (string, error)
```

RecreateTaskDefinition recreates a task definition from stored metadata. This function is used by the health manager to restore missing task definitions.

<a name="UpdateTaskDefinitionTags"></a>
## func [UpdateTaskDefinitionTags](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/ecsdefs/taskdefs.go#L161-L168>)

```go
func UpdateTaskDefinitionTags(ctx context.Context, ecsClient awsClient.ECSClient, taskDefARN string, image string, isDefault bool, reqLogger *slog.Logger) error
```

UpdateTaskDefinitionTags updates tags on an existing task definition to match expected values.

<a name="TaskDefinitionConfig"></a>
## type [TaskDefinitionConfig](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/ecsdefs/taskdefs.go#L25-L28>)

TaskDefinitionConfig contains configuration needed to build task definitions.

```go
type TaskDefinitionConfig struct {
    LogGroup string
    Region   string
}
```

# health

```go
import "runvoy/internal/providers/aws/health"
```

Package health provides AWS\-specific health management implementation for runvoy. It reconciles resources between DynamoDB metadata and actual AWS services.

## Index

- [type Config](<#Config>)
- [type ImageTaskDefRepository](<#ImageTaskDefRepository>)
- [type Manager](<#Manager>)
  - [func Initialize\(ecsClient awsClient.ECSClient, ssmClient secrets.Client, iamClient awsClient.IAMClient, imageRepo ImageTaskDefRepository, secretsRepo database.SecretsRepository, userRepo database.UserRepository, executionRepo database.ExecutionRepository, enforcer \*authorization.Enforcer, cfg \*Config, log \*slog.Logger\) \*Manager](<#Initialize>)
  - [func \(m \*Manager\) Reconcile\(ctx context.Context\) \(\*api.HealthReport, error\)](<#Manager.Reconcile>)
  - [func \(m \*Manager\) SetCasbinDependencies\(userRepo database.UserRepository, executionRepo database.ExecutionRepository, enforcer \*authorization.Enforcer\)](<#Manager.SetCasbinDependencies>)


<a name="Config"></a>
## type [Config](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/health/manager.go#L43-L50>)

Config holds AWS\-specific configuration for the health manager.

```go
type Config struct {
    Region                 string
    AccountID              string
    DefaultTaskRoleARN     string
    DefaultTaskExecRoleARN string
    LogGroup               string
    SecretsPrefix          string
}
```

<a name="ImageTaskDefRepository"></a>
## type [ImageTaskDefRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/health/manager.go#L23-L25>)

ImageTaskDefRepository defines the interface for image\-taskdef mapping operations.

```go
type ImageTaskDefRepository interface {
    ListImages(ctx context.Context) ([]api.ImageInfo, error)
}
```

<a name="Manager"></a>
## type [Manager](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/health/manager.go#L28-L40>)

Manager implements the health.Manager interface for AWS.

```go
type Manager struct {
    // contains filtered or unexported fields
}
```

<a name="Initialize"></a>
### func [Initialize](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/health/manager.go#L53-L64>)

```go
func Initialize(ecsClient awsClient.ECSClient, ssmClient secrets.Client, iamClient awsClient.IAMClient, imageRepo ImageTaskDefRepository, secretsRepo database.SecretsRepository, userRepo database.UserRepository, executionRepo database.ExecutionRepository, enforcer *authorization.Enforcer, cfg *Config, log *slog.Logger) *Manager
```

Initialize creates a new AWS health manager.

<a name="Manager.Reconcile"></a>
### func \(\*Manager\) [Reconcile](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/health/manager.go#L93>)

```go
func (m *Manager) Reconcile(ctx context.Context) (*api.HealthReport, error)
```

Reconcile performs health checks and reconciliation for ECS task definitions, SSM parameters, and IAM roles.

<a name="Manager.SetCasbinDependencies"></a>
### func \(\*Manager\) [SetCasbinDependencies](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/health/manager.go#L82-L86>)

```go
func (m *Manager) SetCasbinDependencies(userRepo database.UserRepository, executionRepo database.ExecutionRepository, enforcer *authorization.Enforcer)
```

SetCasbinDependencies sets the Casbin\-related dependencies for the health manager. This allows the enforcer to be set after initialization when it becomes available.

# identity

```go
import "runvoy/internal/providers/aws/identity"
```

Package identity provides helpers for retrieving AWS identity information.

## Index

- [func GetAccountID\(ctx context.Context, awsCfg \*awsStd.Config, log \*slog.Logger\) \(string, error\)](<#GetAccountID>)


<a name="GetAccountID"></a>
## func [GetAccountID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/identity/identity.go#L14>)

```go
func GetAccountID(ctx context.Context, awsCfg *awsStd.Config, log *slog.Logger) (string, error)
```

GetAccountID retrieves the AWS account ID using STS GetCallerIdentity.

# lambdaapi

```go
import "runvoy/internal/providers/aws/lambdaapi"
```

Package lambdaapi provides Lambda handler creation for AWS Lambda, integrating cloud\-provider agnostic components with AWS\-specific entry points.

Package lambdaapi provides Lambda handler creation for AWS Lambda Function URLs, integrating the application service with the HTTP router through algnhsa adapter.

## Index

- [func NewEventProcessorHandler\(proc processor.Processor\) lambda.Handler](<#NewEventProcessorHandler>)
- [func NewHandler\(svc \*orchestrator.Service, requestTimeout time.Duration, allowedOrigins \[\]string\) lambda.Handler](<#NewHandler>)


<a name="NewEventProcessorHandler"></a>
## func [NewEventProcessorHandler](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/lambdaapi/event_handler.go#L20>)

```go
func NewEventProcessorHandler(proc processor.Processor) lambda.Handler
```

NewEventProcessorHandler creates a new Lambda handler for event processing. It wraps the generic event processor and converts responses to AWS Lambda types, allowing the core processor to remain cloud\-provider agnostic while still supporting AWS Lambda's specific response formats.

<a name="NewHandler"></a>
## func [NewHandler](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/lambdaapi/handler.go#L17>)

```go
func NewHandler(svc *orchestrator.Service, requestTimeout time.Duration, allowedOrigins []string) lambda.Handler
```

NewHandler creates a new Lambda handler with the given service. The request timeout is passed to the router to configure the timeout middleware. It uses algnhsa to adapt the chi router to work with Lambda Function URLs.

# orchestrator

```go
import "runvoy/internal/providers/aws/orchestrator"
```

Package orchestrator provides AWS\-specific implementations for runvoy orchestrator. This file contains the ImageManager implementation for image registration and management.

Package orchestrator provides AWS\-specific implementations for runvoy orchestrator. This file contains Docker image reference parsing utilities.

Package orchestrator provides AWS\-specific implementations for runvoy orchestrator. This file contains image management using DynamoDB for image\-taskdef mappings.

Package orchestrator provides AWS\-specific implementations for runvoy orchestrator. This file contains the LogManager implementation for execution log retrieval.

Package orchestrator provides AWS\-specific implementations for runvoy orchestrator. This file contains the ObservabilityManager implementation for backend log retrieval.

Package orchestrator provides AWS\-specific implementations for runvoy orchestrator. It handles ECS task execution and AWS service integration.

Package orchestrator provides AWS\-specific implementations for runvoy orchestrator. This file contains shared tagging utilities for AWS resources.

Package orchestrator provides AWS\-specific implementations for runvoy orchestrator.

## Index

- [func BuildTaskDefinitionInput\(ctx context.Context, family, image, taskExecRoleARN, taskRoleARN, region string, cpu, memory int, runtimePlatform string, cfg \*Config\) \*ecs.RegisterTaskDefinitionInput](<#BuildTaskDefinitionInput>)
- [func DeregisterTaskDefinitionsForImage\(ctx context.Context, ecsClient awsClient.ECSClient, image string, log \*slog.Logger\) error](<#DeregisterTaskDefinitionsForImage>)
- [func ExtractImageFromTaskDefFamily\(familyName string\) string](<#ExtractImageFromTaskDefFamily>)
- [func GetDefaultImage\(ctx context.Context, ecsClient awsClient.ECSClient, log \*slog.Logger\) \(string, error\)](<#GetDefaultImage>)
- [func GetStandardECSTags\(\) \[\]ecsTypes.Tag](<#GetStandardECSTags>)
- [func GetTaskDefinitionForImage\(ctx context.Context, ecsClient awsClient.ECSClient, image string, log \*slog.Logger\) \(string, error\)](<#GetTaskDefinitionForImage>)
- [func SanitizeImageNameForTaskDef\(image string\) string](<#SanitizeImageNameForTaskDef>)
- [func TaskDefinitionFamilyName\(image string\) string](<#TaskDefinitionFamilyName>)
- [type Config](<#Config>)
- [type Dependencies](<#Dependencies>)
  - [func Initialize\(ctx context.Context, cfg \*config.Config, log \*slog.Logger, enforcer \*authorization.Enforcer\) \(\*Dependencies, error\)](<#Initialize>)
- [type ImageReference](<#ImageReference>)
  - [func ParseImageReference\(image string\) ImageReference](<#ParseImageReference>)
  - [func \(r ImageReference\) IsDockerHub\(\) bool](<#ImageReference.IsDockerHub>)
  - [func \(r ImageReference\) IsECR\(\) bool](<#ImageReference.IsECR>)
  - [func \(r ImageReference\) NameWithTag\(\) string](<#ImageReference.NameWithTag>)
  - [func \(r ImageReference\) NormalizeRegistry\(\) string](<#ImageReference.NormalizeRegistry>)
  - [func \(r ImageReference\) ShortName\(\) string](<#ImageReference.ShortName>)
- [type ImageRegistryImpl](<#ImageRegistryImpl>)
  - [func NewImageRegistry\(ecsClient awsClient.ECSClient, iamClient awsClient.IAMClient, imageRepo ImageTaskDefRepository, cfg \*Config, log \*slog.Logger\) \*ImageRegistryImpl](<#NewImageRegistry>)
  - [func \(m \*ImageRegistryImpl\) GetImage\(ctx context.Context, image string\) \(\*api.ImageInfo, error\)](<#ImageRegistryImpl.GetImage>)
  - [func \(m \*ImageRegistryImpl\) ListImages\(ctx context.Context\) \(\[\]api.ImageInfo, error\)](<#ImageRegistryImpl.ListImages>)
  - [func \(m \*ImageRegistryImpl\) RegisterImage\(ctx context.Context, image string, isDefault \*bool, taskRoleName \*string, taskExecutionRoleName \*string, cpu \*int, memory \*int, runtimePlatform \*string, createdBy string\) error](<#ImageRegistryImpl.RegisterImage>)
  - [func \(m \*ImageRegistryImpl\) RemoveImage\(ctx context.Context, image string\) error](<#ImageRegistryImpl.RemoveImage>)
- [type ImageTaskDefRepository](<#ImageTaskDefRepository>)
- [type LambdaContextExtractor](<#LambdaContextExtractor>)
  - [func NewLambdaContextExtractor\(\) \*LambdaContextExtractor](<#NewLambdaContextExtractor>)
  - [func \(e \*LambdaContextExtractor\) ExtractRequestID\(ctx context.Context\) \(string, bool\)](<#LambdaContextExtractor.ExtractRequestID>)
- [type LogManagerImpl](<#LogManagerImpl>)
  - [func NewLogManager\(cwlClient awsClient.CloudWatchLogsClient, cfg \*Config, log \*slog.Logger\) \*LogManagerImpl](<#NewLogManager>)
  - [func \(l \*LogManagerImpl\) FetchLogsByExecutionID\(ctx context.Context, executionID string\) \(\[\]api.LogEvent, error\)](<#LogManagerImpl.FetchLogsByExecutionID>)
- [type ObservabilityManagerImpl](<#ObservabilityManagerImpl>)
  - [func NewObservabilityManager\(cwlClient awsClient.CloudWatchLogsClient, log \*slog.Logger\) \*ObservabilityManagerImpl](<#NewObservabilityManager>)
  - [func \(o \*ObservabilityManagerImpl\) FetchBackendLogs\(ctx context.Context, requestID string\) \(\[\]api.LogEvent, error\)](<#ObservabilityManagerImpl.FetchBackendLogs>)
- [type TaskManagerImpl](<#TaskManagerImpl>)
  - [func NewTaskManager\(ecsClient awsClient.ECSClient, imageRepo ImageTaskDefRepository, cfg \*Config, log \*slog.Logger\) \*TaskManagerImpl](<#NewTaskManager>)
  - [func \(t \*TaskManagerImpl\) KillTask\(ctx context.Context, executionID string\) error](<#TaskManagerImpl.KillTask>)
  - [func \(t \*TaskManagerImpl\) StartTask\(ctx context.Context, userEmail string, req \*api.ExecutionRequest\) \(string, \*time.Time, error\)](<#TaskManagerImpl.StartTask>)


<a name="BuildTaskDefinitionInput"></a>
## func [BuildTaskDefinitionInput](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/taskdef.go#L176-L182>)

```go
func BuildTaskDefinitionInput(ctx context.Context, family, image, taskExecRoleARN, taskRoleARN, region string, cpu, memory int, runtimePlatform string, cfg *Config) *ecs.RegisterTaskDefinitionInput
```

BuildTaskDefinitionInput creates the ECS RegisterTaskDefinitionInput for a new task definition.

<a name="DeregisterTaskDefinitionsForImage"></a>
## func [DeregisterTaskDefinitionsForImage](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/taskdef.go#L405-L410>)

```go
func DeregisterTaskDefinitionsForImage(ctx context.Context, ecsClient awsClient.ECSClient, image string, log *slog.Logger) error
```

DeregisterTaskDefinitionsForImage deregisters all task definition revisions for a given image. If the removed image was the default and only one image remains, that image becomes the new default.

<a name="ExtractImageFromTaskDefFamily"></a>
## func [ExtractImageFromTaskDefFamily](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/taskdef.go#L44>)

```go
func ExtractImageFromTaskDefFamily(familyName string) string
```

ExtractImageFromTaskDefFamily extracts the Docker image name from a task definition family name. Returns empty string if the family name doesn't match the expected format. NOTE: This is approximate \- images should be read from container definitions or tags, not family names.

<a name="GetDefaultImage"></a>
## func [GetDefaultImage](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/taskdef.go#L92-L96>)

```go
func GetDefaultImage(ctx context.Context, ecsClient awsClient.ECSClient, log *slog.Logger) (string, error)
```

GetDefaultImage returns the Docker image marked as default \(via IsDefault tag\). Returns empty string if no default image is found.

<a name="GetStandardECSTags"></a>
## func [GetStandardECSTags](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/tags.go#L13>)

```go
func GetStandardECSTags() []ecsTypes.Tag
```

GetStandardECSTags returns the standard tags in ECS tag format.

<a name="GetTaskDefinitionForImage"></a>
## func [GetTaskDefinitionForImage](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/taskdef.go#L144-L149>)

```go
func GetTaskDefinitionForImage(ctx context.Context, ecsClient awsClient.ECSClient, image string, log *slog.Logger) (string, error)
```

GetTaskDefinitionForImage looks up an existing task definition for the given Docker image. Returns an error if the task definition doesn't exist \(does not auto\-register\).

<a name="SanitizeImageNameForTaskDef"></a>
## func [SanitizeImageNameForTaskDef](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/taskdef.go#L25>)

```go
func SanitizeImageNameForTaskDef(image string) string
```

SanitizeImageNameForTaskDef converts a Docker image name to a valid ECS task definition family name. ECS task definition family names must match: \[a\-zA\-Z0\-9\_\-\]\+ Examples:

- "hashicorp/terraform:1.6" \-\> "hashicorp\-terraform\-1\-6"
- "myregistry.com/my\-image:latest" \-\> "myregistry\-com\-my\-image\-latest"

<a name="TaskDefinitionFamilyName"></a>
## func [TaskDefinitionFamilyName](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/taskdef.go#L36>)

```go
func TaskDefinitionFamilyName(image string) string
```

TaskDefinitionFamilyName returns the ECS task definition family name for a given image. Format: \{TaskDefinitionFamilyPrefix\}\-\{sanitized\-image\-name\}

<a name="Config"></a>
## type [Config](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/runner.go#L28-L40>)

Config holds AWS\-specific execution configuration.

```go
type Config struct {
    ECSCluster             string
    TaskDefinition         string
    Subnet1                string
    Subnet2                string
    SecurityGroup          string
    LogGroup               string
    DefaultTaskRoleARN     string
    DefaultTaskExecRoleARN string
    Region                 string
    AccountID              string
    SDKConfig              *awsStd.Config
}
```

<a name="Dependencies"></a>
## type [Dependencies](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/init.go#L29-L42>)

Dependencies bundles the AWS\-backed implementations required by the app service.

```go
type Dependencies struct {
    UserRepo             database.UserRepository
    ExecutionRepo        database.ExecutionRepository
    ConnectionRepo       database.ConnectionRepository
    TokenRepo            database.TokenRepository
    ImageRepo            database.ImageRepository
    TaskManager          contract.TaskManager
    ImageRegistry        contract.ImageRegistry
    LogManager           contract.LogManager
    ObservabilityManager contract.ObservabilityManager
    WebSocketManager     contract.WebSocketManager
    SecretsRepo          database.SecretsRepository
    HealthManager        contract.HealthManager
}
```

<a name="Initialize"></a>
### func [Initialize](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/init.go#L46-L51>)

```go
func Initialize(ctx context.Context, cfg *config.Config, log *slog.Logger, enforcer *authorization.Enforcer) (*Dependencies, error)
```

Initialize prepares AWS service dependencies for the app package. Wraps the AWS SDK clients in adapters for improved testability.

<a name="ImageReference"></a>
## type [ImageReference](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_parser.go#L14-L26>)

ImageReference represents a parsed Docker image reference.

```go
type ImageReference struct {
    // Full is the complete image reference as provided
    Full string
    // Registry is the registry hostname (empty string = Docker Hub)
    // Examples: "", "123456.dkr.ecr.us-east-1.amazonaws.com", "gcr.io"
    Registry string
    // Name is the image name (may include org/repo structure)
    // Examples: "alpine", "hashicorp/terraform", "myapp"
    Name string
    // Tag is the image tag or digest
    // Examples: "latest", "1.6", "sha256:abc123..."
    Tag string
}
```

<a name="ParseImageReference"></a>
### func [ParseImageReference](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_parser.go#L36>)

```go
func ParseImageReference(image string) ImageReference
```

ParseImageReference parses a Docker image reference into its components. Supports formats:

- alpine:latest  registry="", name="alpine", tag="latest"
- ubuntu  registry="", name="ubuntu", tag="latest"
- myorg/myapp:v1.0  registry="", name="myorg/myapp", tag="v1.0"
- 123456.dkr.ecr.us\-east\-1.amazonaws.com/myapp:v1.0  registry="123456.dkr.ecr.us\-east\-1.amazonaws.com", name="myapp", tag="v1.0"
- gcr.io/project/image:tag  registry="gcr.io", name="project/image", tag="tag"

<a name="ImageReference.IsDockerHub"></a>
### func \(ImageReference\) [IsDockerHub](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_parser.go#L106>)

```go
func (r ImageReference) IsDockerHub() bool
```

IsDockerHub returns true if the image is from Docker Hub.

<a name="ImageReference.IsECR"></a>
### func \(ImageReference\) [IsECR](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_parser.go#L111>)

```go
func (r ImageReference) IsECR() bool
```

IsECR returns true if the image is from AWS ECR.

<a name="ImageReference.NameWithTag"></a>
### func \(ImageReference\) [NameWithTag](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_parser.go#L123>)

```go
func (r ImageReference) NameWithTag() string
```

NameWithTag returns the image name with tag but without registry. Examples: "alpine:latest", "hashicorp/terraform:1.6"

<a name="ImageReference.NormalizeRegistry"></a>
### func \(ImageReference\) [NormalizeRegistry](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_parser.go#L98>)

```go
func (r ImageReference) NormalizeRegistry() string
```

NormalizeRegistry returns a normalized registry identifier. Returns "docker.io" for Docker Hub \(empty registry\), otherwise returns the registry as\-is.

<a name="ImageReference.ShortName"></a>
### func \(ImageReference\) [ShortName](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_parser.go#L117>)

```go
func (r ImageReference) ShortName() string
```

ShortName returns the image name without registry or tag. Examples: "alpine", "hashicorp/terraform", "myapp"

<a name="ImageRegistryImpl"></a>
## type [ImageRegistryImpl](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_manager.go#L28-L34>)

ImageRegistryImpl implements the ImageRegistry interface for AWS ECS and DynamoDB. It handles Docker image registration, listing, retrieval, and removal.

```go
type ImageRegistryImpl struct {
    // contains filtered or unexported fields
}
```

<a name="NewImageRegistry"></a>
### func [NewImageRegistry](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_manager.go#L37-L43>)

```go
func NewImageRegistry(ecsClient awsClient.ECSClient, iamClient awsClient.IAMClient, imageRepo ImageTaskDefRepository, cfg *Config, log *slog.Logger) *ImageRegistryImpl
```

NewImageRegistry creates a new AWS image manager.

<a name="ImageRegistryImpl.GetImage"></a>
### func \(\*ImageRegistryImpl\) [GetImage](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_manager.go#L157>)

```go
func (m *ImageRegistryImpl) GetImage(ctx context.Context, image string) (*api.ImageInfo, error)
```

GetImage retrieves a single Docker image by ID or name. Accepts either an ImageID \(e.g., "alpine:latest\-a1b2c3d4"\) or an image name \(e.g., "alpine:latest"\). If ImageID is provided, queries directly by ID. Otherwise, uses GetAnyImageTaskDef to find any configuration. If image is empty, returns the default image if one is configured.

<a name="ImageRegistryImpl.ListImages"></a>
### func \(\*ImageRegistryImpl\) [ListImages](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_manager.go#L140>)

```go
func (m *ImageRegistryImpl) ListImages(ctx context.Context) ([]api.ImageInfo, error)
```

ListImages lists all registered Docker images from DynamoDB.

<a name="ImageRegistryImpl.RegisterImage"></a>
### func \(\*ImageRegistryImpl\) [RegisterImage](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_manager.go#L57-L67>)

```go
func (m *ImageRegistryImpl) RegisterImage(ctx context.Context, image string, isDefault *bool, taskRoleName *string, taskExecutionRoleName *string, cpu *int, memory *int, runtimePlatform *string, createdBy string) error
```

RegisterImage registers a Docker image with optional custom IAM roles, CPU, Memory, and RuntimePlatform. Creates a new task definition with a unique family name and stores the mapping in DynamoDB.

<a name="ImageRegistryImpl.RemoveImage"></a>
### func \(\*ImageRegistryImpl\) [RemoveImage](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/image_manager.go#L209>)

```go
func (m *ImageRegistryImpl) RemoveImage(ctx context.Context, image string) error
```

RemoveImage removes a Docker image and all its task definition variants from DynamoDB. It also deregisters all associated task definitions from ECS. If deregistration fails for any task definition, it continues to clean up the remaining ones and still removes the mappings from DynamoDB.

NOTE: To avoid accidental deletion of multiple image configurations, this function requires the full ImageID \(e.g., "alpine:latest\-a1b2c3d4"\) instead of just the image name/tag. Use ListImages to find the specific ImageID you want to remove.

<a name="ImageTaskDefRepository"></a>
## type [ImageTaskDefRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/runner.go#L43-L73>)

ImageTaskDefRepository defines the interface for image\-taskdef mapping operations.

```go
type ImageTaskDefRepository interface {
    PutImageTaskDef(
        ctx context.Context,
        imageID string,
        image string,
        imageRegistry string,
        imageName string,
        imageTag string,
        taskRoleName, taskExecutionRoleName *string,
        cpu, memory int,
        runtimePlatform string,
        taskDefFamily string,
        isDefault bool,
        registeredBy string,
    ) error
    GetImageTaskDef(
        ctx context.Context,
        image string,
        taskRoleName, taskExecutionRoleName *string,
        cpu, memory *int,
        runtimePlatform *string,
    ) (*api.ImageInfo, error)
    GetImageTaskDefByID(ctx context.Context, imageID string) (*api.ImageInfo, error)
    GetAnyImageTaskDef(ctx context.Context, image string) (*api.ImageInfo, error)
    ListImages(ctx context.Context) ([]api.ImageInfo, error)
    GetDefaultImage(ctx context.Context) (*api.ImageInfo, error)
    UnmarkAllDefaults(ctx context.Context) error
    DeleteImage(ctx context.Context, image string) error
    SetImageAsOnlyDefault(ctx context.Context, image string, taskRoleName, taskExecutionRoleName *string) error
    GetImagesByRequestID(ctx context.Context, requestID string) ([]api.ImageInfo, error)
}
```

<a name="LambdaContextExtractor"></a>
## type [LambdaContextExtractor](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/context.go#L10>)

LambdaContextExtractor extracts request IDs from AWS Lambda contexts.

```go
type LambdaContextExtractor struct{}
```

<a name="NewLambdaContextExtractor"></a>
### func [NewLambdaContextExtractor](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/context.go#L13>)

```go
func NewLambdaContextExtractor() *LambdaContextExtractor
```

NewLambdaContextExtractor creates a new AWS Lambda context extractor.

<a name="LambdaContextExtractor.ExtractRequestID"></a>
### func \(\*LambdaContextExtractor\) [ExtractRequestID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/context.go#L18>)

```go
func (e *LambdaContextExtractor) ExtractRequestID(ctx context.Context) (string, bool)
```

ExtractRequestID extracts the AWS request ID from a Lambda context.

<a name="LogManagerImpl"></a>
## type [LogManagerImpl](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/log_manager.go#L19-L23>)

LogManagerImpl implements the LogManager interface for AWS CloudWatch Logs. It handles retrieving execution logs from CloudWatch.

```go
type LogManagerImpl struct {
    // contains filtered or unexported fields
}
```

<a name="NewLogManager"></a>
### func [NewLogManager](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/log_manager.go#L26-L30>)

```go
func NewLogManager(cwlClient awsClient.CloudWatchLogsClient, cfg *Config, log *slog.Logger) *LogManagerImpl
```

NewLogManager creates a new AWS log manager.

<a name="LogManagerImpl.FetchLogsByExecutionID"></a>
### func \(\*LogManagerImpl\) [FetchLogsByExecutionID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/log_manager.go#L39>)

```go
func (l *LogManagerImpl) FetchLogsByExecutionID(ctx context.Context, executionID string) ([]api.LogEvent, error)
```

FetchLogsByExecutionID returns CloudWatch log events for the given execution ID.

<a name="ObservabilityManagerImpl"></a>
## type [ObservabilityManagerImpl](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/observability_manager.go#L30-L38>)

ObservabilityManagerImpl implements the ObservabilityManager interface for AWS CloudWatch Logs Insights. It handles retrieving backend infrastructure logs for debugging and tracing.

```go
type ObservabilityManagerImpl struct {
    // contains filtered or unexported fields
}
```

<a name="NewObservabilityManager"></a>
### func [NewObservabilityManager](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/observability_manager.go#L41-L44>)

```go
func NewObservabilityManager(cwlClient awsClient.CloudWatchLogsClient, log *slog.Logger) *ObservabilityManagerImpl
```

NewObservabilityManager creates a new AWS observability manager.

<a name="ObservabilityManagerImpl.FetchBackendLogs"></a>
### func \(\*ObservabilityManagerImpl\) [FetchBackendLogs](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/observability_manager.go#L53>)

```go
func (o *ObservabilityManagerImpl) FetchBackendLogs(ctx context.Context, requestID string) ([]api.LogEvent, error)
```

FetchBackendLogs retrieves backend infrastructure logs using CloudWatch Logs Insights Queries logs from Lambda execution for debugging and tracing

<a name="TaskManagerImpl"></a>
## type [TaskManagerImpl](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/runner.go#L77-L82>)

TaskManagerImpl implements the TaskManager interface for AWS ECS Fargate. It handles task lifecycle management including starting and terminating tasks.

```go
type TaskManagerImpl struct {
    // contains filtered or unexported fields
}
```

<a name="NewTaskManager"></a>
### func [NewTaskManager](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/runner.go#L85-L90>)

```go
func NewTaskManager(ecsClient awsClient.ECSClient, imageRepo ImageTaskDefRepository, cfg *Config, log *slog.Logger) *TaskManagerImpl
```

NewTaskManager creates a new AWS ECS task manager.

<a name="TaskManagerImpl.KillTask"></a>
### func \(\*TaskManagerImpl\) [KillTask](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/runner.go#L399>)

```go
func (t *TaskManagerImpl) KillTask(ctx context.Context, executionID string) error
```

KillTask terminates an ECS task identified by executionID. It checks the task status before termination and only stops tasks that are RUNNING or ACTIVATING. Returns an error if the task is already terminated or not found.

<a name="TaskManagerImpl.StartTask"></a>
### func \(\*TaskManagerImpl\) [StartTask](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/orchestrator/runner.go#L100-L101>)

```go
func (t *TaskManagerImpl) StartTask(ctx context.Context, userEmail string, req *api.ExecutionRequest) (string, *time.Time, error)
```

StartTask triggers an ECS Fargate task and returns identifiers.

# aws

```go
import "runvoy/internal/providers/aws/processor"
```

Package aws provides AWS\-specific event processing implementations.

## Index

- [func ParseTime\(timeStr string\) \(time.Time, error\)](<#ParseTime>)
- [type ContainerDetail](<#ContainerDetail>)
- [type ECSTaskStateChangeEvent](<#ECSTaskStateChangeEvent>)
- [type Processor](<#Processor>)
  - [func Initialize\(ctx context.Context, cfg \*config.Config, enforcer \*authorization.Enforcer, log \*slog.Logger\) \(\*Processor, error\)](<#Initialize>)
  - [func NewProcessor\(executionRepo database.ExecutionRepository, webSocketManager contract.WebSocketManager, healthManager contract.HealthManager, log \*slog.Logger\) \*Processor](<#NewProcessor>)
  - [func \(p \*Processor\) Handle\(ctx context.Context, rawEvent \*json.RawMessage\) \(\*json.RawMessage, error\)](<#Processor.Handle>)
  - [func \(p \*Processor\) HandleEventJSON\(ctx context.Context, eventJSON \*json.RawMessage\) error](<#Processor.HandleEventJSON>)


<a name="ParseTime"></a>
## func [ParseTime](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/processor/types.go#L30>)

```go
func ParseTime(timeStr string) (time.Time, error)
```

ParseTime parses an RFC3339 timestamp string

<a name="ContainerDetail"></a>
## type [ContainerDetail](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/processor/types.go#L22-L27>)

ContainerDetail represents a container within an ECS task

```go
type ContainerDetail struct {
    ContainerArn string `json:"containerArn"`
    Name         string `json:"name"`
    ExitCode     *int   `json:"exitCode,omitempty"`
    Reason       string `json:"reason,omitempty"`
}
```

<a name="ECSTaskStateChangeEvent"></a>
## type [ECSTaskStateChangeEvent](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/processor/types.go#L7-L19>)

ECSTaskStateChangeEvent represents the detail structure of an ECS Task State Change event

```go
type ECSTaskStateChangeEvent struct {
    ClusterArn    string            `json:"clusterArn"`
    TaskArn       string            `json:"taskArn"`
    LastStatus    string            `json:"lastStatus"`
    DesiredStatus string            `json:"desiredStatus"`
    Containers    []ContainerDetail `json:"containers"`
    StartedAt     string            `json:"startedAt"`
    StoppedAt     string            `json:"stoppedAt"`
    StoppedReason string            `json:"stoppedReason"`
    StopCode      string            `json:"stopCode"`
    CPU           string            `json:"cpu"`
    Memory        string            `json:"memory"`
}
```

<a name="Processor"></a>
## type [Processor](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/processor/cloud_events.go#L18-L23>)

Processor implements the events.Processor interface for AWS. It handles CloudWatch events, CloudWatch Logs, API Gateway WebSocket events, and scheduled events.

```go
type Processor struct {
    // contains filtered or unexported fields
}
```

<a name="Initialize"></a>
### func [Initialize](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/processor/init.go#L31-L36>)

```go
func Initialize(ctx context.Context, cfg *config.Config, enforcer *authorization.Enforcer, log *slog.Logger) (*Processor, error)
```

Initialize constructs an AWS\-backed event processor with all required dependencies. Wraps the AWS SDK clients in adapters for improved testability.

<a name="NewProcessor"></a>
### func [NewProcessor](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/processor/cloud_events.go#L26-L31>)

```go
func NewProcessor(executionRepo database.ExecutionRepository, webSocketManager contract.WebSocketManager, healthManager contract.HealthManager, log *slog.Logger) *Processor
```

NewProcessor creates a new AWS event processor.

<a name="Processor.Handle"></a>
### func \(\*Processor\) [Handle](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/processor/cloud_events.go#L42>)

```go
func (p *Processor) Handle(ctx context.Context, rawEvent *json.RawMessage) (*json.RawMessage, error)
```

Handle processes a raw AWS event by delegating to the appropriate handler. It supports CloudWatch events, CloudWatch Logs, and WebSocket events.

<a name="Processor.HandleEventJSON"></a>
### func \(\*Processor\) [HandleEventJSON](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/processor/cloud_events.go#L71>)

```go
func (p *Processor) HandleEventJSON(ctx context.Context, eventJSON *json.RawMessage) error
```

HandleEventJSON is a helper for testing that accepts raw JSON and returns an error. It's used for test cases that expect error returns.

# secrets

```go
import "runvoy/internal/providers/aws/secrets"
```

Package secrets provides secret management functionality for the Runvoy orchestrator. This file contains the AWS Systems Manager Parameter Store implementation.

## Index

- [type Client](<#Client>)
- [type ClientAdapter](<#ClientAdapter>)
  - [func NewClientAdapter\(client \*ssm.Client\) \*ClientAdapter](<#NewClientAdapter>)
  - [func \(a \*ClientAdapter\) AddTagsToResource\(ctx context.Context, params \*ssm.AddTagsToResourceInput, optFns ...func\(\*ssm.Options\)\) \(\*ssm.AddTagsToResourceOutput, error\)](<#ClientAdapter.AddTagsToResource>)
  - [func \(a \*ClientAdapter\) DeleteParameter\(ctx context.Context, params \*ssm.DeleteParameterInput, optFns ...func\(\*ssm.Options\)\) \(\*ssm.DeleteParameterOutput, error\)](<#ClientAdapter.DeleteParameter>)
  - [func \(a \*ClientAdapter\) DescribeParameters\(ctx context.Context, params \*ssm.DescribeParametersInput, optFns ...func\(\*ssm.Options\)\) \(\*ssm.DescribeParametersOutput, error\)](<#ClientAdapter.DescribeParameters>)
  - [func \(a \*ClientAdapter\) GetParameter\(ctx context.Context, params \*ssm.GetParameterInput, optFns ...func\(\*ssm.Options\)\) \(\*ssm.GetParameterOutput, error\)](<#ClientAdapter.GetParameter>)
  - [func \(a \*ClientAdapter\) ListTagsForResource\(ctx context.Context, params \*ssm.ListTagsForResourceInput, optFns ...func\(\*ssm.Options\)\) \(\*ssm.ListTagsForResourceOutput, error\)](<#ClientAdapter.ListTagsForResource>)
  - [func \(a \*ClientAdapter\) PutParameter\(ctx context.Context, params \*ssm.PutParameterInput, optFns ...func\(\*ssm.Options\)\) \(\*ssm.PutParameterOutput, error\)](<#ClientAdapter.PutParameter>)
- [type ParameterStoreManager](<#ParameterStoreManager>)
  - [func NewParameterStoreManager\(client Client, secretPrefix, kmsKeyARN string, log \*slog.Logger\) \*ParameterStoreManager](<#NewParameterStoreManager>)
  - [func \(m \*ParameterStoreManager\) DeleteSecret\(ctx context.Context, name string\) error](<#ParameterStoreManager.DeleteSecret>)
  - [func \(m \*ParameterStoreManager\) RetrieveSecret\(ctx context.Context, name string\) \(string, error\)](<#ParameterStoreManager.RetrieveSecret>)
  - [func \(m \*ParameterStoreManager\) StoreSecret\(ctx context.Context, name, value string\) error](<#ParameterStoreManager.StoreSecret>)
- [type StandardTag](<#StandardTag>)
  - [func GetStandardTags\(\) \[\]StandardTag](<#GetStandardTags>)
- [type ValueStore](<#ValueStore>)


<a name="Client"></a>
## type [Client](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/client.go#L11-L42>)

Client defines the interface for SSM operations used by the ParameterStoreManager. This interface makes the code easier to test by allowing mock implementations.

```go
type Client interface {
    PutParameter(
        ctx context.Context,
        params *ssm.PutParameterInput,
        optFns ...func(*ssm.Options),
    ) (*ssm.PutParameterOutput, error)
    AddTagsToResource(
        ctx context.Context,
        params *ssm.AddTagsToResourceInput,
        optFns ...func(*ssm.Options),
    ) (*ssm.AddTagsToResourceOutput, error)
    GetParameter(
        ctx context.Context,
        params *ssm.GetParameterInput,
        optFns ...func(*ssm.Options),
    ) (*ssm.GetParameterOutput, error)
    DeleteParameter(
        ctx context.Context,
        params *ssm.DeleteParameterInput,
        optFns ...func(*ssm.Options),
    ) (*ssm.DeleteParameterOutput, error)
    ListTagsForResource(
        ctx context.Context,
        params *ssm.ListTagsForResourceInput,
        optFns ...func(*ssm.Options),
    ) (*ssm.ListTagsForResourceOutput, error)
    DescribeParameters(
        ctx context.Context,
        params *ssm.DescribeParametersInput,
        optFns ...func(*ssm.Options),
    ) (*ssm.DescribeParametersOutput, error)
}
```

<a name="ClientAdapter"></a>
## type [ClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/client.go#L46-L48>)

ClientAdapter wraps the AWS SDK SSM client to implement Client interface. This allows us to use the real AWS client in production while maintaining testability.

```go
type ClientAdapter struct {
    // contains filtered or unexported fields
}
```

<a name="NewClientAdapter"></a>
### func [NewClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/client.go#L51>)

```go
func NewClientAdapter(client *ssm.Client) *ClientAdapter
```

NewClientAdapter creates a new adapter wrapping the AWS SDK SSM client.

<a name="ClientAdapter.AddTagsToResource"></a>
### func \(\*ClientAdapter\) [AddTagsToResource](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/client.go#L65-L69>)

```go
func (a *ClientAdapter) AddTagsToResource(ctx context.Context, params *ssm.AddTagsToResourceInput, optFns ...func(*ssm.Options)) (*ssm.AddTagsToResourceOutput, error)
```

AddTagsToResource wraps the AWS SDK AddTagsToResource operation.

<a name="ClientAdapter.DeleteParameter"></a>
### func \(\*ClientAdapter\) [DeleteParameter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/client.go#L83-L87>)

```go
func (a *ClientAdapter) DeleteParameter(ctx context.Context, params *ssm.DeleteParameterInput, optFns ...func(*ssm.Options)) (*ssm.DeleteParameterOutput, error)
```

DeleteParameter wraps the AWS SDK DeleteParameter operation.

<a name="ClientAdapter.DescribeParameters"></a>
### func \(\*ClientAdapter\) [DescribeParameters](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/client.go#L101-L105>)

```go
func (a *ClientAdapter) DescribeParameters(ctx context.Context, params *ssm.DescribeParametersInput, optFns ...func(*ssm.Options)) (*ssm.DescribeParametersOutput, error)
```

DescribeParameters wraps the AWS SDK DescribeParameters operation.

<a name="ClientAdapter.GetParameter"></a>
### func \(\*ClientAdapter\) [GetParameter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/client.go#L74-L78>)

```go
func (a *ClientAdapter) GetParameter(ctx context.Context, params *ssm.GetParameterInput, optFns ...func(*ssm.Options)) (*ssm.GetParameterOutput, error)
```

GetParameter wraps the AWS SDK GetParameter operation.

<a name="ClientAdapter.ListTagsForResource"></a>
### func \(\*ClientAdapter\) [ListTagsForResource](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/client.go#L92-L96>)

```go
func (a *ClientAdapter) ListTagsForResource(ctx context.Context, params *ssm.ListTagsForResourceInput, optFns ...func(*ssm.Options)) (*ssm.ListTagsForResourceOutput, error)
```

ListTagsForResource wraps the AWS SDK ListTagsForResource operation.

<a name="ClientAdapter.PutParameter"></a>
### func \(\*ClientAdapter\) [PutParameter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/client.go#L56-L60>)

```go
func (a *ClientAdapter) PutParameter(ctx context.Context, params *ssm.PutParameterInput, optFns ...func(*ssm.Options)) (*ssm.PutParameterOutput, error)
```

PutParameter wraps the AWS SDK PutParameter operation.

<a name="ParameterStoreManager"></a>
## type [ParameterStoreManager](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/manager.go#L33-L38>)

ParameterStoreManager implements secret value storage using AWS Systems Manager Parameter Store. Secrets are stored as SecureString parameters and encrypted with KMS.

```go
type ParameterStoreManager struct {
    // contains filtered or unexported fields
}
```

<a name="NewParameterStoreManager"></a>
### func [NewParameterStoreManager](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/manager.go#L42-L46>)

```go
func NewParameterStoreManager(client Client, secretPrefix, kmsKeyARN string, log *slog.Logger) *ParameterStoreManager
```

NewParameterStoreManager creates a new Parameter Store\-based secrets manager. secretPrefix should include a leading slash, e.g., "/runvoy/secrets"

<a name="ParameterStoreManager.DeleteSecret"></a>
### func \(\*ParameterStoreManager\) [DeleteSecret](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/manager.go#L159>)

```go
func (m *ParameterStoreManager) DeleteSecret(ctx context.Context, name string) error
```

DeleteSecret removes a secret from AWS Systems Manager Parameter Store.

<a name="ParameterStoreManager.RetrieveSecret"></a>
### func \(\*ParameterStoreManager\) [RetrieveSecret](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/manager.go#L130>)

```go
func (m *ParameterStoreManager) RetrieveSecret(ctx context.Context, name string) (string, error)
```

RetrieveSecret retrieves a secret value from AWS Systems Manager Parameter Store. The value is automatically decrypted using the KMS key.

<a name="ParameterStoreManager.StoreSecret"></a>
### func \(\*ParameterStoreManager\) [StoreSecret](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/manager.go#L62>)

```go
func (m *ParameterStoreManager) StoreSecret(ctx context.Context, name, value string) error
```

StoreSecret saves a secret value to AWS Systems Manager Parameter Store as a SecureString. The value is encrypted with the KMS key specified during initialization.

<a name="StandardTag"></a>
## type [StandardTag](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/manager.go#L123-L126>)

StandardTag represents a standard AWS resource tag as key\-value pairs.

```go
type StandardTag struct {
    Key   string
    Value string
}
```

<a name="GetStandardTags"></a>
### func [GetStandardTags](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/manager.go#L109>)

```go
func GetStandardTags() []StandardTag
```

GetStandardTags returns the standard tags applied to all AWS resources managed by runvoy at runtime. These tags are used for resource identification and management tracking.

<a name="ValueStore"></a>
## type [ValueStore](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/secrets/manager.go#L20-L29>)

ValueStore is the interface for storing and retrieving encrypted secret values. Implementations handle the actual secret payloads \(e.g., in AWS Parameter Store\).

```go
type ValueStore interface {
    // StoreSecret saves a secret value and returns any error.
    StoreSecret(ctx context.Context, name, value string) error

    // RetrieveSecret gets a secret value by name.
    RetrieveSecret(ctx context.Context, name string) (string, error)

    // DeleteSecret removes a secret value by name.
    DeleteSecret(ctx context.Context, name string) error
}
```

# websocket

```go
import "runvoy/internal/providers/aws/websocket"
```

Package websocket provides AWS\-specific WebSocket management implementation for runvoy. It handles connection lifecycle events via API Gateway and manages WebSocket connections in DynamoDB.

## Index

- [type Client](<#Client>)
- [type ClientAdapter](<#ClientAdapter>)
  - [func NewClientAdapter\(client \*apigatewaymanagementapi.Client\) \*ClientAdapter](<#NewClientAdapter>)
  - [func \(a \*ClientAdapter\) PostToConnection\(ctx context.Context, params \*apigatewaymanagementapi.PostToConnectionInput, optFns ...func\(\*apigatewaymanagementapi.Options\)\) \(\*apigatewaymanagementapi.PostToConnectionOutput, error\)](<#ClientAdapter.PostToConnection>)
- [type Manager](<#Manager>)
  - [func Initialize\(cfg \*config.Config, connRepo database.ConnectionRepository, tokenRepo database.TokenRepository, log \*slog.Logger\) \*Manager](<#Initialize>)
  - [func \(m \*Manager\) GenerateWebSocketURL\(ctx context.Context, executionID string, userEmail \*string, clientIPAtCreationTime \*string\) string](<#Manager.GenerateWebSocketURL>)
  - [func \(m \*Manager\) HandleRequest\(ctx context.Context, rawEvent \*json.RawMessage, reqLogger \*slog.Logger\) \(bool, error\)](<#Manager.HandleRequest>)
  - [func \(m \*Manager\) NotifyExecutionCompletion\(ctx context.Context, executionID \*string\) error](<#Manager.NotifyExecutionCompletion>)
  - [func \(m \*Manager\) SendLogsToExecution\(ctx context.Context, executionID \*string, logEvents \[\]api.LogEvent\) error](<#Manager.SendLogsToExecution>)


<a name="Client"></a>
## type [Client](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/websocket/client.go#L11-L17>)

Client defines the interface for API Gateway Management API operations used by the Manager. This interface makes the code easier to test by allowing mock implementations.

```go
type Client interface {
    PostToConnection(
        ctx context.Context,
        params *apigatewaymanagementapi.PostToConnectionInput,
        optFns ...func(*apigatewaymanagementapi.Options),
    ) (*apigatewaymanagementapi.PostToConnectionOutput, error)
}
```

<a name="ClientAdapter"></a>
## type [ClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/websocket/client.go#L21-L23>)

ClientAdapter wraps the AWS SDK API Gateway Management API client to implement Client interface. This allows us to use the real AWS client in production while maintaining testability.

```go
type ClientAdapter struct {
    // contains filtered or unexported fields
}
```

<a name="NewClientAdapter"></a>
### func [NewClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/websocket/client.go#L26>)

```go
func NewClientAdapter(client *apigatewaymanagementapi.Client) *ClientAdapter
```

NewClientAdapter creates a new adapter wrapping the AWS SDK API Gateway Management API client.

<a name="ClientAdapter.PostToConnection"></a>
### func \(\*ClientAdapter\) [PostToConnection](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/websocket/client.go#L31-L35>)

```go
func (a *ClientAdapter) PostToConnection(ctx context.Context, params *apigatewaymanagementapi.PostToConnectionInput, optFns ...func(*apigatewaymanagementapi.Options)) (*apigatewaymanagementapi.PostToConnectionOutput, error)
```

PostToConnection wraps the AWS SDK PostToConnection operation.

<a name="Manager"></a>
## type [Manager](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/websocket/manager.go#L29-L36>)

Manager implements the websocket.Manager interface for AWS. It uses API Gateway Management API to communicate with WebSocket clients and DynamoDB to store connection metadata.

```go
type Manager struct {
    // contains filtered or unexported fields
}
```

<a name="Initialize"></a>
### func [Initialize](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/websocket/manager.go#L39-L44>)

```go
func Initialize(cfg *config.Config, connRepo database.ConnectionRepository, tokenRepo database.TokenRepository, log *slog.Logger) *Manager
```

Initialize creates a new AWS WebSocket manager.

<a name="Manager.GenerateWebSocketURL"></a>
### func \(\*Manager\) [GenerateWebSocketURL](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/websocket/manager.go#L626-L631>)

```go
func (m *Manager) GenerateWebSocketURL(ctx context.Context, executionID string, userEmail *string, clientIPAtCreationTime *string) string
```

GenerateWebSocketURL creates a WebSocket token and returns the connection URL. It stores the token for validation when the client connects.

<a name="Manager.HandleRequest"></a>
### func \(\*Manager\) [HandleRequest](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/websocket/manager.go#L85-L89>)

```go
func (m *Manager) HandleRequest(ctx context.Context, rawEvent *json.RawMessage, reqLogger *slog.Logger) (bool, error)
```

HandleRequest adapts WebSocket events so the generic event processor can route them. It attempts to unmarshal the raw Lambda event as an API Gateway WebSocket request and, when successful, dispatches based on the route key.

<a name="Manager.NotifyExecutionCompletion"></a>
### func \(\*Manager\) [NotifyExecutionCompletion](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/websocket/manager.go#L376>)

```go
func (m *Manager) NotifyExecutionCompletion(ctx context.Context, executionID *string) error
```

NotifyExecutionCompletion sends disconnect notifications to all connected clients for an execution and deletes the connections from DynamoDB.

<a name="Manager.SendLogsToExecution"></a>
### func \(\*Manager\) [SendLogsToExecution](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/websocket/manager.go#L411-L415>)

```go
func (m *Manager) SendLogsToExecution(ctx context.Context, executionID *string, logEvents []api.LogEvent) error
```

SendLogsToExecution sends log events to all connected clients for an execution. Each log event is sent individually to all connected clients concurrently.

# orchestrator

```go
import "runvoy/cmd/backend/providers/aws/orchestrator"
```

Package main implements the AWS Lambda orchestrator for runvoy. It handles API requests and orchestrates ECS task executions.

## Index



# processor

```go
import "runvoy/cmd/backend/providers/aws/processor"
```

Package main implements the AWS Lambda event processor for runvoy. It processes various AWS Lambda events including CloudWatch events related to ECS task completions and API Gateway WebSocket events.

## Index



# dynamodb

```go
import "runvoy/internal/providers/aws/database/dynamodb"
```

Package dynamodb implements DynamoDB\-based storage for runvoy. It provides persistence for execution records using AWS DynamoDB.

Package dynamodb implements DynamoDB\-based storage for runvoy. It provides persistence for image\-taskdef mappings using AWS DynamoDB.

## Index

- [func GenerateImageID\(imageName, imageTag string, cpu, memory int, runtimePlatform string, taskRoleName, taskExecutionRoleName \*string\) string](<#GenerateImageID>)
- [func NewConnectionRepository\(client Client, tableName string, log \*slog.Logger\) database.ConnectionRepository](<#NewConnectionRepository>)
- [func NewTokenRepository\(client Client, tableName string, log \*slog.Logger\) database.TokenRepository](<#NewTokenRepository>)
- [type Client](<#Client>)
- [type ClientAdapter](<#ClientAdapter>)
  - [func NewClientAdapter\(client \*dynamodb.Client\) \*ClientAdapter](<#NewClientAdapter>)
  - [func \(a \*ClientAdapter\) BatchWriteItem\(ctx context.Context, params \*dynamodb.BatchWriteItemInput, optFns ...func\(\*dynamodb.Options\)\) \(\*dynamodb.BatchWriteItemOutput, error\)](<#ClientAdapter.BatchWriteItem>)
  - [func \(a \*ClientAdapter\) DeleteItem\(ctx context.Context, params \*dynamodb.DeleteItemInput, optFns ...func\(\*dynamodb.Options\)\) \(\*dynamodb.DeleteItemOutput, error\)](<#ClientAdapter.DeleteItem>)
  - [func \(a \*ClientAdapter\) GetItem\(ctx context.Context, params \*dynamodb.GetItemInput, optFns ...func\(\*dynamodb.Options\)\) \(\*dynamodb.GetItemOutput, error\)](<#ClientAdapter.GetItem>)
  - [func \(a \*ClientAdapter\) PutItem\(ctx context.Context, params \*dynamodb.PutItemInput, optFns ...func\(\*dynamodb.Options\)\) \(\*dynamodb.PutItemOutput, error\)](<#ClientAdapter.PutItem>)
  - [func \(a \*ClientAdapter\) Query\(ctx context.Context, params \*dynamodb.QueryInput, optFns ...func\(\*dynamodb.Options\)\) \(\*dynamodb.QueryOutput, error\)](<#ClientAdapter.Query>)
  - [func \(a \*ClientAdapter\) Scan\(ctx context.Context, params \*dynamodb.ScanInput, optFns ...func\(\*dynamodb.Options\)\) \(\*dynamodb.ScanOutput, error\)](<#ClientAdapter.Scan>)
  - [func \(a \*ClientAdapter\) UpdateItem\(ctx context.Context, params \*dynamodb.UpdateItemInput, optFns ...func\(\*dynamodb.Options\)\) \(\*dynamodb.UpdateItemOutput, error\)](<#ClientAdapter.UpdateItem>)
- [type ConnectionRepository](<#ConnectionRepository>)
  - [func \(r \*ConnectionRepository\) CreateConnection\(ctx context.Context, connection \*api.WebSocketConnection\) error](<#ConnectionRepository.CreateConnection>)
  - [func \(r \*ConnectionRepository\) DeleteConnections\(ctx context.Context, connectionIDs \[\]string\) \(int, error\)](<#ConnectionRepository.DeleteConnections>)
  - [func \(r \*ConnectionRepository\) GetConnectionsByExecutionID\(ctx context.Context, executionID string\) \(\[\]\*api.WebSocketConnection, error\)](<#ConnectionRepository.GetConnectionsByExecutionID>)
- [type ExecutionRepository](<#ExecutionRepository>)
  - [func NewExecutionRepository\(client Client, tableName string, log \*slog.Logger\) \*ExecutionRepository](<#NewExecutionRepository>)
  - [func \(r \*ExecutionRepository\) CreateExecution\(ctx context.Context, execution \*api.Execution\) error](<#ExecutionRepository.CreateExecution>)
  - [func \(r \*ExecutionRepository\) GetExecution\(ctx context.Context, executionID string\) \(\*api.Execution, error\)](<#ExecutionRepository.GetExecution>)
  - [func \(r \*ExecutionRepository\) GetExecutionsByRequestID\(ctx context.Context, requestID string\) \(\[\]\*api.Execution, error\)](<#ExecutionRepository.GetExecutionsByRequestID>)
  - [func \(r \*ExecutionRepository\) ListExecutions\(ctx context.Context, limit int, statuses \[\]string\) \(\[\]\*api.Execution, error\)](<#ExecutionRepository.ListExecutions>)
  - [func \(r \*ExecutionRepository\) UpdateExecution\(ctx context.Context, execution \*api.Execution\) error](<#ExecutionRepository.UpdateExecution>)
- [type ImageTaskDefRepository](<#ImageTaskDefRepository>)
  - [func NewImageTaskDefRepository\(client Client, tableName string, log \*slog.Logger\) \*ImageTaskDefRepository](<#NewImageTaskDefRepository>)
  - [func \(r \*ImageTaskDefRepository\) DeleteImage\(ctx context.Context, image string\) error](<#ImageTaskDefRepository.DeleteImage>)
  - [func \(r \*ImageTaskDefRepository\) GetAnyImageTaskDef\(ctx context.Context, image string\) \(\*api.ImageInfo, error\)](<#ImageTaskDefRepository.GetAnyImageTaskDef>)
  - [func \(r \*ImageTaskDefRepository\) GetDefaultImage\(ctx context.Context\) \(\*api.ImageInfo, error\)](<#ImageTaskDefRepository.GetDefaultImage>)
  - [func \(r \*ImageTaskDefRepository\) GetImageTaskDef\(ctx context.Context, image string, taskRoleName \*string, taskExecutionRoleName \*string, cpu \*int, memory \*int, runtimePlatform \*string\) \(\*api.ImageInfo, error\)](<#ImageTaskDefRepository.GetImageTaskDef>)
  - [func \(r \*ImageTaskDefRepository\) GetImageTaskDefByID\(ctx context.Context, imageID string\) \(\*api.ImageInfo, error\)](<#ImageTaskDefRepository.GetImageTaskDefByID>)
  - [func \(r \*ImageTaskDefRepository\) GetImagesByRequestID\(ctx context.Context, requestID string\) \(\[\]api.ImageInfo, error\)](<#ImageTaskDefRepository.GetImagesByRequestID>)
  - [func \(r \*ImageTaskDefRepository\) GetImagesCount\(ctx context.Context\) \(int, error\)](<#ImageTaskDefRepository.GetImagesCount>)
  - [func \(r \*ImageTaskDefRepository\) GetUniqueImages\(ctx context.Context\) \(\[\]string, error\)](<#ImageTaskDefRepository.GetUniqueImages>)
  - [func \(r \*ImageTaskDefRepository\) ListImages\(ctx context.Context\) \(\[\]api.ImageInfo, error\)](<#ImageTaskDefRepository.ListImages>)
  - [func \(r \*ImageTaskDefRepository\) PutImageTaskDef\(ctx context.Context, imageID string, image string, imageRegistry string, imageName string, imageTag string, taskRoleName \*string, taskExecutionRoleName \*string, cpu int, memory int, runtimePlatform string, taskDefFamily string, isDefault bool, createdBy string\) error](<#ImageTaskDefRepository.PutImageTaskDef>)
  - [func \(r \*ImageTaskDefRepository\) SetImageAsOnlyDefault\(ctx context.Context, image string, taskRoleName \*string, taskExecutionRoleName \*string\) error](<#ImageTaskDefRepository.SetImageAsOnlyDefault>)
  - [func \(r \*ImageTaskDefRepository\) UnmarkAllDefaults\(ctx context.Context\) error](<#ImageTaskDefRepository.UnmarkAllDefaults>)
- [type MockDynamoDBClient](<#MockDynamoDBClient>)
  - [func NewMockDynamoDBClient\(\) \*MockDynamoDBClient](<#NewMockDynamoDBClient>)
  - [func \(m \*MockDynamoDBClient\) BatchWriteItem\(\_ context.Context, params \*dynamodb.BatchWriteItemInput, \_ ...func\(\*dynamodb.Options\)\) \(\*dynamodb.BatchWriteItemOutput, error\)](<#MockDynamoDBClient.BatchWriteItem>)
  - [func \(m \*MockDynamoDBClient\) ClearTables\(\)](<#MockDynamoDBClient.ClearTables>)
  - [func \(m \*MockDynamoDBClient\) DeleteItem\(\_ context.Context, params \*dynamodb.DeleteItemInput, \_ ...func\(\*dynamodb.Options\)\) \(\*dynamodb.DeleteItemOutput, error\)](<#MockDynamoDBClient.DeleteItem>)
  - [func \(m \*MockDynamoDBClient\) GetItem\(\_ context.Context, params \*dynamodb.GetItemInput, \_ ...func\(\*dynamodb.Options\)\) \(\*dynamodb.GetItemOutput, error\)](<#MockDynamoDBClient.GetItem>)
  - [func \(m \*MockDynamoDBClient\) PutItem\(\_ context.Context, params \*dynamodb.PutItemInput, \_ ...func\(\*dynamodb.Options\)\) \(\*dynamodb.PutItemOutput, error\)](<#MockDynamoDBClient.PutItem>)
  - [func \(m \*MockDynamoDBClient\) Query\(\_ context.Context, params \*dynamodb.QueryInput, \_ ...func\(\*dynamodb.Options\)\) \(\*dynamodb.QueryOutput, error\)](<#MockDynamoDBClient.Query>)
  - [func \(m \*MockDynamoDBClient\) ResetCallCounts\(\)](<#MockDynamoDBClient.ResetCallCounts>)
  - [func \(m \*MockDynamoDBClient\) Scan\(\_ context.Context, params \*dynamodb.ScanInput, \_ ...func\(\*dynamodb.Options\)\) \(\*dynamodb.ScanOutput, error\)](<#MockDynamoDBClient.Scan>)
  - [func \(m \*MockDynamoDBClient\) UpdateItem\(\_ context.Context, params \*dynamodb.UpdateItemInput, \_ ...func\(\*dynamodb.Options\)\) \(\*dynamodb.UpdateItemOutput, error\)](<#MockDynamoDBClient.UpdateItem>)
- [type SecretsRepository](<#SecretsRepository>)
  - [func NewSecretsRepository\(client Client, tableName string, log \*slog.Logger\) \*SecretsRepository](<#NewSecretsRepository>)
  - [func \(r \*SecretsRepository\) CreateSecret\(ctx context.Context, secret \*api.Secret\) error](<#SecretsRepository.CreateSecret>)
  - [func \(r \*SecretsRepository\) DeleteSecret\(ctx context.Context, name string\) error](<#SecretsRepository.DeleteSecret>)
  - [func \(r \*SecretsRepository\) GetSecret\(ctx context.Context, name string\) \(\*api.Secret, error\)](<#SecretsRepository.GetSecret>)
  - [func \(r \*SecretsRepository\) GetSecretsByRequestID\(ctx context.Context, requestID string\) \(\[\]\*api.Secret, error\)](<#SecretsRepository.GetSecretsByRequestID>)
  - [func \(r \*SecretsRepository\) ListSecrets\(ctx context.Context\) \(\[\]\*api.Secret, error\)](<#SecretsRepository.ListSecrets>)
  - [func \(r \*SecretsRepository\) SecretExists\(ctx context.Context, name string\) \(bool, error\)](<#SecretsRepository.SecretExists>)
  - [func \(r \*SecretsRepository\) UpdateSecretMetadata\(ctx context.Context, name, keyName, description, updatedBy string\) error](<#SecretsRepository.UpdateSecretMetadata>)
- [type TokenRepository](<#TokenRepository>)
  - [func \(r \*TokenRepository\) CreateToken\(ctx context.Context, token \*api.WebSocketToken\) error](<#TokenRepository.CreateToken>)
  - [func \(r \*TokenRepository\) DeleteToken\(ctx context.Context, tokenValue string\) error](<#TokenRepository.DeleteToken>)
  - [func \(r \*TokenRepository\) GetToken\(ctx context.Context, tokenValue string\) \(\*api.WebSocketToken, error\)](<#TokenRepository.GetToken>)
- [type UserRepository](<#UserRepository>)
  - [func NewUserRepository\(client Client, tableName string, pendingTableName string, log \*slog.Logger\) \*UserRepository](<#NewUserRepository>)
  - [func \(r \*UserRepository\) CreatePendingAPIKey\(ctx context.Context, pending \*api.PendingAPIKey\) error](<#UserRepository.CreatePendingAPIKey>)
  - [func \(r \*UserRepository\) CreateUser\(ctx context.Context, user \*api.User, apiKeyHash string, expiresAtUnix int64\) error](<#UserRepository.CreateUser>)
  - [func \(r \*UserRepository\) DeletePendingAPIKey\(ctx context.Context, secretToken string\) error](<#UserRepository.DeletePendingAPIKey>)
  - [func \(r \*UserRepository\) GetPendingAPIKey\(ctx context.Context, secretToken string\) \(\*api.PendingAPIKey, error\)](<#UserRepository.GetPendingAPIKey>)
  - [func \(r \*UserRepository\) GetUserByAPIKeyHash\(ctx context.Context, apiKeyHash string\) \(\*api.User, error\)](<#UserRepository.GetUserByAPIKeyHash>)
  - [func \(r \*UserRepository\) GetUserByEmail\(ctx context.Context, email string\) \(\*api.User, error\)](<#UserRepository.GetUserByEmail>)
  - [func \(r \*UserRepository\) GetUsersByRequestID\(ctx context.Context, requestID string\) \(\[\]\*api.User, error\)](<#UserRepository.GetUsersByRequestID>)
  - [func \(r \*UserRepository\) ListUsers\(ctx context.Context\) \(\[\]\*api.User, error\)](<#UserRepository.ListUsers>)
  - [func \(r \*UserRepository\) MarkAsViewed\(ctx context.Context, secretToken, ipAddress string\) error](<#UserRepository.MarkAsViewed>)
  - [func \(r \*UserRepository\) RemoveExpiration\(ctx context.Context, email string\) error](<#UserRepository.RemoveExpiration>)
  - [func \(r \*UserRepository\) RevokeUser\(ctx context.Context, email string\) error](<#UserRepository.RevokeUser>)
  - [func \(r \*UserRepository\) UpdateLastUsed\(ctx context.Context, email string\) \(\*time.Time, error\)](<#UserRepository.UpdateLastUsed>)


<a name="GenerateImageID"></a>
## func [GenerateImageID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L79-L84>)

```go
func GenerateImageID(imageName, imageTag string, cpu, memory int, runtimePlatform string, taskRoleName, taskExecutionRoleName *string) string
```

GenerateImageID generates a unique, human\-readable ID for an image configuration. Format: \{imageName\}:\{tag\}\-\{first\-8\-chars\-of\-hash\} Example: alpine:latest\-a1b2c3d4 or golang:1.24.5\-bookworm\-19884ca2

<a name="NewConnectionRepository"></a>
## func [NewConnectionRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/connections.go#L27-L31>)

```go
func NewConnectionRepository(client Client, tableName string, log *slog.Logger) database.ConnectionRepository
```

NewConnectionRepository creates a new DynamoDB\-backed connection repository.

<a name="NewTokenRepository"></a>
## func [NewTokenRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/tokens.go#L27-L31>)

```go
func NewTokenRepository(client Client, tableName string, log *slog.Logger) database.TokenRepository
```

NewTokenRepository creates a new DynamoDB\-backed token repository.

<a name="Client"></a>
## type [Client](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/client.go#L11-L47>)

Client defines the interface for DynamoDB operations used by repositories. This interface makes repositories easier to test by allowing mock implementations.

```go
type Client interface {
    PutItem(
        ctx context.Context,
        params *dynamodb.PutItemInput,
        optFns ...func(*dynamodb.Options),
    ) (*dynamodb.PutItemOutput, error)
    GetItem(
        ctx context.Context,
        params *dynamodb.GetItemInput,
        optFns ...func(*dynamodb.Options),
    ) (*dynamodb.GetItemOutput, error)
    Query(
        ctx context.Context,
        params *dynamodb.QueryInput,
        optFns ...func(*dynamodb.Options),
    ) (*dynamodb.QueryOutput, error)
    UpdateItem(
        ctx context.Context,
        params *dynamodb.UpdateItemInput,
        optFns ...func(*dynamodb.Options),
    ) (*dynamodb.UpdateItemOutput, error)
    DeleteItem(
        ctx context.Context,
        params *dynamodb.DeleteItemInput,
        optFns ...func(*dynamodb.Options),
    ) (*dynamodb.DeleteItemOutput, error)
    BatchWriteItem(
        ctx context.Context,
        params *dynamodb.BatchWriteItemInput,
        optFns ...func(*dynamodb.Options),
    ) (*dynamodb.BatchWriteItemOutput, error)
    Scan(
        ctx context.Context,
        params *dynamodb.ScanInput,
        optFns ...func(*dynamodb.Options),
    ) (*dynamodb.ScanOutput, error)
}
```

<a name="ClientAdapter"></a>
## type [ClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/client.go#L51-L53>)

ClientAdapter wraps the AWS SDK DynamoDB client to implement Client interface. This allows us to use the real AWS client in production while maintaining testability.

```go
type ClientAdapter struct {
    // contains filtered or unexported fields
}
```

<a name="NewClientAdapter"></a>
### func [NewClientAdapter](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/client.go#L56>)

```go
func NewClientAdapter(client *dynamodb.Client) *ClientAdapter
```

NewClientAdapter creates a new adapter wrapping the AWS SDK DynamoDB client.

<a name="ClientAdapter.BatchWriteItem"></a>
### func \(\*ClientAdapter\) [BatchWriteItem](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/client.go#L106-L110>)

```go
func (a *ClientAdapter) BatchWriteItem(ctx context.Context, params *dynamodb.BatchWriteItemInput, optFns ...func(*dynamodb.Options)) (*dynamodb.BatchWriteItemOutput, error)
```

BatchWriteItem wraps the AWS SDK BatchWriteItem operation.

<a name="ClientAdapter.DeleteItem"></a>
### func \(\*ClientAdapter\) [DeleteItem](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/client.go#L97-L101>)

```go
func (a *ClientAdapter) DeleteItem(ctx context.Context, params *dynamodb.DeleteItemInput, optFns ...func(*dynamodb.Options)) (*dynamodb.DeleteItemOutput, error)
```

DeleteItem wraps the AWS SDK DeleteItem operation.

<a name="ClientAdapter.GetItem"></a>
### func \(\*ClientAdapter\) [GetItem](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/client.go#L70-L74>)

```go
func (a *ClientAdapter) GetItem(ctx context.Context, params *dynamodb.GetItemInput, optFns ...func(*dynamodb.Options)) (*dynamodb.GetItemOutput, error)
```

GetItem wraps the AWS SDK GetItem operation.

<a name="ClientAdapter.PutItem"></a>
### func \(\*ClientAdapter\) [PutItem](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/client.go#L61-L65>)

```go
func (a *ClientAdapter) PutItem(ctx context.Context, params *dynamodb.PutItemInput, optFns ...func(*dynamodb.Options)) (*dynamodb.PutItemOutput, error)
```

PutItem wraps the AWS SDK PutItem operation.

<a name="ClientAdapter.Query"></a>
### func \(\*ClientAdapter\) [Query](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/client.go#L79-L83>)

```go
func (a *ClientAdapter) Query(ctx context.Context, params *dynamodb.QueryInput, optFns ...func(*dynamodb.Options)) (*dynamodb.QueryOutput, error)
```

Query wraps the AWS SDK Query operation.

<a name="ClientAdapter.Scan"></a>
### func \(\*ClientAdapter\) [Scan](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/client.go#L115-L119>)

```go
func (a *ClientAdapter) Scan(ctx context.Context, params *dynamodb.ScanInput, optFns ...func(*dynamodb.Options)) (*dynamodb.ScanOutput, error)
```

Scan wraps the AWS SDK Scan operation.

<a name="ClientAdapter.UpdateItem"></a>
### func \(\*ClientAdapter\) [UpdateItem](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/client.go#L88-L92>)

```go
func (a *ClientAdapter) UpdateItem(ctx context.Context, params *dynamodb.UpdateItemInput, optFns ...func(*dynamodb.Options)) (*dynamodb.UpdateItemOutput, error)
```

UpdateItem wraps the AWS SDK UpdateItem operation.

<a name="ConnectionRepository"></a>
## type [ConnectionRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/connections.go#L20-L24>)

ConnectionRepository implements the database.ConnectionRepository interface using DynamoDB.

```go
type ConnectionRepository struct {
    // contains filtered or unexported fields
}
```

<a name="ConnectionRepository.CreateConnection"></a>
### func \(\*ConnectionRepository\) [CreateConnection](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/connections.go#L67-L70>)

```go
func (r *ConnectionRepository) CreateConnection(ctx context.Context, connection *api.WebSocketConnection) error
```

CreateConnection stores a new WebSocket connection record in DynamoDB.

<a name="ConnectionRepository.DeleteConnections"></a>
### func \(\*ConnectionRepository\) [DeleteConnections](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/connections.go#L107>)

```go
func (r *ConnectionRepository) DeleteConnections(ctx context.Context, connectionIDs []string) (int, error)
```

DeleteConnections removes WebSocket connections from DynamoDB by connection IDs using batch delete.

<a name="ConnectionRepository.GetConnectionsByExecutionID"></a>
### func \(\*ConnectionRepository\) [GetConnectionsByExecutionID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/connections.go#L144-L147>)

```go
func (r *ConnectionRepository) GetConnectionsByExecutionID(ctx context.Context, executionID string) ([]*api.WebSocketConnection, error)
```

GetConnectionsByExecutionID retrieves all active WebSocket connection records for a given execution ID using the execution\_id\-index GSI.

<a name="ExecutionRepository"></a>
## type [ExecutionRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/executions.go#L32-L36>)

ExecutionRepository implements the database.ExecutionRepository interface using DynamoDB.

```go
type ExecutionRepository struct {
    // contains filtered or unexported fields
}
```

<a name="NewExecutionRepository"></a>
### func [NewExecutionRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/executions.go#L39>)

```go
func NewExecutionRepository(client Client, tableName string, log *slog.Logger) *ExecutionRepository
```

NewExecutionRepository creates a new DynamoDB\-backed execution repository.

<a name="ExecutionRepository.CreateExecution"></a>
### func \(\*ExecutionRepository\) [CreateExecution](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/executions.go#L114>)

```go
func (r *ExecutionRepository) CreateExecution(ctx context.Context, execution *api.Execution) error
```

CreateExecution stores a new execution record in DynamoDB.

<a name="ExecutionRepository.GetExecution"></a>
### func \(\*ExecutionRepository\) [GetExecution](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/executions.go#L159>)

```go
func (r *ExecutionRepository) GetExecution(ctx context.Context, executionID string) (*api.Execution, error)
```

GetExecution retrieves an execution by its execution ID.

<a name="ExecutionRepository.GetExecutionsByRequestID"></a>
### func \(\*ExecutionRepository\) [GetExecutionsByRequestID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/executions.go#L505-L507>)

```go
func (r *ExecutionRepository) GetExecutionsByRequestID(ctx context.Context, requestID string) ([]*api.Execution, error)
```

GetExecutionsByRequestID retrieves all executions created or modified by a specific request ID. This uses Query operations on two GSIs \(created\_by\_request\_id\-index and modified\_by\_request\_id\-index\) instead of Scan for better performance.

<a name="ExecutionRepository.ListExecutions"></a>
### func \(\*ExecutionRepository\) [ListExecutions](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/executions.go#L385-L389>)

```go
func (r *ExecutionRepository) ListExecutions(ctx context.Context, limit int, statuses []string) ([]*api.Execution, error)
```

ListExecutions queries the executions table using the all\-started\_at GSI to return execution records sorted by StartedAt descending \(newest first\). This uses Query instead of Scan for better performance and native sorting by DynamoDB. Status filtering and limiting are handled natively by DynamoDB using FilterExpression and Limit.

Parameters:

- limit: maximum number of executions to return. Use 0 to return all executions.
- statuses: optional slice of execution statuses to filter by. If empty, all executions are returned.

<a name="ExecutionRepository.UpdateExecution"></a>
### func \(\*ExecutionRepository\) [UpdateExecution](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/executions.go#L235>)

```go
func (r *ExecutionRepository) UpdateExecution(ctx context.Context, execution *api.Execution) error
```

UpdateExecution updates an existing execution record.

<a name="ImageTaskDefRepository"></a>
## type [ImageTaskDefRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L29-L33>)

ImageTaskDefRepository implements image\-taskdef mapping operations using DynamoDB.

```go
type ImageTaskDefRepository struct {
    // contains filtered or unexported fields
}
```

<a name="NewImageTaskDefRepository"></a>
### func [NewImageTaskDefRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L36>)

```go
func NewImageTaskDefRepository(client Client, tableName string, log *slog.Logger) *ImageTaskDefRepository
```

NewImageTaskDefRepository creates a new DynamoDB\-backed image\-taskdef repository.

<a name="ImageTaskDefRepository.DeleteImage"></a>
### func \(\*ImageTaskDefRepository\) [DeleteImage](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L700>)

```go
func (r *ImageTaskDefRepository) DeleteImage(ctx context.Context, image string) error
```

DeleteImage removes all task definition mappings for a specific image. Supports exact matching on both the image field and image\_id field \(for ImageID format\). Returns ErrNotFound if no matching images are found.

<a name="ImageTaskDefRepository.GetAnyImageTaskDef"></a>
### func \(\*ImageTaskDefRepository\) [GetAnyImageTaskDef](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L758>)

```go
func (r *ImageTaskDefRepository) GetAnyImageTaskDef(ctx context.Context, image string) (*api.ImageInfo, error)
```

GetAnyImageTaskDef retrieves any task definition configuration for a given image. Supports flexible matching: tries exact match on full image first, then matches by name:tag components. Returns the first matching item, preferring the default configuration if available.

<a name="ImageTaskDefRepository.GetDefaultImage"></a>
### func \(\*ImageTaskDefRepository\) [GetDefaultImage](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L518>)

```go
func (r *ImageTaskDefRepository) GetDefaultImage(ctx context.Context) (*api.ImageInfo, error)
```

GetDefaultImage retrieves the image marked as default.

<a name="ImageTaskDefRepository.GetImageTaskDef"></a>
### func \(\*ImageTaskDefRepository\) [GetImageTaskDef](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L297-L305>)

```go
func (r *ImageTaskDefRepository) GetImageTaskDef(ctx context.Context, image string, taskRoleName *string, taskExecutionRoleName *string, cpu *int, memory *int, runtimePlatform *string) (*api.ImageInfo, error)
```

GetImageTaskDef retrieves a specific image\-taskdef mapping by generating ImageID from the configuration.

<a name="ImageTaskDefRepository.GetImageTaskDefByID"></a>
### func \(\*ImageTaskDefRepository\) [GetImageTaskDefByID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L369>)

```go
func (r *ImageTaskDefRepository) GetImageTaskDefByID(ctx context.Context, imageID string) (*api.ImageInfo, error)
```

GetImageTaskDefByID retrieves an image\-taskdef mapping by ImageID.

<a name="ImageTaskDefRepository.GetImagesByRequestID"></a>
### func \(\*ImageTaskDefRepository\) [GetImagesByRequestID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L441>)

```go
func (r *ImageTaskDefRepository) GetImagesByRequestID(ctx context.Context, requestID string) ([]api.ImageInfo, error)
```

GetImagesByRequestID retrieves all images created or modified by a specific request ID.

<a name="ImageTaskDefRepository.GetImagesCount"></a>
### func \(\*ImageTaskDefRepository\) [GetImagesCount](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L828>)

```go
func (r *ImageTaskDefRepository) GetImagesCount(ctx context.Context) (int, error)
```

GetImagesCount returns the total number of unique image\+role combinations.

<a name="ImageTaskDefRepository.GetUniqueImages"></a>
### func \(\*ImageTaskDefRepository\) [GetUniqueImages](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L851>)

```go
func (r *ImageTaskDefRepository) GetUniqueImages(ctx context.Context) ([]string, error)
```

GetUniqueImages returns a list of unique image names \(deduplicated across role combinations\).

<a name="ImageTaskDefRepository.ListImages"></a>
### func \(\*ImageTaskDefRepository\) [ListImages](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L403>)

```go
func (r *ImageTaskDefRepository) ListImages(ctx context.Context) ([]api.ImageInfo, error)
```

ListImages retrieves all registered images with their task definitions.

<a name="ImageTaskDefRepository.PutImageTaskDef"></a>
### func \(\*ImageTaskDefRepository\) [PutImageTaskDef](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L107-L122>)

```go
func (r *ImageTaskDefRepository) PutImageTaskDef(ctx context.Context, imageID string, image string, imageRegistry string, imageName string, imageTag string, taskRoleName *string, taskExecutionRoleName *string, cpu int, memory int, runtimePlatform string, taskDefFamily string, isDefault bool, createdBy string) error
```

PutImageTaskDef stores or updates an image\-taskdef mapping.

<a name="ImageTaskDefRepository.SetImageAsOnlyDefault"></a>
### func \(\*ImageTaskDefRepository\) [SetImageAsOnlyDefault](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L874-L879>)

```go
func (r *ImageTaskDefRepository) SetImageAsOnlyDefault(ctx context.Context, image string, taskRoleName *string, taskExecutionRoleName *string) error
```

SetImageAsOnlyDefault marks a specific image configuration as the only default. It first unmarks all other defaults, then sets this one as default.

<a name="ImageTaskDefRepository.UnmarkAllDefaults"></a>
### func \(\*ImageTaskDefRepository\) [UnmarkAllDefaults](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/images.go#L555>)

```go
func (r *ImageTaskDefRepository) UnmarkAllDefaults(ctx context.Context) error
```

UnmarkAllDefaults removes the default flag from all images.

<a name="MockDynamoDBClient"></a>
## type [MockDynamoDBClient](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L17-L48>)

MockDynamoDBClient is a simple in\-memory mock implementation of Client for testing. It provides basic support for Put, Get, Query, Update, Delete, and BatchWrite operations.

```go
type MockDynamoDBClient struct {

    // Tables maps table name -> partition key -> sort key -> item
    // For tables without sort key, use empty string as sort key
    Tables map[string]map[string]map[string]map[string]types.AttributeValue

    // Index stores items by index name for Query operations
    // Format: tableName -> indexName -> keyValue -> list of items
    Indexes map[string]map[string]map[string][]map[string]types.AttributeValue

    // Error injection for testing error scenarios
    PutItemError        error
    GetItemError        error
    QueryError          error
    UpdateItemError     error
    DeleteItemError     error
    BatchWriteItemError error
    ScanError           error

    // Call tracking for test assertions
    PutItemCalls        int
    GetItemCalls        int
    QueryCalls          int
    UpdateItemCalls     int
    DeleteItemCalls     int
    BatchWriteItemCalls int
    ScanCalls           int
    // contains filtered or unexported fields
}
```

<a name="NewMockDynamoDBClient"></a>
### func [NewMockDynamoDBClient](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L51>)

```go
func NewMockDynamoDBClient() *MockDynamoDBClient
```

NewMockDynamoDBClient creates a new mock DynamoDB client for testing.

<a name="MockDynamoDBClient.BatchWriteItem"></a>
### func \(\*MockDynamoDBClient\) [BatchWriteItem](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L306-L310>)

```go
func (m *MockDynamoDBClient) BatchWriteItem(_ context.Context, params *dynamodb.BatchWriteItemInput, _ ...func(*dynamodb.Options)) (*dynamodb.BatchWriteItemOutput, error)
```

BatchWriteItem performs batch write operations.

<a name="MockDynamoDBClient.ClearTables"></a>
### func \(\*MockDynamoDBClient\) [ClearTables](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L390>)

```go
func (m *MockDynamoDBClient) ClearTables()
```

ClearTables removes all data from the mock tables.

<a name="MockDynamoDBClient.DeleteItem"></a>
### func \(\*MockDynamoDBClient\) [DeleteItem](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L267-L271>)

```go
func (m *MockDynamoDBClient) DeleteItem(_ context.Context, params *dynamodb.DeleteItemInput, _ ...func(*dynamodb.Options)) (*dynamodb.DeleteItemOutput, error)
```

DeleteItem removes an item from the mock table.

<a name="MockDynamoDBClient.GetItem"></a>
### func \(\*MockDynamoDBClient\) [GetItem](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L137-L141>)

```go
func (m *MockDynamoDBClient) GetItem(_ context.Context, params *dynamodb.GetItemInput, _ ...func(*dynamodb.Options)) (*dynamodb.GetItemOutput, error)
```

GetItem retrieves an item from the mock table.

<a name="MockDynamoDBClient.PutItem"></a>
### func \(\*MockDynamoDBClient\) [PutItem](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L69-L73>)

```go
func (m *MockDynamoDBClient) PutItem(_ context.Context, params *dynamodb.PutItemInput, _ ...func(*dynamodb.Options)) (*dynamodb.PutItemOutput, error)
```

PutItem stores an item in the mock table.

<a name="MockDynamoDBClient.Query"></a>
### func \(\*MockDynamoDBClient\) [Query](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L171-L175>)

```go
func (m *MockDynamoDBClient) Query(_ context.Context, params *dynamodb.QueryInput, _ ...func(*dynamodb.Options)) (*dynamodb.QueryOutput, error)
```

Query searches for items in the mock table.

<a name="MockDynamoDBClient.ResetCallCounts"></a>
### func \(\*MockDynamoDBClient\) [ResetCallCounts](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L376>)

```go
func (m *MockDynamoDBClient) ResetCallCounts()
```

ResetCallCounts resets all call counters to zero.

<a name="MockDynamoDBClient.Scan"></a>
### func \(\*MockDynamoDBClient\) [Scan](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L351-L355>)

```go
func (m *MockDynamoDBClient) Scan(_ context.Context, params *dynamodb.ScanInput, _ ...func(*dynamodb.Options)) (*dynamodb.ScanOutput, error)
```

Scan scans all items in the mock table.

<a name="MockDynamoDBClient.UpdateItem"></a>
### func \(\*MockDynamoDBClient\) [UpdateItem](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/mock_client.go#L228-L232>)

```go
func (m *MockDynamoDBClient) UpdateItem(_ context.Context, params *dynamodb.UpdateItemInput, _ ...func(*dynamodb.Options)) (*dynamodb.UpdateItemOutput, error)
```

UpdateItem updates an item in the mock table.

<a name="SecretsRepository"></a>
## type [SecretsRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/secrets.go#L22-L26>)

SecretsRepository implements the database.SecretsRepository interface using DynamoDB.

```go
type SecretsRepository struct {
    // contains filtered or unexported fields
}
```

<a name="NewSecretsRepository"></a>
### func [NewSecretsRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/secrets.go#L29>)

```go
func NewSecretsRepository(client Client, tableName string, log *slog.Logger) *SecretsRepository
```

NewSecretsRepository creates a new DynamoDB\-backed secrets repository.

<a name="SecretsRepository.CreateSecret"></a>
### func \(\*SecretsRepository\) [CreateSecret](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/secrets.go#L69>)

```go
func (r *SecretsRepository) CreateSecret(ctx context.Context, secret *api.Secret) error
```

CreateSecret stores a new secret's metadata in DynamoDB.

<a name="SecretsRepository.DeleteSecret"></a>
### func \(\*SecretsRepository\) [DeleteSecret](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/secrets.go#L294>)

```go
func (r *SecretsRepository) DeleteSecret(ctx context.Context, name string) error
```

DeleteSecret removes a secret's metadata from DynamoDB.

<a name="SecretsRepository.GetSecret"></a>
### func \(\*SecretsRepository\) [GetSecret](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/secrets.go#L113>)

```go
func (r *SecretsRepository) GetSecret(ctx context.Context, name string) (*api.Secret, error)
```

GetSecret retrieves a secret's metadata by name from DynamoDB.

<a name="SecretsRepository.GetSecretsByRequestID"></a>
### func \(\*SecretsRepository\) [GetSecretsByRequestID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/secrets.go#L169>)

```go
func (r *SecretsRepository) GetSecretsByRequestID(ctx context.Context, requestID string) ([]*api.Secret, error)
```

GetSecretsByRequestID retrieves all secrets created or modified by a specific request ID.

<a name="SecretsRepository.ListSecrets"></a>
### func \(\*SecretsRepository\) [ListSecrets](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/secrets.go#L142>)

```go
func (r *SecretsRepository) ListSecrets(ctx context.Context) ([]*api.Secret, error)
```

ListSecrets retrieves all secrets.

<a name="SecretsRepository.SecretExists"></a>
### func \(\*SecretsRepository\) [SecretExists](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/secrets.go#L320>)

```go
func (r *SecretsRepository) SecretExists(ctx context.Context, name string) (bool, error)
```

SecretExists checks if a secret with the given name exists in DynamoDB.

<a name="SecretsRepository.UpdateSecretMetadata"></a>
### func \(\*SecretsRepository\) [UpdateSecretMetadata](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/secrets.go#L253-L256>)

```go
func (r *SecretsRepository) UpdateSecretMetadata(ctx context.Context, name, keyName, description, updatedBy string) error
```

UpdateSecretMetadata updates a secret's metadata \(description and keyName\) in DynamoDB.

<a name="TokenRepository"></a>
## type [TokenRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/tokens.go#L20-L24>)

TokenRepository implements the database.TokenRepository interface using DynamoDB.

```go
type TokenRepository struct {
    // contains filtered or unexported fields
}
```

<a name="TokenRepository.CreateToken"></a>
### func \(\*TokenRepository\) [CreateToken](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/tokens.go#L62-L65>)

```go
func (r *TokenRepository) CreateToken(ctx context.Context, token *api.WebSocketToken) error
```

CreateToken stores a new WebSocket authentication token with metadata.

<a name="TokenRepository.DeleteToken"></a>
### func \(\*TokenRepository\) [DeleteToken](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/tokens.go#L152-L155>)

```go
func (r *TokenRepository) DeleteToken(ctx context.Context, tokenValue string) error
```

DeleteToken removes a token from the database.

<a name="TokenRepository.GetToken"></a>
### func \(\*TokenRepository\) [GetToken](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/tokens.go#L101-L104>)

```go
func (r *TokenRepository) GetToken(ctx context.Context, tokenValue string) (*api.WebSocketToken, error)
```

GetToken retrieves a token by its value. Returns nil if the token doesn't exist \(DynamoDB TTL automatically removes expired tokens\).

<a name="UserRepository"></a>
## type [UserRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L26-L31>)

UserRepository implements the database.UserRepository interface using DynamoDB.

```go
type UserRepository struct {
    // contains filtered or unexported fields
}
```

<a name="NewUserRepository"></a>
### func [NewUserRepository](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L34-L39>)

```go
func NewUserRepository(client Client, tableName string, pendingTableName string, log *slog.Logger) *UserRepository
```

NewUserRepository creates a new DynamoDB\-backed user repository.

<a name="UserRepository.CreatePendingAPIKey"></a>
### func \(\*UserRepository\) [CreatePendingAPIKey](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L455>)

```go
func (r *UserRepository) CreatePendingAPIKey(ctx context.Context, pending *api.PendingAPIKey) error
```

CreatePendingAPIKey stores a pending API key with a secret token.

<a name="UserRepository.CreateUser"></a>
### func \(\*UserRepository\) [CreateUser](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L66-L71>)

```go
func (r *UserRepository) CreateUser(ctx context.Context, user *api.User, apiKeyHash string, expiresAtUnix int64) error
```

CreateUser stores a new user with their hashed API key in DynamoDB. If expiresAtUnix is 0, no TTL is set \(permanent user\). If expiresAtUnix is \> 0, it sets the expires\_at field for automatic deletion.

<a name="UserRepository.DeletePendingAPIKey"></a>
### func \(\*UserRepository\) [DeletePendingAPIKey](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L588>)

```go
func (r *UserRepository) DeletePendingAPIKey(ctx context.Context, secretToken string) error
```

DeletePendingAPIKey removes a pending API key from the database.

<a name="UserRepository.GetPendingAPIKey"></a>
### func \(\*UserRepository\) [GetPendingAPIKey](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L496>)

```go
func (r *UserRepository) GetPendingAPIKey(ctx context.Context, secretToken string) (*api.PendingAPIKey, error)
```

GetPendingAPIKey retrieves a pending API key by its secret token.

<a name="UserRepository.GetUserByAPIKeyHash"></a>
### func \(\*UserRepository\) [GetUserByAPIKeyHash](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L177>)

```go
func (r *UserRepository) GetUserByAPIKeyHash(ctx context.Context, apiKeyHash string) (*api.User, error)
```

GetUserByAPIKeyHash retrieves a user by their hashed API key \(primary key\).

<a name="UserRepository.GetUserByEmail"></a>
### func \(\*UserRepository\) [GetUserByEmail](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L124>)

```go
func (r *UserRepository) GetUserByEmail(ctx context.Context, email string) (*api.User, error)
```

GetUserByEmail retrieves a user by their email using the GSI.

<a name="UserRepository.GetUsersByRequestID"></a>
### func \(\*UserRepository\) [GetUsersByRequestID](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L671>)

```go
func (r *UserRepository) GetUsersByRequestID(ctx context.Context, requestID string) ([]*api.User, error)
```

GetUsersByRequestID retrieves all users created or modified by a specific request ID.

<a name="UserRepository.ListUsers"></a>
### func \(\*UserRepository\) [ListUsers](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L615>)

```go
func (r *UserRepository) ListUsers(ctx context.Context) ([]*api.User, error)
```

ListUsers returns all users in the system sorted by email \(excluding API key hashes for security\). Uses the all\-user\_email GSI to retrieve users in sorted order directly from DynamoDB.

<a name="UserRepository.MarkAsViewed"></a>
### func \(\*UserRepository\) [MarkAsViewed](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L549>)

```go
func (r *UserRepository) MarkAsViewed(ctx context.Context, secretToken, ipAddress string) error
```

MarkAsViewed atomically marks a pending key as viewed with the IP address.

<a name="UserRepository.RemoveExpiration"></a>
### func \(\*UserRepository\) [RemoveExpiration](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L376>)

```go
func (r *UserRepository) RemoveExpiration(ctx context.Context, email string) error
```

RemoveExpiration removes the expires\_at field from a user record, making them permanent.

<a name="UserRepository.RevokeUser"></a>
### func \(\*UserRepository\) [RevokeUser](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L329>)

```go
func (r *UserRepository) RevokeUser(ctx context.Context, email string) error
```

RevokeUser marks a user's API key as revoked.

<a name="UserRepository.UpdateLastUsed"></a>
### func \(\*UserRepository\) [UpdateLastUsed](<https://github.com/runvoy/runvoy/blob/main/internal/providers/aws/database/dynamodb/users.go#L281>)

```go
func (r *UserRepository) UpdateLastUsed(ctx context.Context, email string) (*time.Time, error)
```

UpdateLastUsed updates the last\_used timestamp for a user.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
